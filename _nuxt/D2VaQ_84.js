import{e as P,i as $,j as K,g as q,r as m,k as j,m as H,c as i,a as e,d as f,p,h as l,F as E,s as T,A as V,t as c,B as W,q as g,v as y,C as Z,ad as G,o,_ as J}from"./SynJIhq3.js";const Q={class:"container-fluid py-4"},X={class:"row"},Y={class:"col"},ee={class:"card"},te={class:"card-body p-0"},le={key:0,class:"text-center py-5"},se={key:1,class:"text-center py-5 text-muted"},ae={key:2,class:"table-responsive"},ne={class:"table table-hover mb-0"},ie={class:"text-end"},oe=["onClick"],re={key:0,class:"card-footer bg-light"},de={"aria-label":"Seitennavigation"},ue={class:"pagination mb-0 justify-content-center align-items-center"},me=["disabled"],ce={class:"page-item disabled"},be={class:"page-link"},ve=["disabled"],fe={class:"modal-dialog"},pe={class:"modal-content"},ge={class:"modal-header"},he={class:"modal-title",id:"userModalLabel"},Ne={class:"modal-body"},_e={class:"mb-3"},ye=["disabled"],Se={key:0,class:"form-text"},ke={class:"mb-3"},xe={class:"mb-3"},ze={class:"mb-3"},Re={key:0,class:"mb-3"},we={key:1,class:"alert alert-info"},Me={class:"modal-footer"},Ce=["disabled"],Ue={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},D=20,Ae=P({__name:"nutzerverwaltung",setup(Be){const{$authFetch:S}=$(),h=K(),M=q(),k=m([]),x=m(!1),N=m(!1),d=m(0),v=m(!0),r=m(!1),z=m(null);let _=null;const s=m({login:"",firstName:"",lastName:"",email:"",initialRole:""}),I=j(()=>d.value>0||v.value);async function R(){var n;x.value=!0;try{const t=await S(`/users?intern=true&page=${d.value}&count=${D}`);k.value=t,v.value=t.length>=D}catch(t){M.show(((n=t==null?void 0:t.data)==null?void 0:n.message)??"Fehler beim Laden der Nutzer: "+t)}finally{x.value=!1}}function C(n){n<0||n>d.value&&!v.value||(d.value=n,R())}function O(n){return{ADMIN:"Administrator",COURSE_INSTRUCTOR:"Kursleiter",TREASURER:"Schatzmeister",STUDENT:"Schüler",SCHOOL_ADMIN:"Schuladministrator"}[n]||n}function F(){r.value=!1,s.value={login:"",firstName:"",lastName:"",email:"",initialRole:""},U()}function L(n){r.value=!0,s.value={login:n.userName,firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||""},U()}function U(){z.value&&(_=new G(z.value),_.show())}function w(){_&&_.hide()}async function A(){var n,t,a,b,B;if(!((n=s.value.login)!=null&&n.trim())){h.error("Bitte geben Sie einen Benutzernamen ein");return}if(!r.value&&!s.value.initialRole){h.error("Bitte wählen Sie eine Rolle aus");return}N.value=!0;try{if(r.value){const u={login:s.value.login};(t=s.value.firstName)!=null&&t.trim()&&(u.firstName=s.value.firstName),(a=s.value.lastName)!=null&&a.trim()&&(u.lastName=s.value.lastName),(b=s.value.email)!=null&&b.trim()&&(u.email=s.value.email),await S("/users",{method:"POST",body:u}),h.success("Nutzer erfolgreich aktualisiert")}else await S("/users",{method:"PUT",body:s.value}),h.success("Nutzer erfolgreich angelegt");w(),await R()}catch(u){M.show(((B=u==null?void 0:u.data)==null?void 0:B.message)??"Fehler beim Speichern des Nutzers: "+u)}finally{N.value=!1}}return H(()=>{R()}),(n,t)=>(o(),i("div",Q,[t[19]||(t[19]=e("div",{class:"row mb-4"},[e("div",{class:"col"},[e("h1",null,"Nutzerverwaltung"),e("p",{class:"text-muted"}," Verwaltung externer Nutzer ohne IServ-Account (z.B. externe Kursleiter) ")])],-1)),e("div",{class:"row mb-3"},[e("div",{class:"col"},[e("button",{class:"btn btn-primary",onClick:F},t[7]||(t[7]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),f(" Neuen Nutzer anlegen ")]))])]),e("div",X,[e("div",Y,[e("div",ee,[t[11]||(t[11]=e("div",{class:"card-header bg-light"},[e("h5",{class:"mb-0"},"Externe Nutzer")],-1)),e("div",te,[l(x)?(o(),i("div",le,t[8]||(t[8]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Lädt...")],-1)]))):l(k).length===0?(o(),i("div",se," Keine externen Nutzer vorhanden ")):(o(),i("div",ae,[e("table",ne,[t[10]||(t[10]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Benutzername"),e("th",null,"Vorname"),e("th",null,"Nachname"),e("th",null,"E-Mail"),e("th",null,"Rollen"),e("th",{class:"text-end"},"Aktionen")])],-1)),e("tbody",null,[(o(!0),i(E,null,T(l(k),a=>(o(),i("tr",{key:a.userName},[e("td",null,[e("strong",null,c(a.userName),1)]),e("td",null,c(a.firstName||"-"),1),e("td",null,c(a.lastName||"-"),1),e("td",null,c(a.email||"-"),1),e("td",null,[(o(!0),i(E,null,T(a.roles,b=>(o(),i("span",{key:b,class:"badge bg-secondary me-1"},c(O(b)),1))),128))]),e("td",ie,[e("button",{class:"btn btn-sm btn-outline-primary",onClick:b=>L(a),title:"Bearbeiten"},t[9]||(t[9]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,oe)])]))),128))])])]))]),l(I)?(o(),i("div",re,[e("nav",de,[e("ul",ue,[e("li",{class:V(["page-item",{disabled:l(d)===0}])},[e("button",{class:"page-link",onClick:t[0]||(t[0]=a=>C(l(d)-1)),disabled:l(d)===0}," Zurück ",8,me)],2),e("li",ce,[e("span",be," Seite "+c(l(d)+1),1)]),e("li",{class:V(["page-item",{disabled:!l(v)}])},[e("button",{class:"page-link",onClick:t[1]||(t[1]=a=>C(l(d)+1)),disabled:!l(v)}," Weiter ",8,ve)],2)])])])):p("",!0)])])]),e("div",{class:"modal fade",ref_key:"userModal",ref:z,tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},[e("div",fe,[e("div",pe,[e("div",ge,[e("h5",he,c(l(r)?"Nutzer bearbeiten":"Neuen Nutzer anlegen"),1),e("button",{type:"button",class:"btn-close",onClick:w,"aria-label":"Schließen"})]),e("div",Ne,[e("form",{onSubmit:W(A,["prevent"])},[e("div",_e,[t[12]||(t[12]=e("label",{for:"login",class:"form-label"},[f(" Benutzername "),e("span",{class:"text-danger"},"*")],-1)),g(e("input",{id:"login","onUpdate:modelValue":t[2]||(t[2]=a=>l(s).login=a),type:"text",class:"form-control",disabled:l(r),required:"",placeholder:"z.B. max.mustermann"},null,8,ye),[[y,l(s).login]]),l(r)?(o(),i("div",Se," Der Benutzername kann nicht geändert werden ")):p("",!0)]),e("div",ke,[t[13]||(t[13]=e("label",{for:"firstName",class:"form-label"},"Vorname",-1)),g(e("input",{id:"firstName","onUpdate:modelValue":t[3]||(t[3]=a=>l(s).firstName=a),type:"text",class:"form-control",placeholder:"Max"},null,512),[[y,l(s).firstName]])]),e("div",xe,[t[14]||(t[14]=e("label",{for:"lastName",class:"form-label"},"Nachname",-1)),g(e("input",{id:"lastName","onUpdate:modelValue":t[4]||(t[4]=a=>l(s).lastName=a),type:"text",class:"form-control",placeholder:"Mustermann"},null,512),[[y,l(s).lastName]])]),e("div",ze,[t[15]||(t[15]=e("label",{for:"email",class:"form-label"},"E-Mail",-1)),g(e("input",{id:"email","onUpdate:modelValue":t[5]||(t[5]=a=>l(s).email=a),type:"email",class:"form-control",placeholder:"max.mustermann@example.com"},null,512),[[y,l(s).email]])]),l(r)?p("",!0):(o(),i("div",Re,[t[17]||(t[17]=e("label",{for:"initialRole",class:"form-label"},[f(" Rolle "),e("span",{class:"text-danger"},"*")],-1)),g(e("select",{id:"initialRole","onUpdate:modelValue":t[6]||(t[6]=a=>l(s).initialRole=a),class:"form-select",required:""},t[16]||(t[16]=[e("option",{value:""},"Bitte wählen...",-1),e("option",{value:"COURSE_INSTRUCTOR"},"Kursleiter",-1),e("option",{value:"ADMIN"},"Administrator",-1),e("option",{value:"TREASURER"},"Schatzmeister",-1)]),512),[[Z,l(s).initialRole]])])),l(r)?(o(),i("div",we,t[18]||(t[18]=[e("i",{class:"bi bi-info-circle me-2"},null,-1),f(" Die Rolle kann derzeit nur beim Anlegen eines Nutzers gesetzt werden. Für Rollenänderungen wenden Sie sich bitte an einen Systemadministrator. ")]))):p("",!0)],32)]),e("div",Me,[e("button",{type:"button",class:"btn btn-secondary",onClick:w}," Abbrechen "),e("button",{type:"button",class:"btn btn-primary",onClick:A,disabled:l(N)},[l(N)?(o(),i("span",Ue)):p("",!0),f(" "+c(l(r)?"Speichern":"Anlegen"),1)],8,Ce)])])])],512)]))}}),Te=J(Ae,[["__scopeId","data-v-9ecd8c0b"]]);export{Te as default};
