const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./C40gEiOu.js","./entry.Cy85P2aQ.css"])))=>i.map(i=>d[i]);
import{e as j,i as q,j as W,g as Z,r as u,k as E,m as G,J,c as a,a as s,p as b,q as M,x as Q,h as l,I as B,F as S,s as T,t as o,N as H,B as z,d as v,v as X,o as r,_ as Y}from"./C40gEiOu.js";import{w as ee}from"./BA3RTNws.js";const se={class:"instructor-assignments"},te={class:"card mb-3"},le={class:"card-body"},ne=["value"],ae={key:0,class:"card mb-3"},re={class:"card-body"},ie={class:"row g-2"},oe={class:"col-6"},de={class:"col-6"},ue={class:"text-success"},ce={class:"progress mt-2",style:{height:"8px"}},me={key:1,class:"text-center py-4"},ve={key:2,class:"mb-4"},fe={class:"mb-2"},be={class:"list-group"},ge={class:"text-muted"},he=["onClick","disabled"],pe={key:0,class:"spinner-border spinner-border-sm"},ye={key:1,class:"bi bi-x-lg"},_e={key:3,class:"alert alert-info mb-4"},we={key:4,class:"card"},xe={class:"card-body"},ke={class:"mb-3"},Ne=["disabled"],Se={key:0,class:"form-text"},Ce={key:0,class:"available-students"},$e=["onClick"],Ke={class:"text-muted"},Ee={key:1,class:"text-center py-4 text-muted"},Te={key:2,class:"text-center py-4 text-muted"},Ae={key:5,class:"alert alert-warning"},Le={key:6,class:"text-center py-5"},Me={class:"modal-dialog modal-dialog-centered"},Be={class:"modal-content"},ze={key:0,class:"modal-body"},De={class:"alert alert-secondary"},Fe={class:"text-muted"},Ie={class:"modal-footer"},Ue=["disabled"],Ve={key:0},Pe={key:1},Oe=j({__name:"assignments",setup(Re){const{$authFetch:_}=q(),k=W(),w=Z(),A=u([]),i=u(null),d=u([]),L=u([]),h=u([]),f=u(""),g=u(!1),p=u(!1),N=u(!1),y=u(null),C=u(null),c=u(null);let x=null;const $=E(()=>i.value?d.value.length<i.value.maxAttendees:!1),D=E(()=>{if(!i.value)return"bg-primary";const n=d.value.length/i.value.maxAttendees*100;return n>=90?"bg-danger":n>=70?"bg-warning":"bg-success"}),F=E(()=>[...d.value].sort((n,e)=>{const t=n.firstName.localeCompare(e.firstName,"de");return t!==0?t:n.lastName.localeCompare(e.lastName,"de")}));G(async()=>{var n;if(C.value){const{Modal:e}=await J(async()=>{const{Modal:t}=await import("./C40gEiOu.js").then(m=>m.aM);return{Modal:t}},__vite__mapDeps([0,1]),import.meta.url);x=new e(C.value)}try{g.value=!0,p.value=!0;const[e,t]=await Promise.all([_("/courses/instructedbyme"),_("/users")]);A.value=e,L.value=t}catch(e){w.show(((n=e==null?void 0:e.data)==null?void 0:n.message)??"Fehler beim Laden der Daten")}finally{g.value=!1,p.value=!1}});const K=async()=>{var n;if(!i.value){d.value=[],h.value=[],f.value="";return}try{g.value=!0,d.value=await _(`/assignments?course-id=${i.value.id}`),f.value="",h.value=[]}catch(e){w.show(((n=e==null?void 0:e.data)==null?void 0:n.message)??"Fehler beim Laden der Teilnehmer")}finally{g.value=!1}},I=()=>{if(!f.value.trim()){h.value=[];return}const n=f.value.toLowerCase(),e=new Set(d.value.map(t=>t.userUserName));h.value=L.value.filter(t=>{if(e.has(t.userName))return!1;const m=`${t.firstName} ${t.lastName}`.toLowerCase(),R=t.grade.toString();return m.includes(n)||R.includes(n)||t.userName.toLowerCase().includes(n)}).slice(0,20)},U=async n=>{var e;if(!(!i.value||!$.value))try{N.value=!0;const t=await _("/assignments",{method:"POST",body:{userName:n.userName,courseId:i.value.courseId}});t.errors&&t.errors.length>0?t.errors.forEach(m=>w.show(m)):(t.warnings&&t.warnings.length>0&&t.warnings.forEach(m=>k.warning(m)),t.info&&t.info.length>0&&t.info.forEach(m=>k.info(m)),k.success(`${n.firstName} ${n.lastName} wurde dem Kurs zugewiesen`),f.value="",h.value=[],await K())}catch(t){w.show(((e=t==null?void 0:t.data)==null?void 0:e.message)??"Fehler beim Zuweisen des Schülers")}finally{N.value=!1}},V=n=>{c.value=n,x&&x.show()},P=async()=>{var n;if(!(!i.value||!c.value))try{y.value=c.value.id,await _(`/assignments/${c.value.id}`,{method:"DELETE"}),k.success(`${c.value.firstName} ${c.value.lastName} wurde aus dem Kurs entfernt`),x&&x.hide(),await K()}catch(e){w.show(((n=e==null?void 0:e.data)==null?void 0:n.message)??"Fehler beim Entfernen des Schülers")}finally{y.value=null,c.value=null}},O=n=>n?`${ee[n.dayOfWeek]||n.dayOfWeek} ${n.startTime}-${n.endTime}`:"";return(n,e)=>(r(),a("div",se,[e[24]||(e[24]=s("h2",{class:"h5 mb-3"},"Manuelle Kurszuweisungen",-1)),s("div",te,[s("div",le,[e[3]||(e[3]=s("label",{class:"form-label fw-bold"},"Kurs auswählen:",-1)),M(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>B(i)?i.value=t:null),class:"form-select form-select-lg",onChange:K},[e[2]||(e[2]=s("option",{value:null},"Bitte Kurs wählen...",-1)),(r(!0),a(S,null,T(l(A),t=>(r(),a("option",{key:t.id,value:t},[v(o(t.name),1),t.block?(r(),a(S,{key:0},[v(" - "+o(O(t.block)),1)],64)):b("",!0)],8,ne))),128))],544),[[Q,l(i)]])])]),l(i)?(r(),a("div",ae,[s("div",re,[s("div",ie,[s("div",oe,[e[4]||(e[4]=s("small",{class:"text-muted d-block"},"Belegung:",-1)),s("strong",null,o(l(d).length)+" / "+o(l(i).maxAttendees),1)]),s("div",de,[e[5]||(e[5]=s("small",{class:"text-muted d-block"},"Freie Plätze:",-1)),s("strong",ue,o(l(i).maxAttendees-l(d).length),1)])]),s("div",ce,[s("div",{class:z(["progress-bar",l(D)]),style:H({width:`${l(d).length/l(i).maxAttendees*100}%`})},null,6)])])])):b("",!0),l(g)&&l(i)?(r(),a("div",me,e[6]||(e[6]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1),s("p",{class:"text-muted mt-2"},"Lade Teilnehmer...",-1)]))):l(i)&&l(d).length>0?(r(),a("div",ve,[s("h6",fe,[e[7]||(e[7]=s("i",{class:"bi bi-check-circle text-success"},null,-1)),v(" Zugewiesene Schüler ("+o(l(d).length)+") ",1)]),s("div",be,[(r(!0),a(S,null,T(l(F),t=>(r(),a("div",{key:t.id,class:"list-group-item d-flex justify-content-between align-items-center"},[s("div",null,[s("strong",null,o(t.firstName)+" "+o(t.lastName),1),e[8]||(e[8]=s("br",null,null,-1)),s("small",ge,"Klasse "+o(t.grade),1)]),s("button",{class:"btn btn-sm btn-outline-danger",onClick:m=>V(t),disabled:l(y)===t.id},[l(y)===t.id?(r(),a("span",pe)):(r(),a("i",ye))],8,he)]))),128))])])):l(i)&&!l(g)&&l(d).length===0?(r(),a("div",_e,e[9]||(e[9]=[s("i",{class:"bi bi-info-circle me-2"},null,-1),v(" Dieser Kurs hat noch keine Teilnehmer. ")]))):b("",!0),l(i)&&!l(g)&&l($)?(r(),a("div",we,[e[15]||(e[15]=s("div",{class:"card-header bg-primary text-white"},[s("i",{class:"bi bi-person-plus"}),v(" Schüler hinzufügen ")],-1)),s("div",xe,[s("div",ke,[M(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>B(f)?f.value=t:null),type:"text",class:"form-control form-control-lg",placeholder:"Schüler suchen (Name oder Klasse)...",onInput:I,disabled:l(p)||l(N)},null,40,Ne),[[X,l(f)]]),l(p)?(r(),a("div",Se,e[10]||(e[10]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),v(" Lade Benutzer... ")]))):b("",!0)]),l(h).length>0?(r(),a("div",Ce,[(r(!0),a(S,null,T(l(h),t=>(r(),a("div",{key:t.userName,class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",{disabled:l(N)}]),onClick:m=>U(t),style:{cursor:"pointer"}},[s("div",null,[s("strong",null,o(t.firstName)+" "+o(t.lastName),1),e[11]||(e[11]=s("br",null,null,-1)),s("small",Ke,"Klasse "+o(t.grade)+" · "+o(t.userName),1)]),e[12]||(e[12]=s("i",{class:"bi bi-plus-circle fs-4 text-primary"},null,-1))],10,$e))),128))])):l(f)&&!l(p)?(r(),a("div",Ee,e[13]||(e[13]=[s("i",{class:"bi bi-search fs-1"},null,-1),s("p",{class:"mt-2"},"Keine Schüler gefunden.",-1)]))):l(p)?b("",!0):(r(),a("div",Te,e[14]||(e[14]=[s("i",{class:"bi bi-arrow-up fs-1"},null,-1),s("p",{class:"mt-2"},"Geben Sie einen Suchbegriff ein.",-1)])))])])):b("",!0),l(i)&&!l(g)&&!l($)?(r(),a("div",Ae,e[16]||(e[16]=[s("i",{class:"bi bi-exclamation-triangle"},null,-1),v(" Der Kurs ist voll belegt. Sie können keine weiteren Schüler hinzufügen. ")]))):b("",!0),l(i)?b("",!0):(r(),a("div",Le,e[17]||(e[17]=[s("i",{class:"bi bi-arrow-up fs-1 text-muted"},null,-1),s("p",{class:"text-muted mt-3"},"Bitte wählen Sie zunächst einen Kurs aus.",-1)]))),s("div",{ref_key:"deleteModal",ref:C,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[s("div",Me,[s("div",Be,[e[23]||(e[23]=s("div",{class:"modal-header bg-danger text-white"},[s("h5",{class:"modal-title"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),v(" Teilnehmer entfernen ")]),s("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Schließen"})],-1)),l(c)?(r(),a("div",ze,[e[19]||(e[19]=s("p",null,"Möchten Sie folgenden Schüler wirklich aus dem Kurs entfernen?",-1)),s("div",De,[s("strong",null,o(l(c).firstName)+" "+o(l(c).lastName),1),e[18]||(e[18]=s("br",null,null,-1)),s("small",Fe,"Klasse "+o(l(c).grade),1)])])):b("",!0),s("div",Ie,[e[22]||(e[22]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Abbrechen ",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:P,disabled:l(y)!==null},[l(y)!==null?(r(),a("span",Ve,e[20]||(e[20]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),v(" Entferne... ")]))):(r(),a("span",Pe,e[21]||(e[21]=[s("i",{class:"bi bi-trash me-1"},null,-1),v(" Entfernen ")])))],8,Ue)])])])],512)]))}}),We=Y(Oe,[["__scopeId","data-v-184ee5a9"]]);export{We as default};
