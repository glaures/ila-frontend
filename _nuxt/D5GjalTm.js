import{_ as L,k as S,c as n,o,a as s,p as u,A as z,e as Q,g as W,i as Z,r as k,m as X,n as Y,q as V,v as M,F as I,s as B,t as p,d as _,x as $,b as U,y as ee,z as te}from"./Bt8ervS0.js";const se=["value","placeholder"],le={key:0,class:"invalid-feedback"},ae={__name:"DateInput",props:{modelValue:String,placeholder:{type:String,default:"TT.MM.JJJJ"},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(w,{emit:g}){const f=w,x=g,b=i=>{const d=i.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!d)return i;const[y,h,P,J]=d,N=h.padStart(2,"0"),T=P.padStart(2,"0");return`${N}.${T}.${J}`},m=i=>{const d=b(i);x("update:modelValue",d)},v=S(()=>f.modelValue),l=S(()=>!f.modelValue&&!f.required?!0:/^\d{2}\.\d{2}\.\d{4}$/.test(f.modelValue));return(i,d)=>(o(),n("div",null,[s("input",{value:v.value,onInput:d[0]||(d[0]=y=>m(y.target.value)),type:"text",class:z(["form-control",{"is-invalid":!l.value&&w.modelValue}]),placeholder:w.placeholder},null,42,se),!l.value&&w.modelValue?(o(),n("div",le," Bitte ein gültiges Datum im Format TT.MM.JJJJ eingeben. ")):u("",!0)]))}},j=L(ae,[["__scopeId","data-v-e9fcc0f2"]]),ne={class:"container-fluid py-3"},oe={class:"row g-3"},ie={class:"col-12 col-xl-4"},re={class:"card shadow-sm"},ue={class:"card-body"},de={key:0,class:"list-group mt-2",style:{"max-height":"240px",overflow:"auto"}},ce=["onClick"],me={key:0,class:"me-2","aria-label":"aktuell"},ve={class:"text-muted d-block"},he={class:"badge bg-light text-dark"},fe={class:"list-group small"},be=["onClick"],pe={key:0,class:"me-2","aria-label":"aktuell"},ge={class:"ms-2"},ye={key:0,class:"badge bg-success me-1"},ke={key:1,class:"badge bg-info me-1"},_e={key:2,class:"badge bg-secondary"},we={key:0,class:"col-12 col-xl-8"},xe={class:"card shadow-sm"},Ce={class:"card-body"},De={class:"d-flex justify-content-between align-items-center mb-3"},Ve={class:"card-title mb-0"},Pe={key:0,class:"text-muted"},Te={key:0,class:"alert alert-info py-2"},Je={key:1,class:"alert alert-warning py-2"},Ne={class:"row g-3"},$e={class:"col-md-8"},Se={class:"col-md-4 d-flex align-items-end"},ze={class:"form-check mt-4"},Ee={class:"col-sm-6"},Fe={class:"col-sm-6"},Me={class:"col-12 d-flex flex-wrap gap-3 align-items-center"},Ie={class:"form-check"},Be=["disabled"],Ue={class:"form-check"},je={class:"d-flex flex-wrap gap-2 mt-4"},Le=["disabled"],qe={key:0,class:"spinner-border spinner-border-sm me-2"},Ae=["disabled"],Ke=["disabled"],Re={key:1,class:"col-12 col-xl-8"},Ge=Q({__name:"index",setup(w){const g=W(),f=te(),x=ee(),{$authFetch:b}=Z(),m=k([]),v=k(null),l=k(null),i=k(!1),d=k(""),y=k([]),h=S(()=>{var a;return((a=l.value)==null?void 0:a.id)==null});function P(a){return{...a}}function J(){return{id:null,name:"",startDate:"",endDate:"",visible:!0,current:!1,isClosed:!1}}function N(a){const e=t=>t.split(".").reverse().join("-");return[...a].sort((t,r)=>{if(t.current!==r.current)return t.current?-1:1;const c=e(t.startDate||"00.00.0000"),F=e(r.startDate||"00.00.0000");return c!==F?c.localeCompare(F):(t.name||"").localeCompare(r.name||"")})}function T(a,e){return{active:e,"border border-2 border-info current-item":a.current&&!e}}async function q(){var a;try{const e=await b("/periods",{method:"GET"});m.value=N(e||[])}catch(e){g.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}function C(a){v.value=a,l.value=P(a),x.replace({path:`/admin/phasen/${a.id}`}).catch(()=>{})}function A(){v.value=null,l.value=J(),x.replace({path:"/admin/phasen"}).catch(()=>{})}function K(){l.value=v.value?P(v.value):null}function R(){const a=d.value.trim().toLowerCase();y.value=a?m.value.filter(e=>(e.name||"").toLowerCase().includes(a)||(e.startDate||"").includes(a)||(e.endDate||"").includes(a)||String(e.id||"").includes(a)).slice(0,20):[]}async function G(){var a;if(!(!l.value||l.value.id==null))try{if(l.value.isClosed&&!confirm("Diese Phase ist geschlossen. Trotzdem zur aktuellen Phase machen?"))return;i.value=!0;const e={...l.value,current:!0},t=await b(`/periods/${l.value.id}`,{method:"PUT",body:e});await D();const r=m.value.find(c=>c.id===t.id);r&&C(r)}catch(e){g.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{i.value=!1}}async function H(){var a;if(l.value){i.value=!0;try{const e={...l.value};if(e.current&&e.isClosed&&!confirm("Diese Phase ist geschlossen. Trotzdem als aktuelle Phase speichern?")){i.value=!1;return}let t;l.value.id==null?t=await b("/periods",{method:"POST",body:e}):t=await b(`/periods/${l.value.id}`,{method:"PUT",body:e}),await D();const r=m.value.find(c=>c.id===t.id);r&&C(r)}catch(e){g.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{i.value=!1}}}async function O(){var a;if(!(!l.value||l.value.id==null)&&confirm("Diese Phase wirklich löschen?")){i.value=!0;try{await b(`/periods/${l.value.id}`,{method:"DELETE"}),await D(),v.value=null,l.value=null,x.replace({path:"/admin/phasen"}).catch(()=>{})}catch(e){g.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{i.value=!1}}}async function E(){const a=Number(f.params.id);if(a&&m.value.length){const e=m.value.find(t=>t.id===a);e&&C(e)}}async function D(){await q(),await E()}return X(async()=>{await D()}),Y(()=>f.params.id,async()=>{await E()}),(a,e)=>(o(),n("div",ne,[s("div",oe,[s("div",ie,[s("div",re,[s("div",ue,[e[7]||(e[7]=s("h5",{class:"card-title mb-3"},"Phasen verwalten",-1)),e[8]||(e[8]=s("label",{class:"form-label"},"Suchen",-1)),V(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),type:"text",class:"form-control",placeholder:"Name der Phase oder Datum (z. B. 12.09.2025)",onInput:R},null,544),[[M,d.value]]),y.value.length?(o(),n("div",de,[(o(!0),n(I,null,B(y.value,t=>{var r;return o(),n("button",{key:t.id,class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",T(t,((r=v.value)==null?void 0:r.id)===t.id)]),onClick:c=>C(t)},[s("span",null,[t.current?(o(),n("span",me,"⭐")):u("",!0),_(" "+p(t.name)+" ",1),s("small",ve,p(t.startDate)+" – "+p(t.endDate),1)]),s("span",he,"#"+p(t.id),1)],10,ce)}),128))])):u("",!0),s("div",{class:"d-grid gap-2 mt-3"},[s("button",{class:"btn btn-primary",onClick:A},"Neue Phase anlegen"),s("button",{class:"btn btn-outline-secondary",onClick:D},"Neu laden")]),e[9]||(e[9]=s("hr",{class:"my-4"},null,-1)),e[10]||(e[10]=s("h6",{class:"text-muted mb-2"},"Alle Phasen",-1)),s("ul",fe,[(o(!0),n(I,null,B(m.value,t=>{var r;return o(),n("li",{key:t.id,class:z(["list-group-item d-flex justify-content-between align-items-center",T(t,((r=v.value)==null?void 0:r.id)===t.id)]),role:"button",onClick:c=>C(t)},[s("span",null,[t.current?(o(),n("span",pe,"⭐")):u("",!0),_(" "+p(t.name),1)]),s("span",ge,[t.visible?(o(),n("span",ye,"sichtbar")):u("",!0),t.current?(o(),n("span",ke,"aktuell")):u("",!0),t.isClosed?(o(),n("span",_e,"geschlossen")):u("",!0)])],10,be)}),128))])])])]),l.value?(o(),n("div",we,[s("div",xe,[s("div",Ce,[s("div",De,[s("h5",Ve,p(h.value?"Neue Phase":"Phase bearbeiten: "+(l.value.name||"")),1),h.value?u("",!0):(o(),n("small",Pe,"ID: "+p(l.value.id),1))]),!h.value&&l.value.current?(o(),n("div",Te," Diese Phase ist aktuell. ")):u("",!0),!h.value&&l.value.isClosed?(o(),n("div",Je,e[11]||(e[11]=[_(" Diese Phase ist "),s("strong",null,"geschlossen",-1),_(". Wenn du sie zur "),s("em",null,"aktuellen",-1),_(" Phase machst, steht sie Nutzern ggf. nicht für neue Kurswahlen zur Verfügung. Bitte prüfe das sorgfältig. ")]))):u("",!0),s("div",Ne,[s("div",$e,[e[12]||(e[12]=s("label",{class:"form-label"},"Name",-1)),V(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.name=t),type:"text",class:"form-control",placeholder:"z. B. Schuljahr 2025/26 – Halbjahr 1"},null,512),[[M,l.value.name,void 0,{trim:!0}]])]),s("div",Se,[s("div",ze,[V(s("input",{class:"form-check-input",type:"checkbox",id:"visible","onUpdate:modelValue":e[2]||(e[2]=t=>l.value.visible=t)},null,512),[[$,l.value.visible]]),e[13]||(e[13]=s("label",{class:"form-check-label",for:"visible"},"sichtbar",-1))])]),s("div",Ee,[e[14]||(e[14]=s("label",{class:"form-label"},"Startdatum (TT.MM.JJJJ)",-1)),U(j,{modelValue:l.value.startDate,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.startDate=t),placeholder:"01.09.2025",required:"true"},null,8,["modelValue"])]),s("div",Fe,[e[15]||(e[15]=s("label",{class:"form-label"},"Enddatum (TT.MM.JJJJ)",-1)),U(j,{modelValue:l.value.endDate,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.endDate=t),placeholder:"31.01.2026"},null,8,["modelValue"])]),s("div",Me,[s("div",Ie,[V(s("input",{class:"form-check-input",type:"checkbox",id:"current","onUpdate:modelValue":e[5]||(e[5]=t=>l.value.current=t)},null,512),[[$,l.value.current]]),e[16]||(e[16]=s("label",{class:"form-check-label",for:"current"},"aktuell",-1))]),!h.value&&!l.value.current?(o(),n("button",{key:0,class:"btn btn-outline-info btn-sm",type:"button",onClick:G,disabled:i.value}," Zur aktuellen Phase machen ",8,Be)):u("",!0),s("div",Ue,[V(s("input",{class:"form-check-input",type:"checkbox",id:"isClosed","onUpdate:modelValue":e[6]||(e[6]=t=>l.value.isClosed=t)},null,512),[[$,l.value.isClosed]]),e[17]||(e[17]=s("label",{class:"form-check-label",for:"isClosed"},"geschlossen",-1))])])]),s("div",je,[s("button",{class:"btn btn-success",onClick:H,disabled:i.value},[i.value?(o(),n("span",qe)):u("",!0),e[18]||(e[18]=_(" Speichern "))],8,Le),h.value?u("",!0):(o(),n("button",{key:0,class:"btn btn-outline-danger",onClick:O,disabled:i.value},"Löschen",8,Ae)),s("button",{class:"btn btn-outline-secondary",onClick:K,disabled:i.value},"Abbrechen",8,Ke)])])])])):(o(),n("div",Re,e[19]||(e[19]=[s("div",{class:"alert alert-info"},"Bitte eine Phase aus der Liste wählen oder „Neue Phase anlegen“ klicken.",-1)])))])]))}}),Oe=L(Ge,[["__scopeId","data-v-4a19c4b1"]]);export{Oe as default};
