import{_ as j,ae as A,i as D,r,k as $,l as F,m as U,n as q,c as a,a as o,p as m,q as K,v as L,F as g,s as C,t as l,d as B,o as n}from"./qDpktqzJ.js";import{w as T}from"./BA3RTNws.js";import{u as M}from"./Bg08kxtl.js";const R={class:"mb-4 mt-3"},Z={key:0,class:"list-group"},z=["onClick"],G={key:0,class:"alert alert-success"},H={key:1,class:"alert alert-warning"},J={key:2,class:"alert alert-danger"},Q={key:3},X={class:"table table-sm"},Y={class:"p-2"},ee={class:"text-muted"},se={class:"mt-1"},te=["onClick"],oe={class:"mt-4"},le={key:0,class:"list-group"},ae=["onClick"],ne={class:"text-muted small"},re={key:1,class:"mt-2"},ue={__name:"[[username]]",setup(ie){const N=A(),{$authFetch:v}=D(),p=M(),I=r([]),_=r([]),S=r([]),f=r(""),u=r(null),k=r(""),b=r([]),i=r(null),c=r({info:[],warning:[],error:[]}),h=$(()=>{const e=f.value.toLowerCase();return e?I.value.filter(t=>{var s,d;return((s=t.firstName)==null?void 0:s.toLowerCase().includes(e))||((d=t.lastName)==null?void 0:d.toLowerCase().includes(e))}):[]}),O=$(()=>_.value.map(e=>({...e,block:{...e.block,dayOfWeek:T[e.block.dayOfWeek]}})));F(async()=>{p.selectedPeriod&&(_.value=await v(`/courses?period-id=${p.selectedPeriod.id}`))}),U(async()=>{var t;I.value=await v("/users"),_.value=await v(`/courses?period-id=${p.selectedPeriod.id}`);const e=(t=N.params)==null?void 0:t.username;if(e){const s=decodeURIComponent(e);w({userName:s}),f.value=s}});function w(e){u.value=e,f.value="",h.value=[],y()}async function y(){u.value&&(S.value=(await v(`/assignments?user-name=${u.value.userName}&period-id=${p.selectedPeriod.id}`)).map(e=>({...e,course:{...e.course,block:{...e.course.block,dayOfWeek:T[e.course.block.dayOfWeek]}}})))}function E(){const e=k.value.toLowerCase();b.value=O.value.filter(t=>t.name.toLowerCase().includes(e)||t.courseId.toString().includes(e))}function P(e){console.log("course selected: "+e.name),i.value=e,k.value="",b.value=[]}async function V(){if(!u.value||!i.value)return;const e=await v("/assignments",{method:"POST",body:{userName:u.value.userName,courseId:i.value.courseId}});x(e),await y(),i.value=null}async function W(e){console.log("deleting "+e);const t=await v(`/assignments/${e}`,{method:"DELETE"});x(t),await y()}function x(e){console.log("feedback: "+e.info),c.value={info:e.info||[],warning:e.warning||[],error:e.error||[]}}return q(()=>{var e;return(e=N.params)==null?void 0:e.username},e=>{if(e){const t=decodeURIComponent(String(e));w(t)}}),(e,t)=>(n(),a("div",{class:"container-fluid py-3",onKeydown:t[2]||(t[2]=(...s)=>e.onKeydown&&e.onKeydown(...s))},[t[6]||(t[6]=o("div",{class:"d-flex align-items-center justify-content-between mb-3"},[o("div",{class:"h4 m-0"},"Manuelle Zuweisungen")],-1)),o("div",R,[t[3]||(t[3]=o("label",{class:"form-label"},"Schülersuche",-1)),K(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),class:"form-control",placeholder:"Vorname oder Nachname"},null,512),[[L,f.value]]),h.value.length&&f.value?(n(),a("ul",Z,[(n(!0),a(g,null,C(h.value,s=>(n(),a("li",{class:"list-group-item list-group-item-action",key:s.username,onClick:d=>w(s)},l(s.firstName)+" "+l(s.lastName)+" ("+l(s.userName)+") ",9,z))),128))])):m("",!0)]),c.value.info.length?(n(),a("div",G,l(c.value.info.join(" ")),1)):m("",!0),c.value.warning.length?(n(),a("div",H,l(c.value.warning.join(" ")),1)):m("",!0),c.value.error.length?(n(),a("div",J,l(c.value.error.join(" ")),1)):m("",!0),u.value?(n(),a("div",Q,[o("h5",null,"Kurse von "+l(u.value.firstName)+" "+l(u.value.lastName),1),o("table",X,[t[4]||(t[4]=o("thead",null,[o("tr",null,[o("th",null,"Kurs"),o("th",null,"Aktion")])],-1)),o("tbody",null,[(n(!0),a(g,null,C(S.value,s=>(n(),a("tr",{key:s.id},[o("td",null,[o("div",Y,[o("div",ee,l(s.course.block.dayOfWeek)+", "+l(s.course.block.startTime)+"-"+l(s.course.block.endTime),1),o("div",se,l(s.course.courseId)+": "+l(s.course.name),1)])]),o("td",null,[o("button",{class:"btn btn-danger btn-sm",onClick:d=>W(s.id)},"Entfernen",8,te)])]))),128))])]),o("div",oe,[t[5]||(t[5]=o("label",{class:"form-label"},"Kurs hinzufügen",-1)),K(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onInput:E,class:"form-control",placeholder:"Kursname oder Kurs-ID"},null,544),[[L,k.value]]),b.value.length&&k.value?(n(),a("ul",le,[(n(!0),a(g,null,C(b.value,s=>{var d;return n(),a("li",{class:"list-group-item list-group-item-action",key:s.courseId,onClick:ce=>P(s)},[o("div",ne,l((d=s.block)==null?void 0:d.dayOfWeek)+" "+l(s.block.startTime)+"-"+l(s.block.endTime),1),o("div",null,"["+l(s.courseId)+"] "+l(s.name),1)],8,ae)}),128))])):m("",!0),i.value?(n(),a("div",re,[B(l(i.value.courseId)+": "+l(i.value.name)+" ",1),o("button",{class:"btn btn-primary",onClick:V},"Zuweisen")])):m("",!0)])])):m("",!0)],32))}},fe=j(ue,[["__scopeId","data-v-d984fc1b"]]);export{fe as default};
