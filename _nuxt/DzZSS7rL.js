import{e as E,k as O,r as v,l as x,m as M,c as l,a as t,p as h,q as W,z as $,F as f,i as y,t as i,o,d as D}from"./BBA-slmR.js";import{_ as K}from"./DlAUqK2U.js";const L={class:"container py-4"},j={class:"d-flex align-items-center justify-content-between mb-3 d-print-none"},I={class:"btn-group"},V=["disabled"],P={key:0},z={key:1},H=["disabled"],q={class:"card mb-4 d-print-none"},Z={class:"card-body"},G={class:"row g-3 align-items-end"},J={class:"col-12 col-md-6"},Q=["value"],X={key:0,class:"col-12 col-md-6"},ee={class:"text-muted small"},te={key:0,class:"alert alert-info"},se={key:1,class:"alert alert-danger"},ae={key:2},ne={class:"d-flex align-items-center mb-2 d-print-none"},le={class:"h5 mb-0"},oe={class:"badge bg-light text-dark ms-2"},ie={key:0,class:"row g-3"},re={class:"card h-100 course-print-page"},de={class:"card-header d-none d-print-block bg-white border-0 pt-4"},ce={class:"mb-1 text-uppercase small text-muted"},ue={class:"h4 mb-1"},me={class:"h5 mb-0"},ve={class:"card-body d-flex flex-column"},_e={class:"d-flex justify-content-between align-items-start mb-2 d-print-none"},ge={class:"h6 mb-0"},he={class:"badge bg-secondary"},fe={class:"small text-muted mb-2"},ye={class:"mt-auto"},pe={class:"d-flex justify-content-between align-items-center border-top pt-2 mb-1"},be={class:"badge bg-light text-dark"},ke={class:"mb-0 ps-3"},De={key:0,class:"small text-muted"},Ae={key:1,class:"alert alert-warning"},we=E({__name:"assignments",setup(xe){const{$authFetch:p}=O(),d=v(!1),m=v(null),_=v([]),r=v(""),g=v({}),u=v({}),N={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},b=s=>N[s]||s,A=x(()=>{const s=new Set(_.value.map(a=>a.dayOfWeek)),e=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];return Array.from(s).sort((a,n)=>e.indexOf(a)-e.indexOf(n))}),B=x(()=>_.value.filter(s=>s.dayOfWeek===r.value).sort((s,e)=>s.startTime.localeCompare(e.startTime)));function w(s){return`${s.startTime} – ${s.endTime}`}function S(s){if(s.instructor&&s.instructor.trim().length)return s.instructor;const e=s.teacher;return e&&(`${e.firstName??""} ${e.lastName??""}`.trim()||e.userName)||"—"}async function C(){m.value=null,d.value=!0;try{const s=await p("/blocks");_.value=s,!r.value&&_.value.length&&(r.value=A.value[0]||"",r.value&&await k(r.value))}catch(s){m.value=(s==null?void 0:s.message)||"Fehler beim Laden der Blöcke."}finally{d.value=!1}}async function T(s){const e=await p(`/courses?block-id=${encodeURIComponent(s)}`);return g.value[s]=e,e}async function F(s){if(u.value[s])return u.value[s];const e=await p(`/assignments?course-id=${encodeURIComponent(s)}`);return e.sort((a,n)=>a.lastName===n.lastName?a.firstName.localeCompare(n.firstName,"de"):a.lastName.localeCompare(n.lastName,"de")),u.value[s]=e,e}async function k(s){m.value=null,d.value=!0;try{g.value={},u.value={};const e=_.value.filter(c=>c.dayOfWeek===s),n=(await Promise.all(e.map(c=>T(c.id)))).flat();await Promise.all(n.map(c=>F(c.id)))}catch(e){m.value=(e==null?void 0:e.message)||"Fehler beim Laden der Kurse/Teilnehmer."}finally{d.value=!1}}function Y(){r.value&&k(r.value)}function U(){window.print()}async function R(){r.value&&await k(r.value)}return M(C),(s,e)=>(o(),l("div",L,[t("div",j,[e[1]||(e[1]=t("h1",{class:"h3 m-0"},"Kursbelegungen – Übersicht & Druck",-1)),t("div",I,[t("button",{class:"btn btn-outline-secondary",onClick:R,disabled:d.value},[d.value?(o(),l("span",z,"Aktualisiere…")):(o(),l("span",P,"Neu laden"))],8,V),t("button",{class:"btn btn-primary",onClick:U,disabled:d.value||!r.value}," Drucken ",8,H)])]),t("div",q,[t("div",Z,[t("div",G,[t("div",J,[e[3]||(e[3]=t("label",{class:"form-label",for:"daySelect"},"Wochentag",-1)),W(t("select",{id:"daySelect",class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),onChange:Y},[e[2]||(e[2]=t("option",{disabled:"",value:""},"– Bitte wählen –",-1)),(o(!0),l(f,null,y(A.value,a=>(o(),l("option",{key:a,value:a},i(b(a)),9,Q))),128))],544),[[$,r.value]])]),r.value?(o(),l("div",X,[t("div",ee," Es werden alle Blöcke am "+i(b(r.value))+" geladen. Für jeden Block werden die angebotenen Kurse und deren Teilnehmer angezeigt. ",1)])):h("",!0)])])]),d.value?(o(),l("div",te,"Daten werden geladen …")):h("",!0),m.value?(o(),l("div",se,i(m.value),1)):h("",!0),!d.value&&r.value?(o(),l("div",ae,[(o(!0),l(f,null,y(B.value,a=>(o(),l("div",{key:a.id,class:"mb-4"},[t("div",ne,[t("h2",le,"Block "+i(w(a)),1),t("span",oe,"ID: "+i(a.id),1)]),g.value[a.id]&&g.value[a.id].length?(o(),l("div",ie,[(o(!0),l(f,null,y(g.value[a.id],n=>(o(),l("div",{key:n.id,class:"col-12 col-md-6 col-lg-4"},[t("div",re,[t("div",de,[t("div",ce,i(b(a.dayOfWeek)),1),t("h1",ue,i(w(a)),1),t("h2",me,i(n.name),1)]),t("div",ve,[t("div",_e,[t("h3",ge,i(n.name),1),t("span",he,i(n.courseId),1)]),t("div",fe,[t("div",null,[e[4]||(e[4]=D("Raum: ")),t("strong",null,i(n.room||"—"),1)]),t("div",null,[e[5]||(e[5]=D("Leitung: ")),t("strong",null,i(S(n)),1)]),t("div",null,[e[6]||(e[6]=D("Max. TN: ")),t("strong",null,i(n.maxAttendees),1)])]),t("div",ye,[t("div",pe,[e[7]||(e[7]=t("span",{class:"small text-muted"},"Teilnehmer",-1)),t("span",be,i((u.value[n.id]||[]).length)+" / "+i(n.maxAttendees),1)]),t("ol",ke,[(o(!0),l(f,null,y(u.value[n.id]||[],c=>(o(),l("li",{key:c.userUserName,class:"small"},i(c.lastName)+", "+i(c.firstName),1))),128)),(u.value[n.id]||[]).length===0?(o(),l("li",De,"(Keine Zuordnungen)")):h("",!0)])])])])]))),128))])):(o(),l("div",Ae,"Für diesen Block sind keine Kurse hinterlegt."))]))),128))])):h("",!0)]))}}),Se=K(we,[["__scopeId","data-v-6b1e27f7"]]);export{Se as default};
