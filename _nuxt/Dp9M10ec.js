import{e as te,i as oe,g as le,j as F,r as f,k as ne,l as ae,c as a,a as o,m as x,n as u,v as d,F as _,p as N,d as $,q as L,s as re,x as ue,o as r,t as i}from"./AwnmPAjg.js";import{u as ie}from"./DfOf_ssZ.js";import{w as D}from"./BA3RTNws.js";import{_ as de}from"./DlAUqK2U.js";const ce={class:"d-flex align-items-center justify-content-between mb-3"},me=["disabled"],ve={key:0,class:"alert alert-info"},fe={key:0,class:"list-group position-absolute w-100 shadow",style:{"z-index":"20","max-height":"320px",overflow:"auto"}},pe=["onClick"],be={class:"d-flex justify-content-between"},he={class:"badge bg-secondary me-2"},ye={key:0,class:"text-muted ms-2"},ge={key:1,class:"small text-muted mt-1"},ke={class:"text-muted"},we={key:0,class:"small text-muted text-truncate"},xe={key:0,class:"list-group-item text-muted"},Ae={class:"card shadow-sm"},Ce={class:"card-body"},Ie={class:"row g-3"},_e={class:"col-12 col-md-3"},Ne={class:"col-12 col-md-5"},$e={class:"col-12 col-md-4"},Ke={class:"col-12"},Se={class:"col-12 col-md-3"},Ee={class:"col-12 col-md-3"},Fe={class:"col-12 col-md-3"},Le={class:"col-12 col-md-3"},Pe=["value"],Be=["value"],Te={class:"col-12"},Ue={class:"d-flex flex-wrap gap-3"},Ve=["id","value"],De=["for"],Oe={class:"col-12"},qe={class:"d-flex flex-wrap gap-3"},ze=["id","value"],Me=["for"],Re={class:"col-12"},je={class:"form-check"},We=te({__name:"kurse",setup(Ge){const O=["iLa","KuP","BuE","FuF"],q=[5,6,7,8,9,10,11,12],p=ue(),P=re(),{$authFetch:c}=oe(),b=le(),C=ie(),m=F(()=>C.selectedId),h=f([]),B=f([]),T=f(null),y=f(null),A=f(""),v=f(!1),U=F(()=>{const t=A.value.trim().toLowerCase();return t?h.value.filter(e=>(e.courseId??"").toLowerCase().includes(t)||(e.name??"").toLowerCase().includes(t)||(e.description??"").toLowerCase().includes(t)||(e.instructor??"").toLowerCase().includes(t)).slice(0,50):h.value.slice(0,20)}),l=f({courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1}),z=F(()=>B.value.filter(t=>m.value!=null&&t.periodId===m.value));function M(t){return`${D[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`}function R(t){return t?`${D[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`:""}function j(t){return`${t.courseId?`[${t.courseId}] `:""}${t.name??""}`}async function W(){var t;try{B.value=await c("/blocks")}catch(e){b.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}async function I(){var t;try{if(m.value==null){h.value=[];return}h.value=await c(`/courses?period-id=${m.value}`)}catch(e){b.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}function K(t){var e;T.value={...t},l.value={id:t.id,courseId:t.courseId??"",name:t.name??"",description:t.description??"",courseCategories:Array.isArray(t.courseCategories)?[...t.courseCategories]:[],maxAttendees:t.maxAttendees,room:t.room??"",instructor:t.instructor??"",block:t.block??null,minAttendees:typeof t.minAttendees=="number"?t.minAttendees:0,grades:Array.isArray(t.grades)?[...t.grades].sort((s,n)=>s-n):[],placeholder:!!t.placeholder},y.value=((e=t.block)==null?void 0:e.id)??null,A.value=j(t),v.value=!1,P.replace({path:p.path,query:{id:String(t.id??"")}})}function S(){T.value=null,y.value=null,l.value={courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1},A.value="",v.value=!1,P.replace({path:p.path,query:{}})}function G(){var e,s;const t=[];return(e=l.value.courseId)!=null&&e.trim()||t.push("courseId ist Pflicht."),(s=l.value.name)!=null&&s.trim()||t.push("name ist Pflicht."),l.value.maxAttendees==null?t.push("maxAttendees ist Pflicht."):Number(l.value.maxAttendees)<1&&t.push("maxAttendees muss ≥ 1 sein."),(!l.value.courseCategories||l.value.courseCategories.length===0)&&t.push("Mindestens eine Kurskategorie wählen."),l.value.minAttendees!=null&&l.value.maxAttendees!=null&&Number(l.value.minAttendees)>Number(l.value.maxAttendees)&&t.push("minAttendees darf nicht größer als maxAttendees sein."),m.value==null&&t.push("Bitte oben eine Phase auswählen."),t}async function Z(){var e,s,n,V;if(G().length){b.show(err.join(" "));return}try{const g=Array.from(new Set(l.value.grades??[])).sort((w,se)=>w-se),E={courseId:l.value.courseId.trim(),name:l.value.name.trim(),description:((e=l.value.description)==null?void 0:e.trim())||"",courseCategories:[...l.value.courseCategories],maxAttendees:Number(l.value.maxAttendees),room:((s=l.value.room)==null?void 0:s.trim())||"",instructor:((n=l.value.instructor)==null?void 0:n.trim())||"",blockId:y.value!==null?y.value:null,minAttendees:Number(l.value.minAttendees??0),grades:g,placeholder:!!l.value.placeholder};let k;if(l.value.id!=null){const w=Number(l.value.id);k=await c(`/courses/${w}`,{method:"PUT",body:E})}else E.periodId=m.value,k=await c("/courses",{method:"POST",body:E});await I();const ee=h.value.find(w=>k.id&&w.id===k.id||w.courseId===k.courseId)??k;K(ee)}catch(g){b.show(((V=g==null?void 0:g.data)==null?void 0:V.message)??"Es ist ein interner Fehler aufgetreten: "+g)}}async function H(t){var e;try{const s=await c(`/assignments?course-id=${t}`);if(typeof s=="number")return s;if(Array.isArray(s))return s.length;if(s&&typeof s=="object"){const n=s.count??s.total??s.size;if(typeof n=="number")return n}throw new Error("Unerwartetes Antwortformat von /assignments")}catch(s){throw b.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Fehler beim Laden der Zuordnungsanzahl: "+s),s}}async function J(){if(l.value.id==null){b.show("Kein Kurs ausgewählt oder Kurs hat keine Server-ID.");return}const t=Number(l.value.id);try{const e=await H(t);if(e>0&&!window.confirm(`Es sind aktuell ${e} Schülerinnen diesem Kurs zugewiesen. Bist Du sicher, dass Du diesen Kurs löschen möchtest? Es gehen alle Zuweisungen dadurch verloren.`))return;await c(`/courses/${t}`,{method:"DELETE"}),await I(),S()}catch{}}function Q(){const t=typeof p.query.id=="string"?p.query.id:typeof p.params.id=="string"?p.params.id:"";if(!t)return;const e=Number(t),s=h.value.find(n=>n.id===e);s&&K(s)}ne(async()=>{C.initialized||await C.loadPeriods(c),await W(),await I(),Q()}),ae(()=>C.selectedId,async()=>{await I(),S()});function X(t){t.key==="Escape"&&(v.value=!1)}function Y(t){const e=t.target.value;y.value=e?Number(e):null}return(t,e)=>(r(),a("div",{class:"container-fluid py-3",onKeydown:X},[o("div",ce,[e[14]||(e[14]=o("h1",{class:"h4 m-0"},"Kurse verwalten",-1)),o("div",null,[o("button",{class:"btn btn-outline-secondary me-2",onClick:S},"Neuer Kurs"),o("button",{class:"btn btn-outline-danger me-2",disabled:!l.value.id,onClick:J},"Löschen",8,me),o("button",{class:"btn btn-primary",onClick:Z},"Speichern")])]),m.value==null?(r(),a("div",ve," Bitte oben eine Phase auswählen. Es werden erst dann Kurse geladen. ")):x("",!0),o("div",{class:"mb-3 position-relative",onFocusin:e[3]||(e[3]=s=>v.value=!0)},[e[15]||(e[15]=o("label",{class:"form-label fw-semibold"},"Kurs suchen",-1)),u(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>A.value=s),onFocus:e[1]||(e[1]=s=>v.value=!0),onInput:e[2]||(e[2]=s=>v.value=!0),class:"form-control",type:"text",placeholder:"Suche nach ID, Name, Beschreibung oder Kursleiter ...",autocomplete:"off"},null,544),[[d,A.value]]),v.value?(r(),a("div",fe,[(r(!0),a(_,null,N(U.value,s=>(r(),a("button",{key:s.id??s.courseId,class:"list-group-item list-group-item-action",onClick:n=>K(s)},[o("div",be,[o("div",null,[o("span",he,i(s.courseId),1),o("strong",null,i(s.name),1),s.instructor?(r(),a("small",ye,"("+i(s.instructor)+")",1)):x("",!0),s.block?(r(),a("div",ge,i(R(s.block)),1)):x("",!0)]),o("small",ke,"max: "+i(s.maxAttendees),1)]),s.description?(r(),a("div",we,i(s.description),1)):x("",!0)],8,pe))),128)),U.value.length===0?(r(),a("div",xe,"Keine Treffer")):x("",!0)])):x("",!0)],32),o("div",Ae,[o("div",Ce,[o("div",Ie,[o("div",_e,[e[16]||(e[16]=o("label",{class:"form-label"},[$("Kurs-ID "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.courseId=s),class:"form-control",type:"text"},null,512),[[d,l.value.courseId]])]),o("div",Ne,[e[17]||(e[17]=o("label",{class:"form-label"},[$("Name "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.name=s),class:"form-control",type:"text"},null,512),[[d,l.value.name]])]),o("div",$e,[e[18]||(e[18]=o("label",{class:"form-label"},"Kursleiter",-1)),u(o("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.instructor=s),class:"form-control",type:"text"},null,512),[[d,l.value.instructor]])]),o("div",Ke,[e[19]||(e[19]=o("label",{class:"form-label"},"Beschreibung",-1)),u(o("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.description=s),class:"form-control",rows:"3"},null,512),[[d,l.value.description]])]),o("div",Se,[e[20]||(e[20]=o("label",{class:"form-label"},[$("Max. Teilnehmer "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.maxAttendees=s),class:"form-control",type:"number",min:"1"},null,512),[[d,l.value.maxAttendees,void 0,{number:!0}]])]),o("div",Ee,[e[21]||(e[21]=o("label",{class:"form-label"},"Min. Teilnehmer",-1)),u(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.minAttendees=s),class:"form-control",type:"number",min:"0"},null,512),[[d,l.value.minAttendees,void 0,{number:!0}]])]),o("div",Fe,[e[22]||(e[22]=o("label",{class:"form-label"},"Raum",-1)),u(o("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.room=s),class:"form-control",type:"text"},null,512),[[d,l.value.room]])]),o("div",Le,[e[24]||(e[24]=o("label",{class:"form-label"},"Block (optional)",-1)),o("select",{class:"form-select",value:y.value??"",onChange:Y},[e[23]||(e[23]=o("option",{value:""},"— kein Block zugewiesen —",-1)),(r(!0),a(_,null,N(z.value,s=>(r(),a("option",{key:s.id,value:s.id},i(M(s)),9,Be))),128))],40,Pe)]),o("div",Te,[e[25]||(e[25]=o("label",{class:"form-label d-block"},[$("Kategorien "),o("span",{class:"text-danger"},"*")],-1)),o("div",Ue,[(r(),a(_,null,N(O,s=>o("div",{key:s,class:"form-check"},[u(o("input",{class:"form-check-input",type:"checkbox",id:"cat-"+s,value:s,"onUpdate:modelValue":e[11]||(e[11]=n=>l.value.courseCategories=n)},null,8,Ve),[[L,l.value.courseCategories]]),o("label",{class:"form-check-label",for:"cat-"+s},i(s),9,De)])),64))])]),o("div",Oe,[e[26]||(e[26]=o("label",{class:"form-label d-block"},"Klassenstufen",-1)),o("div",qe,[(r(),a(_,null,N(q,s=>o("div",{key:s,class:"form-check"},[u(o("input",{class:"form-check-input",type:"checkbox",id:"grade-"+s,value:s,"onUpdate:modelValue":e[12]||(e[12]=n=>l.value.grades=n)},null,8,ze),[[L,l.value.grades]]),o("label",{class:"form-check-label",for:"grade-"+s},i(s),9,Me)])),64))]),e[27]||(e[27]=o("div",{class:"form-text"},"Mehrfachauswahl möglich (5–12).",-1))]),o("div",Re,[o("div",je,[u(o("input",{class:"form-check-input",type:"checkbox",id:"placeholder","onUpdate:modelValue":e[13]||(e[13]=s=>l.value.placeholder=s)},null,512),[[L,l.value.placeholder]]),e[28]||(e[28]=o("label",{class:"form-check-label",for:"placeholder"},"Platzhalter",-1))])])])])]),e[29]||(e[29]=o("div",{class:"py-3"},null,-1))],32))}}),Xe=de(We,[["__scopeId","data-v-16830af2"]]);export{Xe as default};
