import{_ as A,ae as B,i as D,r as i,k as K,l as F,m as M,n as U,c as a,a as o,p as c,q as L,v as T,F as N,s as S,t as l,d as _,o as n}from"./C6oO_Yjr.js";import{w as E}from"./BA3RTNws.js";import{u as q}from"./CXjijLyQ.js";const R={class:"mb-4 mt-3"},z={key:0,class:"list-group"},Z=["onClick"],G={key:0,class:"alert alert-success"},H={key:1,class:"alert alert-warning"},J={key:2,class:"alert alert-danger"},Q={key:3},X={class:"card mb-3"},Y={class:"card-body"},ee={class:"row"},se={class:"col-md-4"},te={class:"col-md-4"},oe={key:0,class:"col-md-4"},le={class:"table table-sm"},ae={class:"p-2"},ne={class:"text-muted"},re={class:"mt-1"},ue=["onClick"],ie={class:"mt-4"},ce={key:0,class:"list-group"},de=["onClick"],me={class:"text-muted small"},ve={key:1,class:"mt-2"},fe={__name:"[[username]]",setup(ke){const I=B(),{$authFetch:v}=D(),p=q(),g=i([]),y=i([]),x=i([]),f=i(""),r=i(null),k=i(""),b=i([]),d=i(null),m=i({info:[],warning:[],error:[]}),w=K(()=>{const e=f.value.toLowerCase();return e?g.value.filter(s=>{var t,u;return((t=s.firstName)==null?void 0:t.toLowerCase().includes(e))||((u=s.lastName)==null?void 0:u.toLowerCase().includes(e))}):[]}),O=K(()=>y.value.map(e=>({...e,block:{...e.block,dayOfWeek:E[e.block.dayOfWeek]}})));F(async()=>{p.selectedPeriod&&(y.value=await v(`/courses?period-id=${p.selectedPeriod.id}`))}),M(async()=>{var s;g.value=await v("/users"),y.value=await v(`/courses?period-id=${p.selectedPeriod.id}`);const e=(s=I.params)==null?void 0:s.username;if(e){const t=decodeURIComponent(e);h({userName:t}),f.value=t}});function h(e){let s;if(typeof e=="string")s=e;else if(e!=null&&e.userName)s=e.userName;else return;const t=g.value.find(u=>u.userName===s);if(!t){console.warn(`Student mit userName '${s}' nicht gefunden`);return}r.value=t,f.value="",w.value=[],C()}async function C(){r.value&&(x.value=(await v(`/assignments?user-name=${r.value.userName}&period-id=${p.selectedPeriod.id}`)).map(e=>({...e,course:{...e.course,block:{...e.course.block,dayOfWeek:E[e.course.block.dayOfWeek]}}})))}function P(){const e=k.value.toLowerCase();b.value=O.value.filter(s=>s.name.toLowerCase().includes(e)||s.courseId.toString().includes(e))}function V(e){console.log("course selected: "+e.name),d.value=e,k.value="",b.value=[]}async function W(){if(!r.value||!d.value)return;const e=await v("/assignments",{method:"POST",body:{userName:r.value.userName,courseId:d.value.courseId}});$(e),await C(),d.value=null}async function j(e){console.log("deleting "+e);const s=await v(`/assignments/${e}`,{method:"DELETE"});$(s),await C()}function $(e){console.log("feedback: "+e.info),m.value={info:e.info||[],warning:e.warning||[],error:e.error||[]}}return U(()=>{var e;return(e=I.params)==null?void 0:e.username},e=>{if(e){const s=decodeURIComponent(String(e));h(s)}}),(e,s)=>(n(),a("div",{class:"container-fluid py-3",onKeydown:s[2]||(s[2]=(...t)=>e.onKeydown&&e.onKeydown(...t))},[s[10]||(s[10]=o("div",{class:"d-flex align-items-center justify-content-between mb-3"},[o("div",{class:"h4 m-0"},"Manuelle Zuweisungen")],-1)),o("div",R,[s[3]||(s[3]=o("label",{class:"form-label"},"Schülersuche",-1)),L(o("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),class:"form-control",placeholder:"Vorname oder Nachname"},null,512),[[T,f.value]]),w.value.length&&f.value?(n(),a("ul",z,[(n(!0),a(N,null,S(w.value,t=>(n(),a("li",{class:"list-group-item list-group-item-action",key:t.username,onClick:u=>h(t)},l(t.firstName)+" "+l(t.lastName)+" ("+l(t.userName)+") ",9,Z))),128))])):c("",!0)]),m.value.info.length?(n(),a("div",G,l(m.value.info.join(" ")),1)):c("",!0),m.value.warning.length?(n(),a("div",H,l(m.value.warning.join(" ")),1)):c("",!0),m.value.error.length?(n(),a("div",J,l(m.value.error.join(" ")),1)):c("",!0),r.value?(n(),a("div",Q,[o("h5",null,"Kurse von "+l(r.value.firstName)+" "+l(r.value.lastName),1),o("div",X,[o("div",Y,[s[7]||(s[7]=o("h6",{class:"card-subtitle mb-2 text-muted"},"Schülerinformationen",-1)),o("div",ee,[o("div",se,[s[4]||(s[4]=o("strong",null,"Klassenstufe:",-1)),_(" "+l(r.value.grade),1)]),o("div",te,[s[5]||(s[5]=o("strong",null,"Benutzername:",-1)),_(" "+l(r.value.userName),1)]),r.value.email?(n(),a("div",oe,[s[6]||(s[6]=o("strong",null,"E-Mail:",-1)),_(" "+l(r.value.email),1)])):c("",!0)])])]),o("table",le,[s[8]||(s[8]=o("thead",null,[o("tr",null,[o("th",null,"Kurs"),o("th",null,"Aktion")])],-1)),o("tbody",null,[(n(!0),a(N,null,S(x.value,t=>(n(),a("tr",{key:t.id},[o("td",null,[o("div",ae,[o("div",ne,l(t.course.block.dayOfWeek)+", "+l(t.course.block.startTime)+"-"+l(t.course.block.endTime),1),o("div",re,l(t.course.courseId)+": "+l(t.course.name),1)])]),o("td",null,[o("button",{class:"btn btn-danger btn-sm",onClick:u=>j(t.id)},"Entfernen",8,ue)])]))),128))])]),o("div",ie,[s[9]||(s[9]=o("label",{class:"form-label"},"Kurs hinzufügen",-1)),L(o("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>k.value=t),onInput:P,class:"form-control",placeholder:"Kursname oder Kurs-ID"},null,544),[[T,k.value]]),b.value.length&&k.value?(n(),a("ul",ce,[(n(!0),a(N,null,S(b.value,t=>{var u;return n(),a("li",{class:"list-group-item list-group-item-action",key:t.courseId,onClick:pe=>V(t)},[o("div",me,l((u=t.block)==null?void 0:u.dayOfWeek)+" "+l(t.block.startTime)+"-"+l(t.block.endTime),1),o("div",null,"["+l(t.courseId)+"] "+l(t.name),1)],8,de)}),128))])):c("",!0),d.value?(n(),a("div",ve,[_(l(d.value.courseId)+": "+l(d.value.name)+" ",1),o("button",{class:"btn btn-primary",onClick:W},"Zuweisen")])):c("",!0)])])):c("",!0)],32))}},ye=A(fe,[["__scopeId","data-v-50699cf6"]]);export{ye as default};
