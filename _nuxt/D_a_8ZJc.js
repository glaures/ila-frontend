import{e as F,i as j,r as _,m as z,k as N,n as D,c as a,a as e,p as b,t as v,q as E,C as $,F as w,s as C,v as Q,z as R,y as H,o as u,A as O,d as W,_ as G}from"./T0Q76loc.js";const J={class:"container py-3"},X={key:0,class:"alert alert-danger",role:"alert"},Y={key:1,class:"d-flex align-items-center gap-2 mb-3"},Z={key:2,class:"alert alert-warning"},ee={key:3,class:"row g-3"},se={class:"col-12 d-flex align-items-center gap-2 flex-wrap"},te={class:"btn-group",role:"group"},le=["disabled"],oe=["disabled"],ne=["value"],ae={class:"ms-auto d-flex align-items-center gap-2"},ue={class:"col-12 col-lg-6"},re={class:"card shadow-sm"},ce={class:"card-body"},ie={class:"d-flex align-items-center justify-content-between mb-2"},de={class:"h5 mb-0"},ve={class:"text-muted small"},me={class:"list-group"},pe=["onClick"],_e={class:"fw-semibold"},be={key:0,class:"badge bg-secondary ms-2"},fe={class:"small text-muted"},he={key:0,class:"col-12 col-lg-6"},ke={class:"card shadow-sm"},ge={class:"card-body"},Ie={class:"d-flex align-items-center justify-content-between mb-2"},ye={class:"h5 mb-0"},xe={class:"text-muted small"},Ne={class:"list-group"},we={class:"d-flex align-items-center gap-2"},Ce={class:"badge bg-light text-muted border"},Be={key:0,class:"badge bg-info text-dark"},Me={key:1,class:"col-12"},f="__PAUSE__",Ee="Mittagessen / Hofpause",Te=F({__name:"testrun",setup(Ae){const{$authFetch:T}=j(),B=R(),A=H(),g=_(!1),h=_(""),M=_([]),n=_([]),m=_(null),p=_(null),I=_("");async function U(){var s,o;g.value=!0,h.value="";try{const t=await T("/test-assignment");M.value=t??[],K();const r=Number(B.query.blockId),c=n.value.find(k=>k.blockId===r);m.value=c?c.blockId:((s=n.value[0])==null?void 0:s.blockId)??null;const l=B.query.courseId||null,i=y.value.find(k=>k.courseId===l);p.value=i?l:null}catch(t){h.value=((o=t==null?void 0:t.data)==null?void 0:o.message)||(t==null?void 0:t.message)||"Unbekannter Fehler beim Laden."}finally{g.value=!1}}z(U);function K(){const s=new Map;for(const t of M.value){const r=Number(t.blockId),c=t.pause?f:t.courseId??"unknown",l=t.pause?Ee:t.courseName??"Unbenannter Kurs";s.has(r)||s.set(r,new Map);const i=s.get(r);i.has(c)||i.set(c,{courseId:c,courseName:l,participants:[]}),i.get(c).participants.push({userName:t.userName,predefined:!!t.predefined,preferenceIndex:Number(t.preferenceIndex??0)})}const o=[];[...s.entries()].sort((t,r)=>t[0]-r[0]).forEach(([t,r])=>{const c=[...r.values()].map(l=>({...l,participants:l.participants.sort((i,k)=>i.userName.localeCompare(k.userName,"de"))})).sort((l,i)=>l.courseId===f&&i.courseId!==f?1:i.courseId===f&&l.courseId!==f?-1:l.courseName.localeCompare(i.courseName,"de"));o.push({blockId:t,courses:c})}),n.value=o}const L=N(()=>n.value.map(s=>({value:s.blockId,label:`Block ${s.blockId}`}))),d=N(()=>n.value.find(s=>s.blockId===m.value)||null),y=N(()=>{var t;const s=((t=d.value)==null?void 0:t.courses)??[];if(!I.value.trim())return s;const o=I.value.toLowerCase();return s.filter(r=>r.courseName.toLowerCase().includes(o))}),x=N(()=>y.value.find(s=>s.courseId===p.value)||null),P=s=>s.participants.length;D([m,p],([s,o])=>{const t={};s!=null&&(t.blockId=s),o&&(t.courseId=o),A.replace({query:t})});function S(){if(!d.value)return;const s=n.value.findIndex(o=>o.blockId===d.value.blockId);s>0&&(m.value=n.value[s-1].blockId,p.value=null)}function V(){if(!d.value)return;const s=n.value.findIndex(o=>o.blockId===d.value.blockId);s>=0&&s<n.value.length-1&&(m.value=n.value[s+1].blockId,p.value=null)}function q(s){p.value=s.courseId}return(s,o)=>{var t,r,c;return u(),a("div",J,[o[6]||(o[6]=e("h1",{class:"h3 mb-3"},"Test‑Assignment Explorer",-1)),h.value?(u(),a("div",X,v(h.value),1)):b("",!0),g.value?(u(),a("div",Y,o[2]||(o[2]=[e("div",{class:"spinner-border",role:"status","aria-hidden":"true"},null,-1),e("span",null,"Lade Testdaten …",-1)]))):b("",!0),!g.value&&n.value.length===0&&!h.value?(u(),a("div",Z," Keine Daten vorhanden. ")):b("",!0),n.value.length?(u(),a("div",ee,[e("div",se,[e("div",te,[e("button",{class:"btn btn-outline-secondary",onClick:S,disabled:!d.value||n.value[0].blockId===((t=d.value)==null?void 0:t.blockId)}," ◀︎ Vorheriger Block ",8,le),e("button",{class:"btn btn-outline-secondary",onClick:V,disabled:!d.value||n.value[n.value.length-1].blockId===((r=d.value)==null?void 0:r.blockId)}," Nächster Block ▶︎ ",8,oe)]),e("div",null,[o[3]||(o[3]=e("label",{class:"form-label me-2 mb-0"},"Block",-1)),E(e("select",{class:"form-select d-inline-block w-auto","onUpdate:modelValue":o[0]||(o[0]=l=>m.value=l)},[(u(!0),a(w,null,C(L.value,l=>(u(),a("option",{key:l.value,value:l.value},v(l.label),9,ne))),128))],512),[[$,m.value,void 0,{number:!0}]])]),e("div",ae,[E(e("input",{class:"form-control",type:"search","onUpdate:modelValue":o[1]||(o[1]=l=>I.value=l),placeholder:"Kurs suchen…",style:{"min-width":"200px"}},null,512),[[Q,I.value]])])]),e("div",ue,[e("div",re,[e("div",ce,[e("div",ie,[e("h2",de,"Kurse im Block "+v((c=d.value)==null?void 0:c.blockId),1),e("span",ve,v(y.value.length)+" Kurse",1)]),e("ul",me,[(u(!0),a(w,null,C(y.value,l=>(u(),a("li",{key:l.courseId,class:O(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",{active:p.value===l.courseId}]),onClick:i=>q(l),role:"button"},[e("div",null,[e("div",_e,[W(v(l.courseName)+" ",1),l.courseId===f?(u(),a("span",be,"Pause")):b("",!0)]),e("div",fe,v(P(l))+" Teilnehmer",1)]),o[4]||(o[4]=e("span",{"aria-hidden":"true"},"›",-1))],10,pe))),128))])])])]),x.value?(u(),a("div",he,[e("div",ke,[e("div",ge,[e("div",Ie,[e("h2",ye,"Teilnehmer • "+v(x.value.courseName),1),e("span",xe,v(x.value.participants.length)+" Teilnehmer",1)]),e("ul",Ne,[(u(!0),a(w,null,C(x.value.participants,l=>(u(),a("li",{key:l.userName,class:"list-group-item d-flex justify-content-between align-items-center"},[e("div",we,[e("span",null,v(l.userName),1),e("span",Ce,"Präferenz "+v(l.preferenceIndex+1),1)]),l.predefined?(u(),a("span",Be,"vorgegeben")):b("",!0)]))),128))])])])])):(u(),a("div",Me,o[5]||(o[5]=[e("div",{class:"alert alert-info"}," Wähle links einen Kurs, um die Teilnehmer zu sehen. ",-1)])))])):b("",!0)])}}}),Ke=G(Te,[["__scopeId","data-v-90d5de3a"]]);export{Ke as default};
