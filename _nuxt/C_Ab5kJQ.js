import{j as U,c as l,o,a as e,m as d,y as Y,e as R,i as J,r as m,k as G,l as W,F as C,p as S,t as b,h as T,z as Q,n as X,A as Z,b as E,d as w}from"./AwnmPAjg.js";import{_ as K}from"./DlAUqK2U.js";import{u as ee}from"./DfOf_ssZ.js";import{w as V}from"./BA3RTNws.js";const te=["value","placeholder"],se={key:0,class:"invalid-feedback"},le={__name:"TimeInput",props:{modelValue:String,placeholder:{type:String,default:"HH:mm"},required:{type:Boolean,default:!1}},setup(k){const r=k,v=U(()=>!r.modelValue&&!r.required?!0:/^([01]\d|2[0-3]):[0-5]\d$/.test(r.modelValue));return(_,c)=>(o(),l("div",null,[e("input",{value:k.modelValue,onInput:c[0]||(c[0]=i=>_.$emit("update:modelValue",i.target.value)),type:"text",class:Y(["form-control",{"is-invalid":!v.value&&k.modelValue}]),placeholder:k.placeholder},null,42,te),!v.value&&k.modelValue?(o(),l("div",se," Bitte eine gültige Uhrzeit im Format HH:mm eingeben. ")):d("",!0)]))}},L=K(le,[["__scopeId","data-v-e6a2fb3a"]]),oe={class:"container-fluid py-3"},ae={class:"row g-3"},ne={class:"col-12 col-lg-5"},ie={class:"card shadow-sm"},de={class:"card-body"},ue={key:0,class:"text-muted"},re={key:1,class:"list-group"},ce=["onClick"],me={class:"fw-semibold"},ve={class:"text-muted"},be={key:0,class:"badge bg-light text-dark"},fe={key:0,class:"list-group-item text-muted"},ke={class:"col-12 col-lg-7"},pe={class:"card shadow-sm"},ye={class:"card-body"},_e={class:"card-title mb-3"},ge={key:0,class:"alert alert-warning"},he={class:"row g-3"},we={class:"col-md-6"},De=["value"],Be={class:"col-md-3"},Te={class:"col-md-3"},xe={class:"d-flex gap-2"},Ae=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm me-2"},Se=["disabled"],Ve={key:0,class:"spinner-border spinner-border-sm me-2"},Ie={key:2,class:"text-muted"},Oe={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true",style:{"background-color":"rgba(0,0,0,0.5)"}},Ne={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},$e={class:"modal-content"},ze={class:"modal-body"},Fe={class:"mb-3"},Pe={key:0},We={key:0,class:"text-muted"},Ee={key:1},Le={key:0},Ue={class:"list-group mb-3"},Ye={class:"d-flex justify-content-between"},Ke={key:0,class:"text-muted"},Me={class:"text-muted"},je={key:1,class:"alert alert-info"},qe={class:"modal-footer"},He=["disabled"],Re={key:0,class:"spinner-border spinner-border-sm me-2"},Je=R({__name:"bloecke",setup(k){const r=ee(),{$authFetch:v}=J(),_=m(!1),c=m([]),i=m(null),n=m(null),D=m(!1),p=m(!1),g=m(!1),B=m(!1),x=m([]),M=Object.keys(V),I={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7},O=a=>`${V[a.dayOfWeek]??a.dayOfWeek} ${a.startTime}–${a.endTime}`,u=U(()=>c.value.find(a=>a.id===i.value)||null);function N(){var t;return{periodId:((t=r.selectedPeriod)==null?void 0:t.id)??0,dayOfWeek:"MONDAY",startTime:"08:00",endTime:"09:00"}}function A(){u.value?n.value=JSON.parse(JSON.stringify(u.value)):n.value=N()}async function h(){var t;const a=(t=r.selectedPeriod)==null?void 0:t.id;if(!a){c.value=[],i.value=null,n.value=null;return}_.value=!0;try{const s=await v(`/blocks?period-id=${a}`),y=Array.isArray(s)?s:[];y.sort((f,F)=>{const P=(I[f.dayOfWeek]??99)-(I[F.dayOfWeek]??99);return P!==0?P:f.startTime.localeCompare(F.startTime)}),c.value=y,i.value!=null&&!c.value.some(f=>f.id===i.value)&&(i.value=null),A()}finally{_.value=!1}}function $(){i.value=null,n.value=N()}async function j(){if(!(!n.value||!n.value.periodId)){D.value=!0;try{const a={periodId:n.value.periodId,dayOfWeek:n.value.dayOfWeek,startTime:n.value.startTime,endTime:n.value.endTime};if(n.value.id)await v(`/blocks/${n.value.id}`,{method:"PUT",body:a});else{const t=await v("/blocks",{method:"POST",body:a});await h(),t!=null&&t.id&&(i.value=t.id,A());return}await h()}finally{D.value=!1}}}async function q(){var a;if((a=u.value)!=null&&a.id){g.value=!0,B.value=!0;try{const t=await v(`/courses?block-id=${u.value.id}`),s=Array.isArray(t)?t:[];x.value=s.sort((y,f)=>(y.name??"").localeCompare(f.name??"")||(y.courseId??"").localeCompare(f.courseId??""))}finally{g.value=!1}}}async function H(){var a;if((a=u.value)!=null&&a.id){p.value=!0;try{await v(`/blocks/${u.value.id}`,{method:"DELETE"}),B.value=!1,i.value=null,await h()}finally{p.value=!1}}}function z(){B.value=!1}return G(async()=>{await h()}),W(()=>{var a;return(a=r.selectedPeriod)==null?void 0:a.id},async()=>{i.value=null,await h()}),W(i,()=>{A()}),(a,t)=>(o(),l("div",oe,[e("div",ae,[e("div",ne,[e("div",ie,[e("div",de,[e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t[3]||(t[3]=e("h5",{class:"mb-0"},"Blöcke",-1)),e("button",{class:"btn btn-sm btn-outline-primary",onClick:$},"Neu")]),_.value?(o(),l("div",ue,"Lade Blöcke…")):(o(),l("ul",re,[(o(!0),l(C,null,S(c.value,s=>(o(),l("li",{key:s.id,class:Y(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",{active:s.id===i.value}]),role:"button",onClick:y=>i.value=s.id??null},[e("div",null,[e("div",me,b(O(s)),1),e("small",ve,"ID: "+b(s.id),1)]),s.id===i.value?(o(),l("span",be,"ausgewählt")):d("",!0)],10,ce))),128)),c.value.length?d("",!0):(o(),l("li",fe," Keine Blöcke gefunden. "))]))])])]),e("div",ke,[e("div",pe,[e("div",ye,[e("h5",_e,b(u.value?"Block bearbeiten":"Neuen Block anlegen"),1),T(r).selectedPeriod?d("",!0):(o(),l("div",ge," Bitte wähle zuerst eine Phase (Period), um Blöcke anzuzeigen oder anzulegen. ")),n.value&&T(r).selectedPeriod?(o(),l("form",{key:1,onSubmit:Q(j,["prevent"]),class:"vstack gap-3"},[e("div",he,[e("div",we,[t[4]||(t[4]=e("label",{class:"form-label"},"Wochentag",-1)),X(e("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.dayOfWeek=s),required:""},[(o(!0),l(C,null,S(T(M),s=>(o(),l("option",{key:s,value:s},b(T(V)[s]),9,De))),128))],512),[[Z,n.value.dayOfWeek]])]),e("div",Be,[t[5]||(t[5]=e("label",{class:"form-label"},"Startzeit",-1)),E(L,{modelValue:n.value.startTime,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.startTime=s),required:""},null,8,["modelValue"])]),e("div",Te,[t[6]||(t[6]=e("label",{class:"form-label"},"Endzeit",-1)),E(L,{modelValue:n.value.endTime,"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.endTime=s),required:""},null,8,["modelValue"])])]),e("div",xe,[e("button",{class:"btn btn-success",type:"submit",disabled:D.value},[D.value?(o(),l("span",Ce)):d("",!0),t[7]||(t[7]=w(" Speichern "))],8,Ae),u.value?(o(),l("button",{key:0,class:"btn btn-outline-danger",type:"button",disabled:p.value||g.value,onClick:q},[p.value||g.value?(o(),l("span",Ve)):d("",!0),t[8]||(t[8]=w(" Löschen "))],8,Se)):d("",!0),e("button",{class:"btn btn-outline-secondary ms-auto",type:"button",onClick:$}," Abbrechen / Neu ")])],32)):(o(),l("div",Ie,"Kein Formular verfügbar."))])])])]),B.value?(o(),l("div",Oe,[e("div",Ne,[e("div",$e,[e("div",{class:"modal-header"},[t[9]||(t[9]=e("h5",{class:"modal-title"},"Block wirklich löschen?",-1)),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:z})]),e("div",ze,[e("p",Fe,[t[10]||(t[10]=w(" Dieser Block ist ausgewählt: ")),u.value?(o(),l("strong",Pe,b(O(u.value)),1)):d("",!0)]),g.value?(o(),l("div",We,"Lade verknüpfte Kurse…")):(o(),l("div",Ee,[x.value.length?(o(),l("div",Le,[t[11]||(t[11]=e("p",{class:"mb-2"}," Folgende Kurse sind diesem Block zugeordnet und verlieren bei einer Löschung ihre Blockzuweisung: ",-1)),e("ul",Ue,[(o(!0),l(C,null,S(x.value,s=>(o(),l("li",{key:s.id,class:"list-group-item"},[e("div",Ye,[e("span",null,[e("strong",null,b(s.name??"Unbenannter Kurs"),1),s.courseId?(o(),l("span",Ke," ("+b(s.courseId)+")",1)):d("",!0)]),e("small",Me,"ID: "+b(s.id),1)])]))),128))]),t[12]||(t[12]=e("div",{class:"alert alert-warning"},[e("strong",null,"Achtung:"),w(" Diese Kurse müssen anschließend neu einem Block zugeordnet werden. ")],-1))])):(o(),l("div",je," Für diesen Block sind aktuell keine Kurse zugeordnet. "))]))]),e("div",qe,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:z},"Abbrechen"),e("button",{class:"btn btn-danger",type:"button",disabled:p.value,onClick:H},[p.value?(o(),l("span",Re)):d("",!0),t[13]||(t[13]=w(" Ja, endgültig löschen "))],8,He)])])])])):d("",!0)]))}}),et=K(Je,[["__scopeId","data-v-a8adaca1"]]);export{et as default};
