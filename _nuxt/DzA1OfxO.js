import{u as U}from"./BoVQibF0.js";import{e as T,i as z,j as G,g as j,k as h,r as m,m as O,n as V,c as a,a as e,t as n,d as g,F as N,p,C as c,s as I,o as i}from"./BtCKYhO9.js";const M={class:"container-fluid py-4"},H={class:"d-flex justify-content-between align-items-center mb-4"},X={class:"text-muted mb-0"},K=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm me-2"},J={key:1,class:"bi bi-play-fill me-1"},Q={key:0,class:"alert alert-warning"},Y={class:"row g-3 mb-4"},q={class:"col-md-3"},ee={class:"card h-100 border-0 shadow-sm"},se={class:"card-body"},te={class:"d-flex align-items-center"},le={class:"flex-grow-1 ms-3"},ne={class:"mb-0"},ae={class:"col-md-3"},ie={class:"card h-100 border-0 shadow-sm"},oe={class:"card-body"},de={class:"d-flex align-items-center"},ce={class:"flex-grow-1 ms-3"},re={class:"mb-0"},ue={class:"col-md-3"},he={class:"card h-100 border-0 shadow-sm"},ve={class:"card-body"},be={class:"d-flex align-items-center"},me={class:"flex-grow-1 ms-3"},ge={class:"mb-0"},fe={class:"col-md-3"},_e={class:"card h-100 border-0 shadow-sm"},xe={class:"card-body"},pe={class:"d-flex align-items-center"},ye={class:"flex-shrink-0"},ke={class:"flex-grow-1 ms-3"},we={key:0,class:"text-muted"},Ee={key:0,class:"alert alert-info d-flex align-items-center mb-4"},Le={class:"nav nav-tabs mb-3"},Ne={class:"nav-item"},Pe={class:"badge bg-warning text-dark ms-1"},We={class:"nav-item"},De={class:"card shadow-sm"},Fe={class:"card-body p-0"},Ie={key:0,class:"text-muted p-4"},Ae={key:1,class:"table-responsive"},Ce={class:"table table-hover mb-0"},Re={class:"fw-medium"},Se={class:"badge bg-light text-dark ms-1"},$e={class:"d-flex flex-wrap gap-1"},Be={class:"small text-muted"},Ue={key:0,class:"text-success small"},Te={key:1,class:"text-danger small"},ze={key:2,class:"text-muted"},Ge=["onClick"],je={key:0},He=T({__name:"wechselrunde",setup(Oe){const{$authFetch:y}=z(),P=U(),W=G(),k=j(),o=h(()=>P.selectedPeriod),r=m([]),v=m("pending"),f=m(!1),w=m(!1),u=m(null),_=h(()=>{const t=o.value;return!(t!=null&&t.exchangePhaseStart)||!(t!=null&&t.exchangePhaseEnd)?!1:t.exchangePhaseActive===!0}),E=h(()=>{const t=o.value;return!(t!=null&&t.exchangePhaseStart)||!(t!=null&&t.exchangePhaseEnd)?null:{start:t.exchangePhaseStart,end:t.exchangePhaseEnd,active:t.exchangePhaseActive===!0}}),b=h(()=>{const t=r.value.filter(l=>l.status==="PENDING").length,s=r.value.filter(l=>l.status==="FULFILLED").length,d=r.value.filter(l=>l.status==="UNFULFILLABLE").length;return{pending:t,fulfilled:s,unfulfillable:d}}),D=h(()=>v.value==="pending"?r.value.filter(t=>t.status==="PENDING"):r.value),A=h(()=>b.value.pending>0),x=async()=>{var t;if(o.value){w.value=!0;try{const s=await y(`/exchange/admin/all?periodId=${o.value.id}`);r.value=s}catch(s){k.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler beim Laden der Daten")}finally{w.value=!1}}},C=async()=>{var t;if(o.value&&confirm("Möchtest du die Wechselrunde jetzt auflösen? Dieser Vorgang kann nicht rückgängig gemacht werden.")){f.value=!0;try{const s=await y(`/exchange/admin/resolve?periodId=${o.value.id}`,{method:"POST"});u.value=s,W.success(`${s.fulfilled} von ${s.totalRequests} Wünschen erfüllt`),await x()}catch(s){k.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler bei der Auflösung")}finally{f.value=!1}}},R=async(t,s)=>{var d;if(confirm(`Möchtest du den Wechselwunsch von ${s} wirklich löschen?`))try{await y(`/exchange/admin/${t}`,{method:"DELETE"}),W.success("Wechselwunsch wurde gelöscht"),await x()}catch(l){k.show(((d=l==null?void 0:l.data)==null?void 0:d.message)??"Fehler beim Löschen des Wechselwunsches")}},S=t=>t?new Date(t).toLocaleString("de-DE",{dateStyle:"short",timeStyle:"short"}):"—",$=t=>({PENDING:"bg-warning text-dark",FULFILLED:"bg-success",UNFULFILLABLE:"bg-danger",EXPIRED:"bg-secondary",WITHDRAWN:"bg-light text-dark border"})[t]||"bg-secondary",B=t=>({PENDING:"Offen",FULFILLED:"Erfüllt",UNFULFILLABLE:"Nicht möglich",EXPIRED:"Abgelaufen",WITHDRAWN:"Zurückgezogen"})[t]||t;return O(()=>{x()}),V(()=>{var t;return(t=P.selectedPeriod)==null?void 0:t.id},()=>{x()}),(t,s)=>{var d;return i(),a("div",M,[e("div",H,[e("div",null,[s[2]||(s[2]=e("h1",{class:"h3 mb-1"},"Wechselrunde verwalten",-1)),e("p",X,n((d=o.value)==null?void 0:d.name),1)]),e("div",null,[e("button",{class:"btn btn-success",disabled:!A.value||f.value,onClick:C},[f.value?(i(),a("span",Z)):(i(),a("i",J)),s[3]||(s[3]=g(" Auflösung starten "))],8,K)])]),o.value?(i(),a(N,{key:1},[e("div",Y,[e("div",q,[e("div",ee,[e("div",se,[e("div",te,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-primary bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-hourglass-split text-primary fs-4"})])],-1)),e("div",le,[s[4]||(s[4]=e("h6",{class:"text-muted mb-1"},"Offene Wünsche",-1)),e("h3",ne,n(b.value.pending),1)])])])])]),e("div",ae,[e("div",ie,[e("div",oe,[e("div",de,[s[7]||(s[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-success bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-check-circle text-success fs-4"})])],-1)),e("div",ce,[s[6]||(s[6]=e("h6",{class:"text-muted mb-1"},"Erfüllt",-1)),e("h3",re,n(b.value.fulfilled),1)])])])])]),e("div",ue,[e("div",he,[e("div",ve,[e("div",be,[s[9]||(s[9]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-danger bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-x-circle text-danger fs-4"})])],-1)),e("div",me,[s[8]||(s[8]=e("h6",{class:"text-muted mb-1"},"Nicht erfüllbar",-1)),e("h3",ge,n(b.value.unfulfillable),1)])])])])]),e("div",fe,[e("div",_e,[e("div",xe,[e("div",pe,[e("div",ye,[e("div",{class:c(["rounded-circle p-3",_.value?"bg-success bg-opacity-10":"bg-secondary bg-opacity-10"])},[e("i",{class:c(["fs-4",_.value?"bi bi-broadcast text-success":"bi bi-broadcast text-secondary"])},null,2)],2)]),e("div",ke,[s[10]||(s[10]=e("h6",{class:"text-muted mb-1"},"Phase",-1)),e("h5",{class:c(["mb-0",_.value?"text-success":"text-secondary"])},n(_.value?"Aktiv":"Inaktiv"),3),E.value?(i(),a("small",we,n(E.value.start)+" – "+n(E.value.end),1)):p("",!0)])])])])])]),u.value?(i(),a("div",Ee,[s[12]||(s[12]=e("i",{class:"bi bi-info-circle me-2"},null,-1)),e("div",null,[s[11]||(s[11]=e("strong",null,"Letzte Auflösung:",-1)),g(" "+n(u.value.fulfilled)+" von "+n(u.value.totalRequests)+" Wünschen erfüllt ("+n(u.value.fulfillmentRate.toFixed(1))+"%) in "+n(u.value.rounds)+" Runden ",1)])])):p("",!0),e("ul",Le,[e("li",Ne,[e("button",{class:c(["nav-link",{active:v.value==="pending"}]),onClick:s[0]||(s[0]=l=>v.value="pending")},[s[13]||(s[13]=g(" Offene Wünsche ")),e("span",Pe,n(b.value.pending),1)],2)]),e("li",We,[e("button",{class:c(["nav-link",{active:v.value==="all"}]),onClick:s[1]||(s[1]=l=>v.value="all")}," Alle Wünsche ",2)])]),e("div",De,[e("div",Fe,[w.value?(i(),a("div",Ie,"Lade Wechselwünsche…")):(i(),a("div",Ae,[e("table",Ce,[s[17]||(s[17]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Schüler"),e("th",null,"Gibt ab"),e("th",null,"Wunschliste"),e("th",null,"Status"),e("th",null,"Erstellt"),e("th",null,"Ergebnis"),e("th",null,"Aktionen")])],-1)),e("tbody",null,[(i(!0),a(N,null,I(D.value,l=>(i(),a("tr",{key:l.id},[e("td",Re,n(l.studentName),1),e("td",null,[g(n(l.currentCourseName)+" ",1),e("span",Se,n(l.currentBlockName),1)]),e("td",null,[e("div",$e,[(i(!0),a(N,null,I(l.desiredCourses,(L,F)=>(i(),a("span",{key:L.id,class:c(["badge",F===0?"bg-primary":"bg-secondary"])},n(F+1)+". "+n(L.name),3))),128))])]),e("td",null,[e("span",{class:c(["badge",$(l.status)])},n(B(l.status)),3)]),e("td",Be,n(S(l.createdAt)),1),e("td",null,[l.fulfilledWithCourseName?(i(),a("span",Ue,[s[14]||(s[14]=e("i",{class:"bi bi-check me-1"},null,-1)),g(" "+n(l.fulfilledWithCourseName),1)])):l.rejectionReason?(i(),a("span",Te,n(l.rejectionReason),1)):(i(),a("span",ze,"—"))]),e("td",null,[l.status==="PENDING"?(i(),a("button",{key:0,class:"btn btn-sm btn-outline-danger",onClick:L=>R(l.id,l.studentName),title:"Wechselwunsch löschen"},s[15]||(s[15]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Ge)):p("",!0)])]))),128)),D.value.length===0?(i(),a("tr",je,s[16]||(s[16]=[e("td",{colspan:"7",class:"text-center text-muted py-4"}," Keine Wechselwünsche vorhanden ",-1)]))):p("",!0)])])]))])])],64)):(i(),a("div",Q," Bitte wähle zuerst eine Phase, um die Wechselrunde zu verwalten. "))])}}});export{He as default};
