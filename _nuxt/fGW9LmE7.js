import{e as he,i as ye,g as ge,j as ke,k as E,r as d,l as we,m as xe,n as Z,c as a,a as l,p as m,d as v,q as i,v as w,F as I,s as K,x as Ae,y as $,t as u,z as Ce,A as Ne,o as r,_ as Ie}from"./DOMMAJn8.js";import{u as H}from"./DupvfXT0.js";import{w as J}from"./BA3RTNws.js";const Ke={class:"d-flex align-items-center justify-content-between mb-3"},Se=["disabled"],$e=["disabled"],_e={key:0,class:"alert alert-info"},Oe={key:0,class:"list-group position-absolute w-100 shadow",style:{"z-index":"20","max-height":"320px",overflow:"auto"}},Pe=["onClick"],Ue={class:"d-flex justify-content-between"},Ee={class:"badge bg-secondary me-2"},Te={key:0,class:"text-muted ms-2"},Le={key:1,class:"small text-muted mt-1"},De={class:"text-muted"},Fe={key:0,class:"small text-muted text-truncate"},Ve={key:0,class:"list-group-item text-muted"},Be={class:"card shadow-sm"},Ge={class:"card-body"},ze={class:"row g-3"},Me={class:"col-12 col-md-3"},qe={class:"col-12 col-md-5"},Re={class:"col-12 col-md-4"},We=["value"],je={class:"col-12"},Ze={class:"col-12 col-md-3"},He={class:"col-12 col-md-3"},Je={class:"col-12 col-md-3"},Qe={class:"col-12 col-md-3"},Xe=["value"],Ye=["value"],es={class:"col-12"},ss={class:"d-flex flex-wrap gap-3"},ls=["id","value"],ts=["for"],ns={class:"col-12"},os={class:"d-flex flex-wrap gap-3"},as=["id","value"],rs=["for"],us={class:"col-12"},is={class:"d-flex flex-wrap gap-3"},ds=["id","value"],cs=["for"],ms={class:"col-12"},vs={class:"form-check"},fs={class:"col-12"},ps={class:"form-check"},bs={key:1,class:"modal fade show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},hs={class:"modal-dialog modal-dialog-centered"},ys={class:"modal-content"},gs={class:"modal-body"},ks={key:0,class:"alert alert-warning mb-3"},ws={key:1,class:"text-danger mb-0"},xs=he({__name:"kurse",setup(As){const Q=["iLa","KuP","BuE","FuF"],X=[5,6,7,8,9,10,11,12],Y=["male","female","diverse"],x=Ne(),T=Ce(),{$authFetch:f}=ye(),p=ge(),L=ke(),G=H(),_=H(),y=E(()=>_.selectedId),A=d([]),z=d([]),O=d([]),M=d(null),C=d(null),g=d(null),N=d(!1),P=d(0),ee=E(()=>O.value.filter(t=>!t.roles.includes("STUDENT"))),S=d(""),k=d(!1),q=E(()=>{const t=S.value.trim().toLowerCase();return t?A.value.filter(e=>{const s=e.instructor?`${e.instructor.firstName} ${e.instructor.lastName}`.toLowerCase():"";return(e.courseId??"").toLowerCase().includes(t)||(e.name??"").toLowerCase().includes(t)||(e.description??"").toLowerCase().includes(t)||s.includes(t)}).slice(0,50):A.value.slice(0,20)}),n=d({courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:null,block:null,minAttendees:0,grades:[],placeholder:!1,excludedGenders:[],manualAssignmentOnly:!1}),se=E(()=>z.value.filter(t=>y.value!=null&&t.periodId===y.value));function le(t){return`${J[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`}function te(t){return t?`${J[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`:""}function ne(t){return`${t.courseId?`[${t.courseId}] `:""}${t.name??""}`}we(async()=>{G.selectedPeriod&&await R()});async function R(){var t,e;try{z.value=await f(`/blocks?period-id=${(t=G.selectedPeriod)==null?void 0:t.id}`)}catch(s){p.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Die Blöcke konnten nicht geladen werden: "+s)}}async function U(){var t;try{if(y.value==null){A.value=[];return}A.value=await f(`/courses?period-id=${y.value}`)}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}async function oe(){var t;try{O.value=await f("/users")}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Laden der Nutzer: "+e)}}function D(t){var e,s;M.value={...t},n.value={id:t.id,courseId:t.courseId??"",name:t.name??"",description:t.description??"",courseCategories:Array.isArray(t.courseCategories)?[...t.courseCategories]:[],maxAttendees:t.maxAttendees,room:t.room??"",instructor:t.instructor??null,block:t.block??null,minAttendees:typeof t.minAttendees=="number"?t.minAttendees:0,grades:Array.isArray(t.grades)?[...t.grades].sort((o,b)=>o-b):[],placeholder:!!t.placeholder,excludedGenders:Array.isArray(t.excludedGenders)?[...t.excludedGenders]:[],manualAssignmentOnly:!!t.manualAssignmentOnly},C.value=((e=t.block)==null?void 0:e.id)??null,g.value=((s=t.instructor)==null?void 0:s.userName)??null,S.value=ne(t),k.value=!1,T.replace({path:x.path,query:{id:String(t.id??"")}})}function F(){M.value=null,C.value=null,g.value=null,n.value={courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:null,block:null,minAttendees:0,grades:[],placeholder:!1,excludedGenders:[],manualAssignmentOnly:!1},S.value="",k.value=!1,T.replace({path:x.path,query:{}})}function ae(){n.value.id&&T.push(`/admin/kurs/${n.value.id}`)}function re(){var e,s;const t=[];return(e=n.value.courseId)!=null&&e.trim()||t.push("courseId ist Pflicht."),(s=n.value.name)!=null&&s.trim()||t.push("name ist Pflicht."),n.value.maxAttendees==null?t.push("maxAttendees ist Pflicht."):Number(n.value.maxAttendees)<1&&t.push("maxAttendees muss ≥ 1 sein."),(!n.value.courseCategories||n.value.courseCategories.length===0)&&t.push("Mindestens eine Kurskategorie wählen."),n.value.minAttendees!=null&&n.value.maxAttendees!=null&&Number(n.value.minAttendees)>Number(n.value.maxAttendees)&&t.push("minAttendees darf nicht größer als maxAttendees sein."),y.value==null&&t.push("Bitte oben eine Phase auswählen."),t}async function ue(){var e,s,o;const t=re();if(t.length){p.show(t.join(" "));return}try{const b=Array.from(new Set(n.value.grades??[])).sort((c,B)=>c-B),pe=n.value.id==null;let j=null;if(g.value){const c=O.value.find(B=>B.userName===g.value);c&&(j=c)}const V={courseId:n.value.courseId.trim(),name:n.value.name.trim(),description:((e=n.value.description)==null?void 0:e.trim())||"",courseCategories:[...n.value.courseCategories],maxAttendees:Number(n.value.maxAttendees),room:((s=n.value.room)==null?void 0:s.trim())||"",instructor:j,blockId:C.value!==null?C.value:null,minAttendees:Number(n.value.minAttendees??0),grades:b,placeholder:!!n.value.placeholder,excludedGenders:[...n.value.excludedGenders??[]],manualAssignmentOnly:!!n.value.manualAssignmentOnly};let h;if(pe)V.periodId=y.value,h=await f("/courses",{method:"POST",body:V}),L.success(`Kurs "${h.name}" wurde erfolgreich angelegt.`);else{const c=Number(n.value.id);h=await f(`/courses/${c}`,{method:"PUT",body:V}),L.success(`Kurs "${h.name}" wurde erfolgreich aktualisiert.`)}await U();const be=A.value.find(c=>h.id&&c.id===h.id||c.courseId===h.courseId)??h;D(be)}catch(b){p.show(((o=b==null?void 0:b.data)==null?void 0:o.message)??"Es ist ein interner Fehler aufgetreten: "+b)}}async function ie(t){var e;try{const s=await f(`/assignments?course-id=${t}`);if(typeof s=="number")return s;if(Array.isArray(s))return s.length;if(s&&typeof s=="object"){const o=s.count??s.total??s.size;if(typeof o=="number")return o}throw new Error("Unerwartetes Antwortformat von /assignments")}catch(s){throw p.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Fehler beim Laden der Zuordnungsanzahl: "+s),s}}async function de(){if(n.value.id==null){p.show("Kein Kurs ausgewählt oder Kurs hat keine Server-ID.");return}const t=Number(n.value.id);try{P.value=await ie(t),N.value=!0}catch{}}async function ce(){var s;if(n.value.id==null)return;const t=Number(n.value.id),e=n.value.name||"Kurs";try{await f(`/courses/${t}`,{method:"DELETE"}),await U(),N.value=!1,L.success(`Kurs "${e}" wurde erfolgreich gelöscht.`),F()}catch(o){p.show(((s=o==null?void 0:o.data)==null?void 0:s.message)??"Fehler beim Löschen: "+o)}}function W(){N.value=!1}function me(){const t=typeof x.query.id=="string"?x.query.id:typeof x.params.id=="string"?x.params.id:"";if(!t)return;const e=Number(t),s=A.value.find(o=>o.id===e);s&&D(s)}xe(async()=>{_.initialized||await _.loadPeriods(f),await oe(),await R(),await U(),me()}),Z(g,t=>{if(t){const e=O.value.find(s=>s.userName===t);n.value.instructor=e??null}else n.value.instructor=null}),Z(()=>_.selectedId,async()=>{await U(),F()});function ve(t){t.key==="Escape"&&(N.value?N.value=!1:k.value=!1)}function fe(t){const e=t.target.value;C.value=e?Number(e):null}return(t,e)=>(r(),a("div",{class:"container-fluid py-3",onKeydown:ve},[l("div",Ke,[e[17]||(e[17]=l("div",{class:"h4 m-0"},"Kurse",-1)),l("div",null,[l("button",{class:"btn btn-outline-secondary me-2",onClick:F},"Neuer Kurs"),l("button",{class:"btn btn-outline-danger me-2",disabled:!n.value.id,onClick:de},"Löschen",8,Se),l("button",{class:"btn btn-outline-primary me-2",disabled:!n.value.id,onClick:ae},e[16]||(e[16]=[l("i",{class:"bi bi-people me-1"},null,-1),v(" Teilnehmer verwalten ")]),8,$e),l("button",{class:"btn btn-primary",onClick:ue},"Speichern")])]),y.value==null?(r(),a("div",_e," Bitte oben eine Phase auswählen. Es werden erst dann Kurse geladen. ")):m("",!0),l("div",{class:"mb-3 position-relative",onFocusin:e[3]||(e[3]=s=>k.value=!0)},[e[18]||(e[18]=l("label",{class:"form-label fw-semibold"},"Kurssuche",-1)),i(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),onFocus:e[1]||(e[1]=s=>k.value=!0),onInput:e[2]||(e[2]=s=>k.value=!0),class:"form-control",type:"text",placeholder:"Suche nach ID, Name, Beschreibung oder Kursleiter ...",autocomplete:"off"},null,544),[[w,S.value]]),k.value?(r(),a("div",Oe,[(r(!0),a(I,null,K(q.value,s=>(r(),a("button",{key:s.id??s.courseId,class:"list-group-item list-group-item-action",onClick:o=>D(s)},[l("div",Ue,[l("div",null,[l("span",Ee,u(s.courseId),1),l("strong",null,u(s.name),1),s.instructor?(r(),a("small",Te," ("+u(s.instructor.firstName)+" "+u(s.instructor.lastName)+") ",1)):m("",!0),s.block?(r(),a("div",Le,u(te(s.block)),1)):m("",!0)]),l("small",De,"max: "+u(s.maxAttendees),1)]),s.description?(r(),a("div",Fe,u(s.description),1)):m("",!0)],8,Pe))),128)),q.value.length===0?(r(),a("div",Ve,"Keine Treffer")):m("",!0)])):m("",!0)],32),l("div",Be,[l("div",Ge,[l("div",ze,[l("div",Me,[e[19]||(e[19]=l("label",{class:"form-label"},[v("Kurs-ID "),l("span",{class:"text-danger"},"*")],-1)),i(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.courseId=s),class:"form-control",type:"text"},null,512),[[w,n.value.courseId]])]),l("div",qe,[e[20]||(e[20]=l("label",{class:"form-label"},[v("Name "),l("span",{class:"text-danger"},"*")],-1)),i(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.name=s),class:"form-control",type:"text"},null,512),[[w,n.value.name]])]),l("div",Re,[e[22]||(e[22]=l("label",{class:"form-label"},"Kursleiter",-1)),i(l("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),class:"form-select"},[e[21]||(e[21]=l("option",{value:null},"Kein Kursleiter",-1)),(r(!0),a(I,null,K(ee.value,s=>(r(),a("option",{key:s.userName,value:s.userName},u(s.firstName)+" "+u(s.lastName)+" ("+u(s.userName)+") ",9,We))),128))],512),[[Ae,g.value]]),e[23]||(e[23]=l("div",{class:"form-text"},"Nur Lehrer und Admins",-1))]),l("div",je,[e[24]||(e[24]=l("label",{class:"form-label"},"Beschreibung",-1)),i(l("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.description=s),class:"form-control",rows:"3"},null,512),[[w,n.value.description]])]),l("div",Ze,[e[25]||(e[25]=l("label",{class:"form-label"},[v("Max. Teilnehmer "),l("span",{class:"text-danger"},"*")],-1)),i(l("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.maxAttendees=s),class:"form-control",type:"number",min:"1"},null,512),[[w,n.value.maxAttendees,void 0,{number:!0}]])]),l("div",He,[e[26]||(e[26]=l("label",{class:"form-label"},"Min. Teilnehmer",-1)),i(l("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.minAttendees=s),class:"form-control",type:"number",min:"0"},null,512),[[w,n.value.minAttendees,void 0,{number:!0}]])]),l("div",Je,[e[27]||(e[27]=l("label",{class:"form-label"},"Raum",-1)),i(l("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.room=s),class:"form-control",type:"text"},null,512),[[w,n.value.room]])]),l("div",Qe,[e[29]||(e[29]=l("label",{class:"form-label"},"Block",-1)),l("select",{class:"form-select",value:C.value??"",onChange:fe},[e[28]||(e[28]=l("option",{value:""},"— kein Block zugewiesen —",-1)),(r(!0),a(I,null,K(se.value,s=>(r(),a("option",{key:s.id,value:s.id},u(le(s)),9,Ye))),128))],40,Xe)]),l("div",es,[e[30]||(e[30]=l("label",{class:"form-label d-block"},[v("Kategorien "),l("span",{class:"text-danger"},"*")],-1)),l("div",ss,[(r(),a(I,null,K(Q,s=>l("div",{key:s,class:"form-check"},[i(l("input",{class:"form-check-input",type:"checkbox",id:"cat-"+s,value:s,"onUpdate:modelValue":e[11]||(e[11]=o=>n.value.courseCategories=o)},null,8,ls),[[$,n.value.courseCategories]]),l("label",{class:"form-check-label",for:"cat-"+s},u(s),9,ts)])),64))])]),l("div",ns,[e[31]||(e[31]=l("label",{class:"form-label d-block"},"Klassenstufen",-1)),l("div",os,[(r(),a(I,null,K(X,s=>l("div",{key:s,class:"form-check"},[i(l("input",{class:"form-check-input",type:"checkbox",id:"grade-"+s,value:s,"onUpdate:modelValue":e[12]||(e[12]=o=>n.value.grades=o)},null,8,as),[[$,n.value.grades]]),l("label",{class:"form-check-label",for:"grade-"+s},u(s),9,rs)])),64))]),e[32]||(e[32]=l("div",{class:"form-text"},"Mehrfachauswahl möglich (5–12).",-1))]),l("div",us,[e[33]||(e[33]=l("label",{class:"form-label d-block"},"Ausgeschlossene Geschlechter",-1)),l("div",is,[(r(),a(I,null,K(Y,s=>l("div",{key:s,class:"form-check"},[i(l("input",{class:"form-check-input",type:"checkbox",id:"gender-"+s,value:s,"onUpdate:modelValue":e[13]||(e[13]=o=>n.value.excludedGenders=o)},null,8,ds),[[$,n.value.excludedGenders]]),l("label",{class:"form-check-label",for:"gender-"+s},u(s==="male"?"Männlich":s==="female"?"Weiblich":"Divers"),9,cs)])),64))]),e[34]||(e[34]=l("div",{class:"form-text"},"Wähle Geschlechter aus, die von diesem Kurs ausgeschlossen werden sollen.",-1))]),l("div",ms,[l("div",vs,[i(l("input",{class:"form-check-input",type:"checkbox",id:"manualAssignmentOnly","onUpdate:modelValue":e[14]||(e[14]=s=>n.value.manualAssignmentOnly=s)},null,512),[[$,n.value.manualAssignmentOnly]]),e[35]||(e[35]=l("label",{class:"form-check-label",for:"manualAssignmentOnly"},"Nur manuelle Zuweisung (von Präferenzverfahren ausschließen)",-1))]),e[36]||(e[36]=l("div",{class:"form-text ms-4"},"Wenn aktiviert, können Schüler*innen diesen Kurs nicht im Präferenzverfahren wählen und er muss manuell zugewiesen werden.",-1))]),l("div",fs,[l("div",ps,[i(l("input",{class:"form-check-input",type:"checkbox",id:"placeholder","onUpdate:modelValue":e[15]||(e[15]=s=>n.value.placeholder=s)},null,512),[[$,n.value.placeholder]]),e[37]||(e[37]=l("label",{class:"form-check-label",for:"placeholder"},"Platzhalter",-1))])])])])]),e[45]||(e[45]=l("div",{class:"py-3"},null,-1)),N.value?(r(),a("div",bs,[l("div",hs,[l("div",ys,[l("div",{class:"modal-header"},[e[38]||(e[38]=l("h5",{class:"modal-title"},"Kurs wirklich löschen?",-1)),l("button",{type:"button",class:"btn-close",onClick:W,"aria-label":"Schließen"})]),l("div",gs,[P.value>0?(r(),a("div",ks,[e[39]||(e[39]=l("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[40]||(e[40]=l("strong",null,"Achtung:",-1)),e[41]||(e[41]=v(" Es sind aktuell ")),l("strong",null,u(P.value),1),e[42]||(e[42]=v(" Schüler*innen diesem Kurs zugewiesen. "))])):m("",!0),l("p",null,[e[43]||(e[43]=v(" Bist Du sicher, dass Du den Kurs ")),l("strong",null,u(n.value.courseId?`[${n.value.courseId}] `:"")+u(n.value.name),1),e[44]||(e[44]=v(" löschen möchtest? "))]),P.value>0?(r(),a("p",ws," Alle Zuweisungen gehen dadurch verloren! ")):m("",!0)]),l("div",{class:"modal-footer"},[l("button",{type:"button",class:"btn btn-secondary",onClick:W},"Abbrechen"),l("button",{type:"button",class:"btn btn-danger",onClick:ce}," Kurs löschen ")])])])])):m("",!0)],32))}}),Ks=Ie(xs,[["__scopeId","data-v-7c8b69fa"]]);export{Ks as default};
