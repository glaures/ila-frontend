import{_ as A,ab as D,i as F,r,k as x,l as U,m as j,n as q,c as a,a as o,p as m,q as K,v as T,F as w,s as C,t as l,d as B,o as n}from"./kHrezA3u.js";import{w as O}from"./BA3RTNws.js";import{u as R}from"./CMSPGeyL.js";const M={class:"mb-4 mt-3"},z={key:0,class:"list-group"},Z=["onClick"],G={key:0,class:"alert alert-success"},H={key:1,class:"alert alert-warning"},J={key:2,class:"alert alert-danger"},Q={key:3},X={class:"table table-sm"},Y={class:"p-2"},ee={class:"text-muted"},se={class:"mt-1"},te=["onClick"],oe={class:"mt-4"},le={key:0,class:"list-group"},ae=["onClick"],ne={class:"text-muted small"},re={key:1,class:"mt-2"},ue={__name:"[[username]]",setup(ie){const N=D(),{$authFetch:v}=F(),p=R(),S=r([]),_=r([]),I=r([]),f=r(""),u=r(null),k=r(""),b=r([]),i=r(null),c=r({info:[],warning:[],error:[]}),h=x(()=>{const e=f.value;return e?S.value.filter(t=>{var s,d;return((s=t.firstName)==null?void 0:s.includes(e))||((d=t.lastName)==null?void 0:d.includes(e))}):[]}),E=x(()=>_.value.map(e=>({...e,block:{...e.block,dayOfWeek:O[e.block.dayOfWeek]}})));U(async()=>{p.selectedPeriod&&(_.value=await v(`/courses?period-id=${p.selectedPeriod.id}`))}),j(async()=>{var t;S.value=await v("/users"),_.value=await v(`/courses?period-id=${p.selectedPeriod.id}`);const e=(t=N.params)==null?void 0:t.username;if(e){const s=decodeURIComponent(e);y({userName:s}),f.value=s}});function y(e){u.value=e,f.value="",h.value=[],g()}async function g(){u.value&&(I.value=(await v(`/assignments?user-name=${u.value.userName}&period-id=${p.selectedPeriod.id}`)).map(e=>({...e,course:{...e.course,block:{...e.course.block,dayOfWeek:O[e.course.block.dayOfWeek]}}})))}function P(){const e=k.value.toLowerCase();b.value=E.value.filter(t=>t.name.toLowerCase().includes(e)||t.courseId.toString().includes(e))}function V(e){console.log("course selected: "+e.name),i.value=e,k.value="",b.value=[]}async function W(){if(!u.value||!i.value)return;const e=await v("/assignments",{method:"POST",body:{userName:u.value.userName,courseId:i.value.courseId}});$(e),await g(),i.value=null}async function L(e){console.log("deleting "+e);const t=await v(`/assignments/${e}`,{method:"DELETE"});$(t),await g()}function $(e){console.log("feedback: "+e.info),c.value={info:e.info||[],warning:e.warning||[],error:e.error||[]}}return q(()=>{var e;return(e=N.params)==null?void 0:e.username},e=>{if(e){const t=decodeURIComponent(String(e));y(t)}}),(e,t)=>(n(),a("div",{class:"container-fluid py-3",onKeydown:t[2]||(t[2]=(...s)=>e.onKeydown&&e.onKeydown(...s))},[t[6]||(t[6]=o("div",{class:"h4 m-0"},"Schüler",-1)),o("div",M,[t[3]||(t[3]=o("label",{class:"form-label"},"Schüler suchen",-1)),K(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),class:"form-control",placeholder:"Vorname oder Nachname"},null,512),[[T,f.value]]),h.value.length&&f.value?(n(),a("ul",z,[(n(!0),a(w,null,C(h.value,s=>(n(),a("li",{class:"list-group-item list-group-item-action",key:s.username,onClick:d=>y(s)},l(s.firstName)+" "+l(s.lastName)+" ("+l(s.userName)+") ",9,Z))),128))])):m("",!0)]),c.value.info.length?(n(),a("div",G,l(c.value.info.join(" ")),1)):m("",!0),c.value.warning.length?(n(),a("div",H,l(c.value.warning.join(" ")),1)):m("",!0),c.value.error.length?(n(),a("div",J,l(c.value.error.join(" ")),1)):m("",!0),u.value?(n(),a("div",Q,[o("h5",null,"Kurse von "+l(u.value.firstName)+" "+l(u.value.lastName),1),o("table",X,[t[4]||(t[4]=o("thead",null,[o("tr",null,[o("th",null,"Kurs"),o("th",null,"Aktion")])],-1)),o("tbody",null,[(n(!0),a(w,null,C(I.value,s=>(n(),a("tr",{key:s.id},[o("td",null,[o("div",Y,[o("div",ee,l(s.course.block.dayOfWeek)+", "+l(s.course.block.startTime)+"-"+l(s.course.block.endTime),1),o("div",se,l(s.course.courseId)+": "+l(s.course.name),1)])]),o("td",null,[o("button",{class:"btn btn-danger btn-sm",onClick:d=>L(s.id)},"Entfernen",8,te)])]))),128))])]),o("div",oe,[t[5]||(t[5]=o("label",{class:"form-label"},"Kurs hinzufügen",-1)),K(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onInput:P,class:"form-control",placeholder:"Kursname oder Kurs-ID"},null,544),[[T,k.value]]),b.value.length&&k.value?(n(),a("ul",le,[(n(!0),a(w,null,C(b.value,s=>{var d;return n(),a("li",{class:"list-group-item list-group-item-action",key:s.courseId,onClick:ce=>V(s)},[o("div",ne,l((d=s.block)==null?void 0:d.dayOfWeek)+" "+l(s.block.startTime)+"-"+l(s.block.endTime),1),o("div",null,"["+l(s.courseId)+"] "+l(s.name),1)],8,ae)}),128))])):m("",!0),i.value?(n(),a("div",re,[B(l(i.value.courseId)+": "+l(i.value.name)+" ",1),o("button",{class:"btn btn-primary",onClick:W},"Zuweisen")])):m("",!0)])])):m("",!0)],32))}},fe=A(ue,[["__scopeId","data-v-83c16ba0"]]);export{fe as default};
