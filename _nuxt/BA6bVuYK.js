import{e as Q,i as J,g as X,r as f,k as ee,j as se,c as a,a as o,n as u,m as w,q as c,F as I,p as S,d as _,T as D,x as te,s as oe,o as r,t as d}from"./CJBR_SS8.js";import{_ as le}from"./DlAUqK2U.js";const L={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},ne={class:"d-flex align-items-center justify-content-between mb-3"},ae=["disabled"],re={key:0,class:"list-group position-absolute w-100 shadow",style:{"z-index":"20","max-height":"320px",overflow:"auto"}},ue=["onClick"],ie={class:"d-flex justify-content-between"},de={class:"badge bg-secondary me-2"},ce={key:0,class:"text-muted ms-2"},me={key:1,class:"small text-muted mt-1"},ve={class:"text-muted"},fe={key:0,class:"small text-muted text-truncate"},pe={key:0,class:"list-group-item text-muted"},be={class:"card shadow-sm"},ye={class:"card-body"},ge={class:"row g-3"},he={class:"col-12 col-md-3"},ke={class:"col-12 col-md-5"},xe={class:"col-12 col-md-4"},we={class:"col-12"},Ae={class:"col-12 col-md-3"},Ce={class:"col-12 col-md-3"},Ie={class:"col-12 col-md-3"},Se={class:"col-12 col-md-3"},_e=["value"],Ne=["value"],De={class:"col-12"},Ee={class:"d-flex flex-wrap gap-3"},Te=["id","value"],Ue=["for"],$e={class:"col-12"},Fe={class:"d-flex flex-wrap gap-3"},Ke=["id","value"],Le=["for"],Ve={class:"col-12"},Be={class:"form-check"},Pe=Q({__name:"index",setup(Me){const V=["iLa","KuP","BuE","FuF"],B=[5,6,7,8,9,10,11,12],i=oe(),E=te(),{$authFetch:p}=J(),k=X(),b=f([]),T=f([]),U=f(null),y=f(null),x=f(""),m=f(!1),$=ee(()=>{const t=x.value.trim().toLowerCase();return t?b.value.filter(e=>(e.courseId??"").toLowerCase().includes(t)||(e.name??"").toLowerCase().includes(t)||(e.description??"").toLowerCase().includes(t)||(e.instructor??"").toLowerCase().includes(t)).slice(0,50):b.value.slice(0,20)}),l=f({courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1});async function N(){var t;try{b.value=await p("/courses")}catch(e){k.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}async function P(){var t;try{T.value=await p("/blocks")}catch(e){k.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}function M(t){return`${L[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`}function O(t){return t?`${L[t.dayOfWeek]??t.dayOfWeek} ${t.startTime}–${t.endTime}`:""}function q(t){return`${t.courseId?`[${t.courseId}] `:""}${t.name??""}`}function A(t){var e;U.value={...t},l.value={id:t.id,courseId:t.courseId??"",name:t.name??"",description:t.description??"",courseCategories:Array.isArray(t.courseCategories)?[...t.courseCategories]:[],maxAttendees:t.maxAttendees,room:t.room??"",instructor:t.instructor??"",block:t.block??null,minAttendees:typeof t.minAttendees=="number"?t.minAttendees:0,grades:Array.isArray(t.grades)?[...t.grades].sort((s,n)=>s-n):[],placeholder:!!t.placeholder},y.value=((e=t.block)==null?void 0:e.id)??null,x.value=q(t),m.value=!1,E.replace({path:i.path,query:{id:String(t.id??"")}})}function F(){U.value=null,y.value=null,l.value={courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1},x.value="",m.value=!1,E.replace({path:i.path,query:{}})}function R(){var e,s;const t=[];return(e=l.value.courseId)!=null&&e.trim()||t.push("courseId ist Pflicht."),(s=l.value.name)!=null&&s.trim()||t.push("name ist Pflicht."),l.value.maxAttendees===void 0||l.value.maxAttendees===null?t.push("maxAttendees ist Pflicht."):Number(l.value.maxAttendees)<1&&t.push("maxAttendees muss ≥ 1 sein."),(!l.value.courseCategories||l.value.courseCategories.length===0)&&t.push("Mindestens eine Kurskategorie wählen."),l.value.minAttendees!=null&&l.value.maxAttendees!=null&&Number(l.value.minAttendees)>Number(l.value.maxAttendees)&&t.push("minAttendees darf nicht größer als maxAttendees sein."),t}async function Y(){var v,C,K;if(R().length){k.show(err.join(" "));return}const e=Array.from(new Set(l.value.grades??[])).sort((h,H)=>h-H),s={courseId:l.value.courseId.trim(),name:l.value.name.trim(),description:((v=l.value.description)==null?void 0:v.trim())||"",courseCategories:[...l.value.courseCategories],maxAttendees:Number(l.value.maxAttendees),room:((C=l.value.room)==null?void 0:C.trim())||"",instructor:((K=l.value.instructor)==null?void 0:K.trim())||"",blockId:y.value!==null?y.value:null,minAttendees:Number(l.value.minAttendees??0),grades:e,placeholder:!!l.value.placeholder};let n;if(l.value.id!=null){const h=Number(l.value.id);n=await p(`/courses/${h}`,{method:"PUT",body:s})}else n=await p("/courses",{method:"POST",body:s});await N();const g=b.value.find(h=>n.id&&h.id===n.id||h.courseId===n.courseId)??n;A(g)}async function z(t){var e;try{const s=await p(`/assignments?course-id=${t}`);if(typeof s=="number")return s;if(Array.isArray(s))return s.length;if(s&&typeof s=="object"){const n=s.count??s.total??s.size;if(typeof n=="number")return n}throw new Error("Unerwartetes Antwortformat von /assignments")}catch(s){throw k.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Fehler beim Laden der Zuordnungsanzahl: "+s),s}}async function j(){if(l.value.id==null){k.show("Kein Kurs ausgewählt oder Kurs hat keine Server-ID.");return}const t=Number(l.value.id);try{const e=await z(t);if(e>0&&!window.confirm(`Es sind aktuell ${e} Schülerinnen diesem Kurs zugewiesen. Bist Du sicher, dass Du diesen Kurs löschen möchtest? Es gehen alle Zuweisungen dadurch verloren.`))return;await p(`/courses/${t}`,{method:"DELETE"}),await N(),F()}catch{}}function W(){const t=typeof i.query.id=="string"?i.query.id:"",e=typeof i.params.id=="string"?i.params.id:"",s=t||e;if(s){const g=Number(s),v=b.value.find(C=>C.id===g);if(v){A(v);return}}const n=typeof i.query.courseId=="string"?i.query.courseId:typeof i.params.courseId=="string"?i.params.courseId:"";if(n){const g=b.value.find(v=>v.courseId===n);g&&A(g)}}se(async()=>{await Promise.all([N(),P()]),W()});function G(t){t.key==="Escape"&&(m.value=!1)}function Z(t){const e=t.target.value;y.value=e?Number(e):null}return(t,e)=>(r(),a("div",{class:"container-fluid py-3",onKeydown:G},[o("div",ne,[e[14]||(e[14]=o("h1",{class:"h4 m-0"},"Kurse verwalten",-1)),o("div",null,[o("button",{class:"btn btn-outline-secondary me-2",onClick:F},"Neuer Kurs"),o("button",{class:"btn btn-outline-danger me-2",disabled:!l.value.id,onClick:j},"Löschen",8,ae),o("button",{class:"btn btn-primary",onClick:Y},"Speichern")])]),o("div",{class:"mb-3 position-relative",onFocusin:e[3]||(e[3]=s=>m.value=!0)},[e[15]||(e[15]=o("label",{class:"form-label fw-semibold"},"Kurs suchen",-1)),u(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),onFocus:e[1]||(e[1]=s=>m.value=!0),onInput:e[2]||(e[2]=s=>m.value=!0),class:"form-control",type:"text",placeholder:"Suche nach ID, Name, Beschreibung oder Kursleiter ...",autocomplete:"off"},null,544),[[c,x.value]]),m.value?(r(),a("div",re,[(r(!0),a(I,null,S($.value,s=>(r(),a("button",{key:s.id??s.courseId,class:"list-group-item list-group-item-action",onClick:n=>A(s)},[o("div",ie,[o("div",null,[o("span",de,d(s.courseId),1),o("strong",null,d(s.name),1),s.instructor?(r(),a("small",ce,"("+d(s.instructor)+")",1)):w("",!0),s.block?(r(),a("div",me,d(O(s.block)),1)):w("",!0)]),o("small",ve,"max: "+d(s.maxAttendees),1)]),s.description?(r(),a("div",fe,d(s.description),1)):w("",!0)],8,ue))),128)),$.value.length===0?(r(),a("div",pe,"Keine Treffer")):w("",!0)])):w("",!0)],32),o("div",be,[o("div",ye,[o("div",ge,[o("div",he,[e[16]||(e[16]=o("label",{class:"form-label"},[_("Kurs-ID "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.courseId=s),class:"form-control",type:"text"},null,512),[[c,l.value.courseId]])]),o("div",ke,[e[17]||(e[17]=o("label",{class:"form-label"},[_("Name "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.name=s),class:"form-control",type:"text"},null,512),[[c,l.value.name]])]),o("div",xe,[e[18]||(e[18]=o("label",{class:"form-label"},"Kursleiter",-1)),u(o("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.instructor=s),class:"form-control",type:"text"},null,512),[[c,l.value.instructor]])]),o("div",we,[e[19]||(e[19]=o("label",{class:"form-label"},"Beschreibung",-1)),u(o("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.description=s),class:"form-control",rows:"3"},null,512),[[c,l.value.description]])]),o("div",Ae,[e[20]||(e[20]=o("label",{class:"form-label"},[_("Max. Teilnehmer "),o("span",{class:"text-danger"},"*")],-1)),u(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.maxAttendees=s),class:"form-control",type:"number",min:"1"},null,512),[[c,l.value.maxAttendees,void 0,{number:!0}]])]),o("div",Ce,[e[21]||(e[21]=o("label",{class:"form-label"},"Min. Teilnehmer",-1)),u(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.minAttendees=s),class:"form-control",type:"number",min:"0"},null,512),[[c,l.value.minAttendees,void 0,{number:!0}]])]),o("div",Ie,[e[22]||(e[22]=o("label",{class:"form-label"},"Raum",-1)),u(o("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.room=s),class:"form-control",type:"text"},null,512),[[c,l.value.room]])]),o("div",Se,[e[24]||(e[24]=o("label",{class:"form-label"},"Block (optional)",-1)),o("select",{class:"form-select",value:y.value??"",onChange:Z},[e[23]||(e[23]=o("option",{value:""},"— kein Block zugewiesen —",-1)),(r(!0),a(I,null,S(T.value,s=>(r(),a("option",{key:s.id,value:s.id},d(M(s)),9,Ne))),128))],40,_e)]),o("div",De,[e[25]||(e[25]=o("label",{class:"form-label d-block"},[_("Kategorien "),o("span",{class:"text-danger"},"*")],-1)),o("div",Ee,[(r(),a(I,null,S(V,s=>o("div",{key:s,class:"form-check"},[u(o("input",{class:"form-check-input",type:"checkbox",id:"cat-"+s,value:s,"onUpdate:modelValue":e[11]||(e[11]=n=>l.value.courseCategories=n)},null,8,Te),[[D,l.value.courseCategories]]),o("label",{class:"form-check-label",for:"cat-"+s},d(s),9,Ue)])),64))])]),o("div",$e,[e[26]||(e[26]=o("label",{class:"form-label d-block"},"Klassenstufen",-1)),o("div",Fe,[(r(),a(I,null,S(B,s=>o("div",{key:s,class:"form-check"},[u(o("input",{class:"form-check-input",type:"checkbox",id:"grade-"+s,value:s,"onUpdate:modelValue":e[12]||(e[12]=n=>l.value.grades=n)},null,8,Ke),[[D,l.value.grades]]),o("label",{class:"form-check-label",for:"grade-"+s},d(s),9,Le)])),64))]),e[27]||(e[27]=o("div",{class:"form-text"},"Mehrfachauswahl möglich (5–12).",-1))]),o("div",Ve,[o("div",Be,[u(o("input",{class:"form-check-input",type:"checkbox",id:"placeholder","onUpdate:modelValue":e[13]||(e[13]=s=>l.value.placeholder=s)},null,512),[[D,l.value.placeholder]]),e[28]||(e[28]=o("label",{class:"form-check-label",for:"placeholder"},"Platzhalter",-1))])])])])]),e[29]||(e[29]=o("div",{class:"py-3"},null,-1))],32))}}),Re=le(Pe,[["__scopeId","data-v-f9f22de4"]]);export{Re as default};
