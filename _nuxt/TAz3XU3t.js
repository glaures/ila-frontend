import{e as C,i as j,g as M,j as N,r as u,c as i,a as e,p as k,B as m,A as v,h as n,t as f,d as b,o as r,_ as T}from"./kHrezA3u.js";const z={class:"container-fluid py-3"},E={class:"row"},A={class:"col-12"},O={class:"card"},J={class:"card-body"},V={key:0,class:"upload-content"},$={key:1,class:"selected-file"},W={class:"text-muted"},G={key:0,class:"mt-4 d-flex gap-2"},H=["disabled"],K={key:0},P={key:1},R=["disabled"],U={key:1,class:"mt-4"},Z={class:"alert-heading"},q={class:"mb-0"},L=C({__name:"beste-schule-import",setup(Q){const{$authFetch:D}=j(),_=M(),S=N(),d=u(null),o=u(null),p=u(!1),c=u(!1),a=u(null),w=()=>{var t;(t=d.value)==null||t.click()},x=t=>{const s=t.target;s.files&&s.files.length>0&&y(s.files[0])},B=t=>{var s;p.value=!1,(s=t.dataTransfer)!=null&&s.files&&t.dataTransfer.files.length>0&&y(t.dataTransfer.files[0])},y=t=>{if(!t.type.includes("json")&&!t.name.endsWith(".json")){_.show("Bitte wählen Sie eine JSON-Datei aus");return}o.value=t,a.value=null},h=()=>{o.value=null,a.value=null,d.value&&(d.value.value="")},F=t=>{if(t===0)return"0 Bytes";const s=1024,l=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(t)/Math.log(s));return Math.round(t/Math.pow(s,g)*100)/100+" "+l[g]},I=async()=>{var t,s;if(o.value){c.value=!0,a.value=null;try{const l=new FormData;l.append("file",o.value);const g=await D("/import/besteschule",{method:"POST",body:l});a.value={success:!0,message:"Die Daten wurden erfolgreich importiert."},S.success("Import erfolgreich abgeschlossen"),setTimeout(()=>{h()},2e3)}catch(l){a.value={success:!1,message:((t=l==null?void 0:l.data)==null?void 0:t.message)||"Es ist ein Fehler beim Import aufgetreten."},_.show(((s=l==null?void 0:l.data)==null?void 0:s.message)??"Es ist ein interner Fehler aufgetreten: "+l)}finally{c.value=!1}}};return(t,s)=>(r(),i("div",z,[s[8]||(s[8]=e("div",{class:"d-flex align-items-center justify-content-between mb-3"},[e("h1",{class:"h4 mb-0"},"Beste Schule Import")],-1)),e("div",E,[e("div",A,[e("div",O,[e("div",J,[e("div",{class:v(["upload-area",{"drag-over":n(p)}]),onDrop:m(B,["prevent"]),onDragover:s[0]||(s[0]=m(l=>p.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=m(l=>p.value=!1,["prevent"])),onClick:w},[n(o)?(r(),i("div",$,[s[4]||(s[4]=e("i",{class:"bi bi-file-earmark-text fs-1 text-success mb-3"},null,-1)),e("h5",null,f(n(o).name),1),e("p",W,f(F(n(o).size)),1),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m(h,["stop"])},s[3]||(s[3]=[e("i",{class:"bi bi-trash"},null,-1),b(" Entfernen ")]))])):(r(),i("div",V,s[2]||(s[2]=[e("i",{class:"bi bi-cloud-upload fs-1 text-primary mb-3"},null,-1),e("h5",null,"JSON-Datei hier ablegen",-1),e("p",{class:"text-muted"},"oder klicken zum Auswählen",-1),e("button",{type:"button",class:"btn btn-primary mt-2"}," Datei auswählen ",-1)])))],34),e("input",{ref_key:"fileInput",ref:d,type:"file",accept:".json,application/json",class:"d-none",onChange:x},null,544),n(o)?(r(),i("div",G,[e("button",{type:"button",class:"btn btn-success",disabled:n(c),onClick:I},[n(c)?(r(),i("span",K,s[5]||(s[5]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),b(" Wird hochgeladen... ")]))):(r(),i("span",P,s[6]||(s[6]=[e("i",{class:"bi bi-upload me-2"},null,-1),b(" Importieren ")])))],8,H),e("button",{type:"button",class:"btn btn-secondary",disabled:n(c),onClick:h}," Abbrechen ",8,R)])):k("",!0),n(a)?(r(),i("div",U,[e("div",{class:v(["alert",{"alert-success":n(a).success,"alert-danger":!n(a).success}])},[e("h5",Z,[e("i",{class:v(n(a).success?"bi bi-check-circle":"bi bi-x-circle")},null,2),b(" "+f(n(a).success?"Import erfolgreich":"Import fehlgeschlagen"),1)]),e("p",q,f(n(a).message),1)],2)])):k("",!0)])]),s[7]||(s[7]=e("div",{class:"card mt-4"},[e("div",{class:"card-body"},[e("h5",{class:"card-title"},"Hinweise"),e("ul",null,[e("li",null,"Es werden nur JSON-Dateien akzeptiert"),e("li",null,'Die Datei sollte das Format der "Beste Schule" App entsprechen'),e("li",null,"Der Import kann einige Zeit dauern, je nach Dateigröße")])])],-1))])])]))}}),Y=T(L,[["__scopeId","data-v-36e512db"]]);export{Y as default};
