const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Nngi8v_b.js","./entry.Cy85P2aQ.css"])))=>i.map(i=>d[i]);
import{e as se,g as te,j as le,i as ne,r as c,A as ae,k as F,m as oe,J as re,c as a,a as s,d,t as o,p as g,B as ie,F as P,s as L,C as B,q as K,v as de,x as z,o as r,_ as ue}from"./Nngi8v_b.js";const ce={class:"container-fluid py-3"},me={class:"d-flex align-items-center justify-content-between mb-3"},ve={class:"h4 m-0"},be={class:"card mb-3"},fe={key:0,class:"card-body"},pe={class:"row"},he={class:"col-md-6"},we={class:"col-md-6"},ge={key:0,class:"row"},ye={class:"col-12"},_e={class:"text-muted"},Ne={class:"row"},ke={class:"col-lg-7"},Ce={class:"card"},Te={class:"card-header"},xe={class:"d-flex align-items-center justify-content-between"},Ie={class:"mb-0"},$e={class:"card-body"},Pe={key:0,class:"text-center py-4"},Le={key:1,class:"alert alert-info"},Ae={key:2,class:"table-responsive"},De={class:"table table-hover"},Ee={class:"text-muted small"},Fe={class:"text-end"},Ke=["onClick","disabled"],Se={key:0},Me={key:1,class:"bi bi-trash"},Ue={class:"col-lg-5"},Be={class:"card mb-3"},ze={class:"card-body"},Qe={class:"mb-3"},Ve={class:"position-relative"},Re=["disabled"],je={key:0,class:"dropdown-menu show w-100 shadow",style:{"max-height":"300px","overflow-y":"auto"}},qe=["onClick"],Oe={class:"d-flex justify-content-between align-items-center"},He={class:"text-muted"},Je={class:"badge bg-secondary"},Ze={key:1,class:"dropdown-menu show w-100"},Ge={class:"form-text"},We=["disabled"],Xe={key:0},Ye={key:1},es={class:"card"},ss={class:"card-body"},ts={class:"mb-3"},ls=["value"],ns={class:"mb-3"},as=["disabled"],os=["value"],rs={key:0,class:"form-text"},is=["disabled"],ds={key:0},us={key:1},cs={class:"modal-dialog"},ms={class:"modal-content"},vs={class:"modal-body"},bs={key:0,class:"alert alert-warning"},fs={class:"text-muted"},ps=se({__name:"[id]",setup(hs){const b=te(),h=le(),Q=ae(),{$authFetch:f}=ne(),k=c(Q.params.id),u=c(null),w=c([]),S=c([]),C=c([]),M=c([]),A=c(!1),T=c(!1),x=c(null),I=c(!1),$=c(!1),y=c(!1),i=c({userName:"",searchQuery:"",showDropdown:!1}),m=c({selectedPeriodId:"",selectedCourseId:""}),p=c(null),D=c(null);let _=null;const V=F(()=>[...w.value].sort((l,e)=>{const n=`${l.lastName} ${l.firstName}`.toLowerCase(),t=`${e.lastName} ${e.firstName}`.toLowerCase();return n.localeCompare(t)})),R=F(()=>{if(!u.value)return"";const l=w.value.length;return l<u.value.minAttendees?"badge bg-danger":l>u.value.maxAttendees?"badge bg-warning":"badge bg-success"}),E=F(()=>{const l=i.value.searchQuery.toLowerCase().trim();if(!l)return[];const e=new Set(w.value.map(n=>n.userUserName));return M.value.filter(n=>!e.has(n.userName)).filter(n=>{const t=`${n.firstName} ${n.lastName}`.toLowerCase(),v=n.userName.toLowerCase();return t.includes(l)||v.includes(l)}).slice(0,10).sort((n,t)=>{const v=`${n.lastName} ${n.firstName}`.toLowerCase(),ee=`${t.lastName} ${t.firstName}`.toLowerCase();return v.localeCompare(ee)})});async function j(){var l;try{u.value=await f(`/courses/${k.value}`)}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden des Kurses: "+e)}}async function N(){var l;A.value=!0;try{w.value=await f(`/assignments?course-id=${k.value}`)}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Teilnehmer: "+e)}finally{A.value=!1}}async function q(){var l;try{S.value=await f("/periods")}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Perioden: "+e)}}async function O(){var l;y.value=!0;try{M.value=await f("/users")}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Benutzer: "+e)}finally{y.value=!1}}function H(l){i.value.userName=l.userName,i.value.searchQuery=`${l.lastName}, ${l.firstName} (${l.userName})`,i.value.showDropdown=!1}function U(){i.value.showDropdown=i.value.searchQuery.length>0,i.value.userName=""}function J(){setTimeout(()=>{i.value.showDropdown=!1},200)}async function Z(){var l;if(!m.value.selectedPeriodId){C.value=[];return}$.value=!0,m.value.selectedCourseId="";try{const e=await f(`/courses?period-id=${m.value.selectedPeriodId}`);C.value=e.filter(n=>n.id!==parseInt(k.value))}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Kurse: "+e)}finally{$.value=!1}}async function G(){var l,e;if(i.value.userName){T.value=!0;try{const n={userName:i.value.userName,courseId:(l=u.value)==null?void 0:l.courseId},t=await f("/assignments",{method:"POST",body:n});t.errors&&t.errors.length>0?t.errors.forEach(v=>b.show(v)):(t.warnings&&t.warnings.length>0&&t.warnings.forEach(v=>h.warning(v)),t.info&&t.info.length>0&&t.info.forEach(v=>h.info(v)),h.success(`Teilnehmer ${i.value.userName} wurde hinzugefügt`),i.value.userName="",i.value.searchQuery="",i.value.showDropdown=!1,await N())}catch(n){b.show(((e=n==null?void 0:n.data)==null?void 0:e.message)??"Fehler beim Hinzufügen des Teilnehmers: "+n)}finally{T.value=!1}}}function W(l){p.value=l,_&&_.show()}async function X(){var e;if(!p.value)return;const l=p.value.id;x.value=l;try{await f(`/assignments/${l}`,{method:"DELETE"}),h.success("Teilnehmer wurde entfernt"),_&&_.hide(),await N()}catch(n){b.show(((e=n==null?void 0:n.data)==null?void 0:e.message)??"Fehler beim Entfernen des Teilnehmers: "+n)}finally{x.value=null,p.value=null}}async function Y(){var l;if(m.value.selectedCourseId){I.value=!0;try{const e=await f(`/assignments/copy-assignments?source-course-id=${m.value.selectedCourseId}&destination-course-id=${k.value}`,{method:"POST"});e.errors&&e.errors.length>0&&e.errors.forEach(n=>b.show(n)),e.warnings&&e.warnings.length>0&&e.warnings.forEach(n=>h.warning(n,6e3)),e.info&&e.info.length>0&&e.info.forEach(n=>h.info(n,6e3)),(!e.errors||e.errors.length===0)&&(h.success("Teilnehmer wurden erfolgreich kopiert"),m.value.selectedPeriodId="",m.value.selectedCourseId="",C.value=[],await N())}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Kopieren der Teilnehmer: "+e)}finally{I.value=!1}}}return oe(async()=>{if(D.value){const{Modal:l}=await re(async()=>{const{Modal:e}=await import("./Nngi8v_b.js").then(n=>n.aM);return{Modal:e}},__vite__mapDeps([0,1]),import.meta.url);_=new l(D.value)}await Promise.all([j(),N(),q(),O()])}),(l,e)=>{var n;return r(),a("div",ce,[s("div",me,[s("h1",ve,[e[4]||(e[4]=s("i",{class:"bi bi-book me-2"},null,-1)),d(" "+o(((n=u.value)==null?void 0:n.name)||"Lade Kurs..."),1)]),s("div",null,[s("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=t=>l.$router.back())},e[5]||(e[5]=[s("i",{class:"bi bi-arrow-left me-1"},null,-1),d(" Zurück ")]))])]),s("div",be,[e[13]||(e[13]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},"Kursdetails")],-1)),u.value?(r(),a("div",fe,[s("div",pe,[s("div",he,[s("p",null,[e[6]||(e[6]=s("strong",null,"Kurs-ID:",-1)),d(" "+o(u.value.courseId),1)]),s("p",null,[e[7]||(e[7]=s("strong",null,"Dozent:",-1)),d(" "+o(u.value.instructor?`${u.value.instructor.firstName} ${u.value.instructor.lastName}`:"N/A"),1)]),s("p",null,[e[8]||(e[8]=s("strong",null,"Raum:",-1)),d(" "+o(u.value.room||"N/A"),1)])]),s("div",we,[s("p",null,[e[9]||(e[9]=s("strong",null,"Min. Teilnehmer:",-1)),d(" "+o(u.value.minAttendees),1)]),s("p",null,[e[10]||(e[10]=s("strong",null,"Max. Teilnehmer:",-1)),d(" "+o(u.value.maxAttendees),1)]),s("p",null,[e[11]||(e[11]=s("strong",null,"Aktuelle Teilnehmer:",-1)),s("span",{class:ie(R.value)},o(w.value.length),3)])])]),u.value.description?(r(),a("div",ge,[s("div",ye,[e[12]||(e[12]=s("p",null,[s("strong",null,"Beschreibung:")],-1)),s("p",_e,o(u.value.description),1)])])):g("",!0)])):g("",!0)]),s("div",Ne,[s("div",ke,[s("div",Ce,[s("div",Te,[s("div",xe,[s("h5",Ie,[e[14]||(e[14]=s("i",{class:"bi bi-people me-2"},null,-1)),d(" Teilnehmer ("+o(w.value.length)+") ",1)]),s("button",{class:"btn btn-sm btn-outline-secondary",onClick:N},e[15]||(e[15]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]))])]),s("div",$e,[A.value?(r(),a("div",Pe,e[16]||(e[16]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1)]))):w.value.length===0?(r(),a("div",Le,e[17]||(e[17]=[s("i",{class:"bi bi-info-circle me-2"},null,-1),d(" Dieser Kurs hat noch keine Teilnehmer. ")]))):(r(),a("div",Ae,[s("table",De,[e[21]||(e[21]=s("thead",null,[s("tr",null,[s("th",null,"Username"),s("th",null,"Vorname"),s("th",null,"Nachname"),s("th",{class:"text-end"},"Aktionen")])],-1)),s("tbody",null,[(r(!0),a(P,null,L(V.value,t=>(r(),a("tr",{key:t.id},[s("td",null,[d(o(t.userUserName),1),e[18]||(e[18]=s("br",null,null,-1)),s("span",Ee,"Klasse "+o(t.grade),1)]),s("td",null,o(t.firstName),1),s("td",null,o(t.lastName),1),s("td",Fe,[s("button",{class:"btn btn-sm btn-danger",onClick:v=>W(t),disabled:x.value===t.id},[x.value===t.id?(r(),a("span",Se,e[19]||(e[19]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1)]))):(r(),a("i",Me)),e[20]||(e[20]=d(" Entfernen "))],8,Ke)])]))),128))])])]))])])]),s("div",Ue,[s("div",Be,[e[27]||(e[27]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-person-plus me-2"}),d(" Teilnehmer hinzufügen ")])],-1)),s("div",ze,[s("form",{onSubmit:B(G,["prevent"])},[s("div",Qe,[e[24]||(e[24]=s("label",{for:"userSearch",class:"form-label"},"Teilnehmer suchen",-1)),s("div",Ve,[K(s("input",{type:"text",class:"form-control",id:"userSearch","onUpdate:modelValue":e[1]||(e[1]=t=>i.value.searchQuery=t),onInput:U,onFocus:U,onBlur:J,placeholder:"Name oder Username eingeben...",autocomplete:"off",disabled:y.value},null,40,Re),[[de,i.value.searchQuery]]),i.value.showDropdown&&E.value.length>0?(r(),a("div",je,[(r(!0),a(P,null,L(E.value,t=>(r(),a("button",{key:t.userName,type:"button",class:"dropdown-item",onClick:v=>H(t)},[s("div",Oe,[s("div",null,[s("strong",null,o(t.lastName)+", "+o(t.firstName),1),e[22]||(e[22]=s("br",null,null,-1)),s("small",He,o(t.userName),1)]),s("span",Je,"Klasse "+o(t.grade),1)])],8,qe))),128))])):g("",!0),i.value.showDropdown&&i.value.searchQuery&&E.value.length===0?(r(),a("div",Ze,e[23]||(e[23]=[s("div",{class:"dropdown-item text-muted"},[s("i",{class:"bi bi-search me-2"}),d(" Keine Benutzer gefunden ")],-1)]))):g("",!0)]),s("div",Ge,o(y.value?"Lade Benutzer...":"Suche nach Name oder Username"),1)]),s("button",{type:"submit",class:"btn btn-primary w-100",disabled:T.value||!i.value.userName||y.value},[T.value?(r(),a("span",Xe,e[25]||(e[25]=[s("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),d(" Füge hinzu... ")]))):(r(),a("span",Ye,e[26]||(e[26]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),d(" Teilnehmer hinzufügen ")])))],8,We)],32)])]),s("div",es,[e[36]||(e[36]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-copy me-2"}),d(" Teilnehmer kopieren ")])],-1)),s("div",ss,[s("form",{onSubmit:B(Y,["prevent"])},[s("div",ts,[e[29]||(e[29]=s("label",{for:"period",class:"form-label"},"Periode wählen",-1)),K(s("select",{class:"form-select",id:"period","onUpdate:modelValue":e[2]||(e[2]=t=>m.value.selectedPeriodId=t),onChange:Z,required:""},[e[28]||(e[28]=s("option",{value:""},"-- Bitte wählen --",-1)),(r(!0),a(P,null,L(S.value,t=>(r(),a("option",{key:t.id,value:t.id},o(t.name),9,ls))),128))],544),[[z,m.value.selectedPeriodId]])]),s("div",ns,[e[32]||(e[32]=s("label",{for:"sourceCourse",class:"form-label"},"Quellkurs wählen",-1)),K(s("select",{class:"form-select",id:"sourceCourse","onUpdate:modelValue":e[3]||(e[3]=t=>m.value.selectedCourseId=t),disabled:!m.value.selectedPeriodId||$.value,required:""},[e[30]||(e[30]=s("option",{value:""},"-- Bitte wählen --",-1)),(r(!0),a(P,null,L(C.value,t=>(r(),a("option",{key:t.id,value:t.id},o(t.name)+" ("+o(t.courseId)+") ",9,os))),128))],8,as),[[z,m.value.selectedCourseId]]),$.value?(r(),a("div",rs,e[31]||(e[31]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),d(" Lade Kurse... ")]))):g("",!0)]),s("button",{type:"submit",class:"btn btn-warning w-100",disabled:I.value||!m.value.selectedCourseId},[I.value?(r(),a("span",ds,e[33]||(e[33]=[s("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),d(" Kopiere... ")]))):(r(),a("span",us,e[34]||(e[34]=[s("i",{class:"bi bi-clipboard-check me-2"},null,-1),d(" Teilnehmer kopieren ")])))],8,is),e[35]||(e[35]=s("div",{class:"form-text mt-2"}," Alle Teilnehmer des gewählten Kurses werden zu diesem Kurs hinzugefügt. ",-1))],32)])])])]),s("div",{class:"modal fade",id:"confirmDeleteModal",tabindex:"-1",ref_key:"deleteModal",ref:D},[s("div",cs,[s("div",ms,[e[41]||(e[41]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Teilnehmer entfernen"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",vs,[e[38]||(e[38]=s("p",null,"Möchtest du wirklich folgenden Teilnehmer aus dem Kurs entfernen?",-1)),p.value?(r(),a("div",bs,[s("strong",null,o(p.value.firstName)+" "+o(p.value.lastName),1),e[37]||(e[37]=s("br",null,null,-1)),s("small",fs,o(p.value.userUserName),1)])):g("",!0)]),s("div",{class:"modal-footer"},[e[40]||(e[40]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Abbrechen ",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:X},e[39]||(e[39]=[s("i",{class:"bi bi-trash me-2"},null,-1),d(" Entfernen ")]))])])])],512)])}}}),gs=ue(ps,[["__scopeId","data-v-83ee5f04"]]);export{gs as default};
