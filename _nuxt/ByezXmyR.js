import{e as $,i as W,k as D,r as _,n as j,c as l,a as t,p as g,q as I,C as K,F as h,s as p,t as o,o as i,d as y,_ as M}from"./CZrh7myW.js";import{u as L}from"./WFmBwcvg.js";const P={class:"container-fluid py-3"},V={class:"d-flex align-items-center justify-content-between mb-3 d-print-none"},H={class:"btn-group"},q=["disabled"],z={key:0},Z={key:1},G=["disabled"],J={class:"card mb-4 d-print-none"},Q={class:"card-body"},X={class:"row g-3 align-items-end"},ee={class:"col-12 col-md-6"},te=["value"],se={key:0,class:"col-12 col-md-6"},ae={class:"text-muted small"},ne={key:0,class:"alert alert-info"},le={key:1,class:"alert alert-danger"},oe={key:2},ie={class:"d-flex align-items-center mb-2 d-print-none"},de={class:"h5 mb-0"},re={class:"badge bg-light text-dark ms-2"},ue={key:0,class:"row g-3"},ce={class:"card h-100 d-flex flex-column course-print-page"},me={class:"card-header d-none d-print-block bg-white border-0 pt-4"},ve={class:"mb-1 text-uppercase small text-muted"},fe={class:"h4 mb-1"},_e={class:"h5 mb-0"},ge={class:"card-body d-flex flex-column"},he={class:"d-flex justify-content-between align-items-start mb-2 d-print-none"},pe={class:"h6 mb-0"},ye={class:"badge bg-secondary"},be={class:"small text-muted mb-2"},ke={class:"d-flex justify-content-between align-items-center border-top pt-2 mb-1"},xe={class:"badge bg-light text-dark"},Ae={class:"mb-0 ps-3"},De={key:0,class:"small text-muted"},we={key:1,class:"alert alert-warning"},Ne=$({__name:"belegungen",setup(Se){const{$authFetch:b}=W(),S=L(),k=D(()=>S.selectedId),r=_(!1),m=_(null),v=_([]),d=_(""),f=_({}),c=_({}),B={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},x=s=>B[s]||s,w=D(()=>{const s=new Set(v.value.map(a=>a.dayOfWeek)),e=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];return Array.from(s).sort((a,n)=>e.indexOf(a)-e.indexOf(n))}),C=D(()=>v.value.filter(s=>s.dayOfWeek===d.value).sort((s,e)=>s.startTime.localeCompare(e.startTime)));function N(s){return`${s.startTime} – ${s.endTime}`}function T(s){if(s.instructor&&s.instructor.trim().length)return s.instructor;const e=s.teacher;return e&&(`${e.firstName??""} ${e.lastName??""}`.trim()||e.userName)||"—"}async function F(){if(!k.value){r.value=!1;return}m.value=null,r.value=!0;try{const s=await b(`/blocks?period-id=${k.value}`);v.value=s,!d.value&&v.value.length&&(d.value=w.value[0]||"",d.value&&await A(d.value))}catch(s){m.value=(s==null?void 0:s.message)||"Fehler beim Laden der Blöcke."}finally{r.value=!1}}async function Y(s){const e=await b(`/courses?block-id=${encodeURIComponent(s)}`);return f.value[s]=e,e}async function U(s){if(c.value[s])return c.value[s];const e=await b(`/assignments?course-id=${encodeURIComponent(s)}`);return e.sort((a,n)=>a.lastName===n.lastName?a.firstName.localeCompare(n.firstName,"de"):a.lastName.localeCompare(n.lastName,"de")),c.value[s]=e,e}async function A(s){m.value=null,r.value=!0;try{f.value={},c.value={};const e=v.value.filter(u=>u.dayOfWeek===s),n=(await Promise.all(e.map(u=>Y(u.id)))).flat();await Promise.all(n.map(u=>U(u.id)))}catch(e){m.value=(e==null?void 0:e.message)||"Fehler beim Laden der Kurse/Teilnehmer."}finally{r.value=!1}}function R(){d.value&&A(d.value)}function E(){window.print()}async function O(){d.value&&await A(d.value)}return j(k,s=>{s&&(v.value=[],d.value="",f.value={},c.value={},F())},{immediate:!0}),(s,e)=>(i(),l("div",P,[e[8]||(e[8]=t("div",{class:"d-flex align-items-center justify-content-between mb-3"},[t("div",{class:"h4 m-0"},"Kursbelegungen")],-1)),t("div",V,[t("div",H,[t("button",{class:"btn btn-outline-secondary",onClick:O,disabled:r.value},[r.value?(i(),l("span",Z,"Aktualisiere…")):(i(),l("span",z,"Neu laden"))],8,q),t("button",{class:"btn btn-primary",onClick:E,disabled:r.value||!d.value}," Drucken ",8,G)])]),t("div",J,[t("div",Q,[t("div",X,[t("div",ee,[e[2]||(e[2]=t("label",{class:"form-label",for:"daySelect"},"Wochentag",-1)),I(t("select",{id:"daySelect",class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),onChange:R},[e[1]||(e[1]=t("option",{disabled:"",value:""},"– Bitte wählen –",-1)),(i(!0),l(h,null,p(w.value,a=>(i(),l("option",{key:a,value:a},o(x(a)),9,te))),128))],544),[[K,d.value]])]),d.value?(i(),l("div",se,[t("div",ae," Es werden alle Blöcke am "+o(x(d.value))+" geladen. Für jeden Block werden die angebotenen Kurse und deren Teilnehmer angezeigt. ",1)])):g("",!0)])])]),r.value?(i(),l("div",ne,"Daten werden geladen …")):g("",!0),m.value?(i(),l("div",le,o(m.value),1)):g("",!0),!r.value&&d.value?(i(),l("div",oe,[(i(!0),l(h,null,p(C.value,a=>(i(),l("div",{key:a.id,class:"mb-4"},[t("div",ie,[t("h2",de,"Block "+o(N(a)),1),t("span",re,"ID: "+o(a.id),1)]),f.value[a.id]&&f.value[a.id].length?(i(),l("div",ue,[(i(!0),l(h,null,p(f.value[a.id],n=>(i(),l("div",{key:n.id,class:"col-12 col-md-6 col-lg-4"},[t("div",ce,[t("div",me,[t("div",ve,o(x(a.dayOfWeek)),1),t("h1",fe,o(N(a)),1),t("h2",_e,o(n.name),1)]),t("div",ge,[t("div",he,[t("h3",pe,o(n.name),1),t("span",ye,o(n.courseId),1)]),t("div",be,[t("div",null,[e[3]||(e[3]=y("Raum: ")),t("strong",null,o(n.room||"—"),1)]),t("div",null,[e[4]||(e[4]=y("Leitung: ")),t("strong",null,o(T(n)),1)]),t("div",null,[e[5]||(e[5]=y("Max. TN: ")),t("strong",null,o(n.maxAttendees),1)]),t("div",null,[e[6]||(e[6]=y("Klassen: ")),t("strong",null,o(n.grades.join(",")),1)])]),t("div",null,[t("div",ke,[e[7]||(e[7]=t("span",{class:"small text-muted"},"Teilnehmer",-1)),t("span",xe,o((c.value[n.id]||[]).length)+" / "+o(n.maxAttendees),1)]),t("ol",Ae,[(i(!0),l(h,null,p(c.value[n.id]||[],u=>(i(),l("li",{key:u.userUserName,class:"small"},o(u.lastName)+", "+o(u.firstName),1))),128)),(c.value[n.id]||[]).length===0?(i(),l("li",De,"(Keine Zuordnungen) ")):g("",!0)])])])])]))),128))])):(i(),l("div",we,"Für diesen Block sind keine Kurse hinterlegt."))]))),128))])):g("",!0)]))}}),Te=M(Ne,[["__scopeId","data-v-ffe90321"]]);export{Te as default};
