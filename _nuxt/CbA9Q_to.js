import{_ as A,x as C,c as d,o as r,a as e,v as k,n as B,y as N,q as f,g as _,t as c,F as q,r as I,z as M,A as L,b as T,B as U,C as z}from"./BPnDmx5t.js";import{u as j}from"./DFUtALeP.js";const G=["value","placeholder"],K={key:0,class:"invalid-feedback"},O={__name:"DateInput",props:{modelValue:String,placeholder:{type:String,default:"TT.MM.JJJJ"},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(b,{emit:v}){const m=b,V=v,$=n=>{const o=n.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!o)return n;const[u,i,g,D]=o,J=i.padStart(2,"0"),x=g.padStart(2,"0");return`${J}.${x}.${D}`},p=n=>{const o=$(n);V("update:modelValue",o)},y=C(()=>m.modelValue),l=C(()=>!m.modelValue&&!m.required?!0:/^\d{2}\.\d{2}\.\d{4}$/.test(m.modelValue));return(n,o)=>(r(),d("div",null,[e("input",{value:y.value,onInput:o[0]||(o[0]=u=>p(u.target.value)),type:"text",class:B(["form-control",{"is-invalid":!l.value&&b.modelValue}]),placeholder:b.placeholder},null,42,G),!l.value&&b.modelValue?(r(),d("div",K," Bitte ein gültiges Datum im Format TT.MM.JJJJ eingeben. ")):k("",!0)]))}},E=A(O,[["__scopeId","data-v-e9fcc0f2"]]),W={key:0,class:"alert alert-info"},X={key:1,class:"alert alert-danger"},Z={key:2,class:"table table-striped align-middle"},H={class:"text-center"},Q=["checked"],R=["onClick"],Y=["onClick"],ee={class:"text-end"},te={class:"col-md-4"},ae={class:"col-md-3"},le={class:"col-md-3"},se={class:"col-md-2 d-flex align-items-end"},ne={class:"form-check"},oe={class:"col-12"},ie={type:"submit",class:"btn btn-primary"},de={key:3,class:"alert alert-success mt-3"},re={key:4,class:"alert alert-danger mt-3"},me={__name:"phasen",async setup(b){let v,m;const{data:V,pending:$,error:p,refresh:y}=([v,m]=N(()=>j("http://localhost:8080/periods",{key:"phasen-fetch"},"$ijWAA0gXGb")),v=await v,m(),v),l=f({name:"",startDate:"",endDate:"",visible:!1}),n=f(!1),o=f(null),u=f(""),i=f(""),g=s=>/^\d{2}\.\d{2}\.\d{4}$/.test(s),D=s=>{const[t,a,h]=s.split(".").map(Number);return new Date(h,a-1,t)},J=async()=>{var h;if(u.value="",i.value="",!g(l.value.startDate)){i.value="Startdatum muss im Format TT.MM.JJJJ vorliegen.";return}if(!g(l.value.endDate)){i.value="Endedatum muss im Format TT.MM.JJJJ vorliegen.";return}const s=D(l.value.startDate),t=D(l.value.endDate);if(s>t){i.value="Das Startdatum darf nicht nach dem Enddatum liegen.";return}const a={id:n.value?o.value:void 0,name:l.value.name,startDate:l.value.startDate,endDate:l.value.endDate,visible:l.value.visible};n.value||delete a.id;try{n.value?(await $fetch(`http://localhost:8080/periods/${o.value}`,{method:"PUT",body:a}),u.value="Phase erfolgreich aktualisiert."):(await $fetch("http://localhost:8080/periods",{method:"POST",body:a}),u.value="Phase erfolgreich angelegt."),w(),await y()}catch(S){i.value=((h=S==null?void 0:S.data)==null?void 0:h.message)||"Fehler beim Speichern."}},x=s=>{l.value={name:s.name,startDate:s.startDate,endDate:s.endDate,visible:s.visible},o.value=s.id,n.value=!0,u.value="",i.value=""},F=()=>{w()},w=()=>{l.value={name:"",startDate:"",endDate:"",visible:!1},n.value=!1,o.value=null},P=async s=>{var t;if(confirm(`Soll die Phase "${s.name}" wirklich gelöscht werden?`))try{await $fetch(`http://localhost:8080/periods/${s.id}`,{method:"DELETE"}),await y(),u.value="Phase gelöscht."}catch(a){i.value=((t=a==null?void 0:a.data)==null?void 0:t.message)||"Fehler beim Löschen."}};return(s,t)=>(r(),d("div",null,[t[9]||(t[9]=e("h3",null,"Phasen verwalten",-1)),_($)?(r(),d("div",W,"Lade Phasen...")):_(p)?(r(),d("div",X,"Fehler beim Laden: "+c(_(p).message),1)):(r(),d("table",Z,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",null,"Sichtbar"),e("th",null,"Name"),e("th",null,"Zeitraum"),e("th",null,"Aktionen"),e("th",null,"Kurse")])],-1)),e("tbody",null,[(r(!0),d(q,null,I(_(V),a=>(r(),d("tr",{key:a.id},[e("td",H,[e("input",{class:"form-check-input",type:"checkbox",disabled:"",checked:a.visible},null,8,Q)]),e("td",null,c(a.name),1),e("td",null,[e("div",null,c(a.startDate),1),e("div",null,c(a.endDate),1)]),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:h=>x(a)},"Bearbeiten",8,R),e("button",{class:"btn btn-sm btn-outline-danger",onClick:h=>P(a)},"Löschen",8,Y)]),e("td",ee,c(a.courseCount),1)]))),128))])])),t[10]||(t[10]=e("hr",null,null,-1)),e("h4",null,c(n.value?"Phase bearbeiten":"Neue Phase anlegen"),1),e("form",{onSubmit:z(J,["prevent"]),class:"row g-3"},[e("div",te,[t[5]||(t[5]=e("label",{class:"form-label"},"Name",-1)),M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.name=a),type:"text",class:"form-control",required:""},null,512),[[L,l.value.name]])]),e("div",ae,[t[6]||(t[6]=e("label",{class:"form-label"},"Start",-1)),T(E,{modelValue:l.value.startDate,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.startDate=a),required:""},null,8,["modelValue"])]),e("div",le,[t[7]||(t[7]=e("label",{class:"form-label"},"Ende",-1)),T(E,{modelValue:l.value.endDate,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.endDate=a),required:""},null,8,["modelValue"])]),e("div",se,[e("div",ne,[M(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>l.value.visible=a),class:"form-check-input",type:"checkbox",id:"sichtbarCheck"},null,512),[[U,l.value.visible]]),t[8]||(t[8]=e("label",{class:"form-check-label",for:"sichtbarCheck"},"Sichtbar",-1))])]),e("div",oe,[e("button",ie,c(n.value?"Speichern":"Anlegen"),1),n.value?(r(),d("button",{key:0,type:"button",class:"btn btn-secondary ms-2",onClick:F}," Abbrechen ")):k("",!0)])],32),u.value?(r(),d("div",de,c(u.value),1)):k("",!0),i.value?(r(),d("div",re,c(i.value),1)):k("",!0)]))}};export{me as default};
