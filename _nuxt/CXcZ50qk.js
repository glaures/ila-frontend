import{e as w,g as _,A as y,D as S,E as i,G as o,c as $,a as d,o as b}from"./DNoNEisY.js";import{u as g}from"./WhEGl6zK.js";const T={class:"container py-5 text-center"},C=w({__name:"auth-redirect",async setup(U){var p;let e,t;const f=y(),h=_(),u=g(),l=f.query.code;if(l){const a=S(),n=`${a.public.baseUrl.replace(/\/$/,"")}${a.public.oauth.redirectPath}`;try{const{token:r,user:c,roles:s}=([e,t]=i(()=>$fetch(a.public.apiBase+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:{code:l,redirectUri:n}})),e=await e,t(),e);localStorage.setItem("jwt",r),u.setUsername(c.preferred_username),u.setName(c.name),u.setRoles(s),s.includes("ADMIN")?([e,t]=i(()=>o("/admin")),await e,t()):s.includes("COURSE_INSTRUCTOR")?([e,t]=i(()=>o("/instructor/attendance")),await e,t()):s.includes("STUDENT")?([e,t]=i(()=>m(a.public.apiBase,r)),await e,t()):([e,t]=i(()=>o("/preferences")),await e,t())}catch(r){h.show(((p=r==null?void 0:r.data)==null?void 0:p.message)??"Es ist ein interner Fehler aufgetreten: "+r),[e,t]=i(()=>o("/")),await e,t()}}async function m(a,n){try{const c=(await $fetch(a+"/periods",{headers:{Authorization:`Bearer ${n}`}})).find(s=>s.current);if(c){const s=await $fetch(`${a}/periods/${c.id}/exchange-phase`,{headers:{Authorization:`Bearer ${n}`}});if(s!=null&&s.active){await o("/wechselrunde");return}}}catch(r){console.warn("Konnte Wechselrunden-Status nicht prüfen:",r)}await o("/preferences")}return(a,n)=>(b(),$("div",T,n[0]||(n[0]=[d("div",{class:"spinner-border text-primary mb-3",role:"status"},[d("span",{class:"visually-hidden"},"Laden...")],-1),d("p",null,"Authentifiziere dich…",-1)])))}});export{C as default};
