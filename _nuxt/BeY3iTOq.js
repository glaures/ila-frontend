import{_ as A,ab as D,i as F,r,k as $,l as U,m as j,n as q,c as l,a as o,p as m,q as T,v as O,F as w,s as C,t as a,d as B,o as n}from"./Bt8ervS0.js";import{w as E}from"./BA3RTNws.js";import{u as R}from"./B4BVfnsQ.js";const z={class:"container mt-4"},M={class:"mb-4"},Z={key:0,class:"list-group"},G=["onClick"],H={key:0,class:"alert alert-success"},J={key:1,class:"alert alert-warning"},Q={key:2,class:"alert alert-danger"},X={key:3},Y={class:"table table-sm"},ee={class:"p-2"},se={class:"text-muted"},te={class:"mt-1"},oe=["onClick"],ae={class:"mt-4"},le={key:0,class:"list-group"},ne=["onClick"],re={class:"text-muted small"},ue={key:1,class:"mt-2"},ie={__name:"[[username]]",setup(ce){const N=D(),{$authFetch:v}=F(),p=R(),I=r([]),b=r([]),S=r([]),f=r(""),u=r(null),k=r(""),_=r([]),i=r(null),c=r({info:[],warning:[],error:[]}),h=$(()=>{const e=f.value;return e?I.value.filter(t=>{var s,d;return((s=t.firstName)==null?void 0:s.includes(e))||((d=t.lastName)==null?void 0:d.includes(e))}):[]}),K=$(()=>b.value.map(e=>({...e,block:{...e.block,dayOfWeek:E[e.block.dayOfWeek]}})));U(async()=>{p.selectedPeriod&&(b.value=await v(`/courses?period-id=${p.selectedPeriod.id}`))}),j(async()=>{var t;I.value=await v("/users"),b.value=await v(`/courses?period-id=${p.selectedPeriod.id}`);const e=(t=N.params)==null?void 0:t.username;if(e){const s=decodeURIComponent(e);g({userName:s}),f.value=s}});function g(e){u.value=e,f.value="",h.value=[],y()}async function y(){u.value&&(S.value=(await v(`/assignments?user-name=${u.value.userName}&period-id=${p.selectedPeriod.id}`)).map(e=>({...e,course:{...e.course,block:{...e.course.block,dayOfWeek:E[e.course.block.dayOfWeek]}}})))}function P(){const e=k.value.toLowerCase();_.value=K.value.filter(t=>t.name.toLowerCase().includes(e)||t.courseId.toString().includes(e))}function V(e){console.log("course selected: "+e.name),i.value=e,k.value="",_.value=[]}async function W(){if(!u.value||!i.value)return;const e=await v("/assignments",{method:"POST",body:{userName:u.value.userName,courseId:i.value.courseId}});x(e),await y(),i.value=null}async function L(e){console.log("deleting "+e);const t=await v(`/assignments/${e}`,{method:"DELETE"});x(t),await y()}function x(e){console.log("feedback: "+e.info),c.value={info:e.info||[],warning:e.warning||[],error:e.error||[]}}return q(()=>{var e;return(e=N.params)==null?void 0:e.username},e=>{if(e){const t=decodeURIComponent(String(e));g(t)}}),(e,t)=>(n(),l("div",z,[t[5]||(t[5]=o("h1",{class:"mb-4"},"Kurszuweisungen verwalten",-1)),o("div",M,[t[2]||(t[2]=o("label",{class:"form-label"},"Schüler suchen",-1)),T(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),class:"form-control",placeholder:"Vorname oder Nachname"},null,512),[[O,f.value]]),h.value.length&&f.value?(n(),l("ul",Z,[(n(!0),l(w,null,C(h.value,s=>(n(),l("li",{class:"list-group-item list-group-item-action",key:s.username,onClick:d=>g(s)},a(s.firstName)+" "+a(s.lastName)+" ("+a(s.userName)+") ",9,G))),128))])):m("",!0)]),c.value.info.length?(n(),l("div",H,a(c.value.info.join(" ")),1)):m("",!0),c.value.warning.length?(n(),l("div",J,a(c.value.warning.join(" ")),1)):m("",!0),c.value.error.length?(n(),l("div",Q,a(c.value.error.join(" ")),1)):m("",!0),u.value?(n(),l("div",X,[o("h5",null,"Kurse von "+a(u.value.firstName)+" "+a(u.value.lastName),1),o("table",Y,[t[3]||(t[3]=o("thead",null,[o("tr",null,[o("th",null,"Kurs"),o("th",null,"Aktion")])],-1)),o("tbody",null,[(n(!0),l(w,null,C(S.value,s=>(n(),l("tr",{key:s.id},[o("td",null,[o("div",ee,[o("div",se,a(s.course.block.dayOfWeek)+", "+a(s.course.block.startTime)+"-"+a(s.course.block.endTime),1),o("div",te,a(s.course.courseId)+": "+a(s.course.name),1)])]),o("td",null,[o("button",{class:"btn btn-danger btn-sm",onClick:d=>L(s.id)},"Entfernen",8,oe)])]))),128))])]),o("div",ae,[t[4]||(t[4]=o("label",{class:"form-label"},"Kurs hinzufügen",-1)),T(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onInput:P,class:"form-control",placeholder:"Kursname oder Kurs-ID"},null,544),[[O,k.value]]),_.value.length&&k.value?(n(),l("ul",le,[(n(!0),l(w,null,C(_.value,s=>{var d;return n(),l("li",{class:"list-group-item list-group-item-action",key:s.courseId,onClick:de=>V(s)},[o("div",re,a((d=s.block)==null?void 0:d.dayOfWeek)+" "+a(s.block.startTime)+"-"+a(s.block.endTime),1),o("div",null,"["+a(s.courseId)+"] "+a(s.name),1)],8,ne)}),128))])):m("",!0),i.value?(n(),l("div",ue,[B(a(i.value.courseId)+": "+a(i.value.name)+" ",1),o("button",{class:"btn btn-primary",onClick:W},"Zuweisen")])):m("",!0)])])):m("",!0)]))}},ke=A(ie,[["__scopeId","data-v-c0ca1dd4"]]);export{ke as default};
