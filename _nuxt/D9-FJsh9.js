import{_ as J,k as Z,c as s,o,a as t,p as u,A as Q,e as ae,i as ne,r as c,j as ie,m as de,n as M,h as w,F as A,s as V,t as v,B as re,q,C as H,b as j,d as k}from"./kHrezA3u.js";import{u as ue}from"./CMSPGeyL.js";import{w as F}from"./BA3RTNws.js";const ce=["value","placeholder"],ve={key:0,class:"invalid-feedback"},me={__name:"TimeInput",props:{modelValue:String,placeholder:{type:String,default:"HH:mm"},required:{type:Boolean,default:!1}},setup(_){const r=_,b=Z(()=>!r.modelValue&&!r.required?!0:/^([01]\d|2[0-3]):[0-5]\d$/.test(r.modelValue));return(D,m)=>(o(),s("div",null,[t("input",{value:_.modelValue,onInput:m[0]||(m[0]=d=>D.$emit("update:modelValue",d.target.value)),type:"text",class:Q(["form-control",{"is-invalid":!b.value&&_.modelValue}]),placeholder:_.placeholder},null,42,ce),!b.value&&_.modelValue?(o(),s("div",ve," Bitte eine g√ºltige Uhrzeit im Format HH:mm eingeben. ")):u("",!0)]))}},R=J(me,[["__scopeId","data-v-e6a2fb3a"]]),be={class:"container-fluid py-3"},pe={class:"row g-3"},fe={class:"col-12 col-lg-5"},ke={class:"card shadow-sm"},ye={class:"card-body"},_e={class:"d-flex justify-content-between align-items-center mb-2"},ge={class:"btn-group"},he=["disabled"],we={key:0,class:"alert alert-info alert-sm mb-2"},De={key:1,class:"text-muted"},Be={key:2,class:"list-group"},Ce=["onClick"],Pe={class:"fw-semibold"},Te={class:"text-muted"},Se={key:0,class:"badge bg-light text-dark"},xe={key:0,class:"list-group-item text-muted"},Ae={class:"col-12 col-lg-7"},Ve={class:"card shadow-sm"},Ie={class:"card-body"},Oe={class:"card-title mb-3"},Fe={key:0,class:"alert alert-warning"},Ne={class:"row g-3"},$e={class:"col-md-6"},ze=["value"],Ee={class:"col-md-3"},Ke={class:"col-md-3"},Le={class:"d-flex gap-2"},Ue=["disabled"],We={key:0,class:"spinner-border spinner-border-sm me-2"},Ye=["disabled"],Me={key:0,class:"spinner-border spinner-border-sm me-2"},qe={key:2,class:"text-muted"},He={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true",style:{"background-color":"rgba(0,0,0,0.5)"}},je={class:"modal-dialog modal-dialog-centered",role:"document"},Re={class:"modal-content"},Je={class:"modal-body"},Ze={class:"mb-3"},Qe={class:"mb-3"},Ge=["value"],Xe={class:"modal-footer"},et=["disabled"],tt={key:0,class:"spinner-border spinner-border-sm me-2"},lt={key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true",style:{"background-color":"rgba(0,0,0,0.5)"}},st={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},ot={class:"modal-content"},at={class:"modal-body"},nt={class:"mb-3"},it={key:0},dt={key:0,class:"text-muted"},rt={key:1},ut={key:0},ct={class:"list-group mb-3"},vt={class:"d-flex justify-content-between"},mt={key:0,class:"text-muted"},bt={class:"text-muted"},pt={key:1,class:"alert alert-info"},ft={class:"modal-footer"},kt=["disabled"],yt={key:0,class:"spinner-border spinner-border-sm me-2"},_t=ae({__name:"bloecke",setup(_){const r=ue(),{$authFetch:b}=ne(),D=c(!1),m=c([]),d=c(null),n=c(null),P=c(!1),g=c(!1),B=c(!1),T=c(!1),I=c([]),G=Object.keys(F),N={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7},$=a=>`${F[a.dayOfWeek]??a.dayOfWeek} ${a.startTime}‚Äì${a.endTime}`,p=Z(()=>m.value.find(a=>a.id===d.value)||null),S=c(!1),y=c(null),x=c(!1),C=c([]),z=ie();async function X(){try{const a=await b("/periods");C.value=a.filter(e=>{var i;return e.id!==((i=r.selectedPeriod)==null?void 0:i.id)}),C.value.sort((e,i)=>new Date(i.startDate).getTime()-new Date(e.startDate).getTime())}catch(a){console.error("Fehler beim Laden der Perioden:",a)}}function ee(){S.value=!0,X(),C.value.length>0&&(y.value=C.value[0].id)}async function te(){var a,e;if(!(!y.value||!((a=r.selectedPeriod)!=null&&a.id))){x.value=!0;try{await b("/blocks/copy-from-period",{method:"POST",params:{"source-period-id":y.value,"target-period-id":r.selectedPeriod.id}}),S.value=!1,await h(),z.success("Bl√∂cke erfolgreich kopiert!")}catch(i){z.error(((e=i==null?void 0:i.data)==null?void 0:e.message)??"Es ist ein interner Fehler aufgetreten: "+i)}finally{x.value=!1}}}function E(){S.value=!1,y.value=null}function K(){var e;return{periodId:((e=r.selectedPeriod)==null?void 0:e.id)??0,dayOfWeek:"MONDAY",startTime:"08:00",endTime:"09:00"}}function O(){p.value?n.value=JSON.parse(JSON.stringify(p.value)):n.value=K()}async function h(){var e;const a=(e=r.selectedPeriod)==null?void 0:e.id;if(!a){m.value=[],d.value=null,n.value=null;return}D.value=!0;try{const i=await b(`/blocks?period-id=${a}`),l=Array.isArray(i)?i:[];l.sort((f,W)=>{const Y=(N[f.dayOfWeek]??99)-(N[W.dayOfWeek]??99);return Y!==0?Y:f.startTime.localeCompare(W.startTime)}),m.value=l,d.value!=null&&!m.value.some(f=>f.id===d.value)&&(d.value=null),O()}finally{D.value=!1}}function L(){d.value=null,n.value=K()}async function le(){if(!(!n.value||!n.value.periodId)){P.value=!0;try{const a={periodId:n.value.periodId,dayOfWeek:n.value.dayOfWeek,startTime:n.value.startTime,endTime:n.value.endTime};if(n.value.id)await b(`/blocks/${n.value.id}`,{method:"PUT",body:a});else{const e=await b("/blocks",{method:"POST",body:a});await h(),e!=null&&e.id&&(d.value=e.id,O());return}await h()}finally{P.value=!1}}}async function se(){var a;if((a=p.value)!=null&&a.id){B.value=!0,T.value=!0;try{const e=await b(`/courses?block-id=${p.value.id}`),i=Array.isArray(e)?e:[];I.value=i.sort((l,f)=>(l.name??"").localeCompare(f.name??"")||(l.courseId??"").localeCompare(f.courseId??""))}finally{B.value=!1}}}async function oe(){var a;if((a=p.value)!=null&&a.id){g.value=!0;try{await b(`/blocks/${p.value.id}`,{method:"DELETE"}),T.value=!1,d.value=null,await h()}finally{g.value=!1}}}function U(){T.value=!1}return de(async()=>{await h()}),M(()=>{var a;return(a=r.selectedPeriod)==null?void 0:a.id},async()=>{d.value=null,await h()}),M(d,()=>{O()}),(a,e)=>{var i;return o(),s("div",be,[t("div",pe,[t("div",fe,[t("div",ke,[t("div",ye,[t("div",_e,[e[4]||(e[4]=t("h5",{class:"mb-0"},"Bl√∂cke",-1)),t("div",ge,[t("button",{class:"btn btn-sm btn-outline-primary",onClick:L}," Neu "),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:ee,disabled:!w(r).selectedPeriod||m.value.length>0,title:"Bl√∂cke aus vorheriger Periode kopieren"}," Kopieren ",8,he)])]),m.value.length>0?(o(),s("div",we,e[5]||(e[5]=[t("small",null," üí° Tipp: Die Kopierfunktion ist nur f√ºr leere Perioden verf√ºgbar. ",-1)]))):u("",!0),D.value?(o(),s("div",De,"Lade Bl√∂cke‚Ä¶")):(o(),s("ul",Be,[(o(!0),s(A,null,V(m.value,l=>(o(),s("li",{key:l.id,class:Q(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",{active:l.id===d.value}]),role:"button",onClick:f=>d.value=l.id??null},[t("div",null,[t("div",Pe,v($(l)),1),t("small",Te,"ID: "+v(l.id),1)]),l.id===d.value?(o(),s("span",Se,"ausgew√§hlt")):u("",!0)],10,Ce))),128)),m.value.length?u("",!0):(o(),s("li",xe," Keine Bl√∂cke gefunden. "))]))])])]),t("div",Ae,[t("div",Ve,[t("div",Ie,[t("h5",Oe,v(p.value?"Block bearbeiten":"Neuen Block anlegen"),1),w(r).selectedPeriod?u("",!0):(o(),s("div",Fe," Bitte w√§hle zuerst eine Phase (Period), um Bl√∂cke anzuzeigen oder anzulegen. ")),n.value&&w(r).selectedPeriod?(o(),s("form",{key:1,onSubmit:re(le,["prevent"]),class:"vstack gap-3"},[t("div",Ne,[t("div",$e,[e[6]||(e[6]=t("label",{class:"form-label"},"Wochentag",-1)),q(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=l=>n.value.dayOfWeek=l),required:""},[(o(!0),s(A,null,V(w(G),l=>(o(),s("option",{key:l,value:l},v(w(F)[l]),9,ze))),128))],512),[[H,n.value.dayOfWeek]])]),t("div",Ee,[e[7]||(e[7]=t("label",{class:"form-label"},"Startzeit",-1)),j(R,{modelValue:n.value.startTime,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.startTime=l),required:""},null,8,["modelValue"])]),t("div",Ke,[e[8]||(e[8]=t("label",{class:"form-label"},"Endzeit",-1)),j(R,{modelValue:n.value.endTime,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.endTime=l),required:""},null,8,["modelValue"])])]),t("div",Le,[t("button",{class:"btn btn-success",type:"submit",disabled:P.value},[P.value?(o(),s("span",We)):u("",!0),e[9]||(e[9]=k(" Speichern "))],8,Ue),p.value?(o(),s("button",{key:0,class:"btn btn-outline-danger",type:"button",disabled:g.value||B.value,onClick:se},[g.value||B.value?(o(),s("span",Me)):u("",!0),e[10]||(e[10]=k(" L√∂schen "))],8,Ye)):u("",!0),t("button",{class:"btn btn-outline-secondary ms-auto",type:"button",onClick:L}," Abbrechen / Neu ")])],32)):(o(),s("div",qe,"Kein Formular verf√ºgbar."))])])])]),S.value?(o(),s("div",He,[t("div",je,[t("div",Re,[t("div",{class:"modal-header"},[e[11]||(e[11]=t("h5",{class:"modal-title"},"Bl√∂cke aus Vorperiode kopieren",-1)),t("button",{type:"button",class:"btn-close",onClick:E})]),t("div",Je,[t("p",Ze,[e[12]||(e[12]=k(" Kopiere alle Zeitbl√∂cke aus einer existierenden Periode in die aktuelle Periode: ")),t("strong",null,v((i=w(r).selectedPeriod)==null?void 0:i.name),1)]),t("div",Qe,[e[14]||(e[14]=t("label",{class:"form-label"},"Quell-Periode ausw√§hlen:",-1)),q(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),required:""},[e[13]||(e[13]=t("option",{value:null,disabled:""},"-- Bitte w√§hlen --",-1)),(o(!0),s(A,null,V(C.value,l=>(o(),s("option",{key:l.id,value:l.id},v(l.name)+" ("+v(l.startDate)+" - "+v(l.endDate)+") ",9,Ge))),128))],512),[[H,y.value]])]),e[15]||(e[15]=t("div",{class:"alert alert-warning"},[t("strong",null,"Hinweis:"),k(" Es werden nur die Zeitbl√∂cke kopiert, nicht die Kurszuordnungen! ")],-1))]),t("div",Xe,[t("button",{class:"btn btn-outline-secondary",onClick:E}," Abbrechen "),t("button",{class:"btn btn-primary",disabled:!y.value||x.value,onClick:te},[x.value?(o(),s("span",tt)):u("",!0),e[16]||(e[16]=k(" Bl√∂cke kopieren "))],8,et)])])])])):u("",!0),T.value?(o(),s("div",lt,[t("div",st,[t("div",ot,[t("div",{class:"modal-header"},[e[17]||(e[17]=t("h5",{class:"modal-title"},"Block wirklich l√∂schen?",-1)),t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:U})]),t("div",at,[t("p",nt,[e[18]||(e[18]=k(" Dieser Block ist ausgew√§hlt: ")),p.value?(o(),s("strong",it,v($(p.value)),1)):u("",!0)]),B.value?(o(),s("div",dt,"Lade verkn√ºpfte Kurse‚Ä¶")):(o(),s("div",rt,[I.value.length?(o(),s("div",ut,[e[19]||(e[19]=t("p",{class:"mb-2"}," Folgende Kurse sind diesem Block zugeordnet und verlieren bei einer L√∂schung ihre Blockzuweisung: ",-1)),t("ul",ct,[(o(!0),s(A,null,V(I.value,l=>(o(),s("li",{key:l.id,class:"list-group-item"},[t("div",vt,[t("span",null,[t("strong",null,v(l.name??"Unbenannter Kurs"),1),l.courseId?(o(),s("span",mt," ("+v(l.courseId)+")",1)):u("",!0)]),t("small",bt,"ID: "+v(l.id),1)])]))),128))]),e[20]||(e[20]=t("div",{class:"alert alert-warning"},[t("strong",null,"Achtung:"),k(" Diese Kurse m√ºssen anschlie√üend neu einem Block zugeordnet werden. ")],-1))])):(o(),s("div",pt," F√ºr diesen Block sind aktuell keine Kurse zugeordnet. "))]))]),t("div",ft,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:U},"Abbrechen"),t("button",{class:"btn btn-danger",type:"button",disabled:g.value,onClick:oe},[g.value?(o(),s("span",yt)):u("",!0),e[21]||(e[21]=k(" Ja, endg√ºltig l√∂schen "))],8,kt)])])])])):u("",!0)])}}}),Dt=J(_t,[["__scopeId","data-v-d512a919"]]);export{Dt as default};
