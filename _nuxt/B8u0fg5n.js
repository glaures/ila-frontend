import{e as $,i as W,k as x,r as f,n as I,c as l,a as t,p as g,q as K,C as M,F as h,s as p,t as o,o as i,d as y,_ as j}from"./kHrezA3u.js";import{u as L}from"./CMSPGeyL.js";const P={class:"d-flex align-items-center justify-content-between mb-3 d-print-none"},V={class:"btn-group"},H=["disabled"],q={key:0},z={key:1},Z=["disabled"],G={class:"card mb-4 d-print-none"},J={class:"card-body"},Q={class:"row g-3 align-items-end"},X={class:"col-12 col-md-6"},ee=["value"],te={key:0,class:"col-12 col-md-6"},se={class:"text-muted small"},ae={key:0,class:"alert alert-info"},ne={key:1,class:"alert alert-danger"},le={key:2},oe={class:"d-flex align-items-center mb-2 d-print-none"},ie={class:"h5 mb-0"},re={class:"badge bg-light text-dark ms-2"},de={key:0,class:"row g-3"},ue={class:"card h-100 d-flex flex-column course-print-page"},ce={class:"card-header d-none d-print-block bg-white border-0 pt-4"},me={class:"mb-1 text-uppercase small text-muted"},ve={class:"h4 mb-1"},_e={class:"h5 mb-0"},fe={class:"card-body d-flex flex-column"},ge={class:"d-flex justify-content-between align-items-start mb-2 d-print-none"},he={class:"h6 mb-0"},pe={class:"badge bg-secondary"},ye={class:"small text-muted mb-2"},be={class:"d-flex justify-content-between align-items-center border-top pt-2 mb-1"},ke={class:"badge bg-light text-dark"},De={class:"mb-0 ps-3"},Ae={key:0,class:"small text-muted"},xe={key:1,class:"alert alert-warning"},we=$({__name:"assignments",setup(Ne){const{$authFetch:b}=W(),S=L(),k=x(()=>S.selectedId),d=f(!1),m=f(null),v=f([]),r=f(""),_=f({}),c=f({}),B={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},D=s=>B[s]||s,w=x(()=>{const s=new Set(v.value.map(a=>a.dayOfWeek)),e=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];return Array.from(s).sort((a,n)=>e.indexOf(a)-e.indexOf(n))}),C=x(()=>v.value.filter(s=>s.dayOfWeek===r.value).sort((s,e)=>s.startTime.localeCompare(e.startTime)));function N(s){return`${s.startTime} – ${s.endTime}`}function T(s){if(s.instructor&&s.instructor.trim().length)return s.instructor;const e=s.teacher;return e&&(`${e.firstName??""} ${e.lastName??""}`.trim()||e.userName)||"—"}async function F(){if(!k.value){d.value=!1;return}m.value=null,d.value=!0;try{const s=await b(`/blocks?period-id=${k.value}`);v.value=s,!r.value&&v.value.length&&(r.value=w.value[0]||"",r.value&&await A(r.value))}catch(s){m.value=(s==null?void 0:s.message)||"Fehler beim Laden der Blöcke."}finally{d.value=!1}}async function Y(s){const e=await b(`/courses?block-id=${encodeURIComponent(s)}`);return _.value[s]=e,e}async function U(s){if(c.value[s])return c.value[s];const e=await b(`/assignments?course-id=${encodeURIComponent(s)}`);return e.sort((a,n)=>a.lastName===n.lastName?a.firstName.localeCompare(n.firstName,"de"):a.lastName.localeCompare(n.lastName,"de")),c.value[s]=e,e}async function A(s){m.value=null,d.value=!0;try{_.value={},c.value={};const e=v.value.filter(u=>u.dayOfWeek===s),n=(await Promise.all(e.map(u=>Y(u.id)))).flat();await Promise.all(n.map(u=>U(u.id)))}catch(e){m.value=(e==null?void 0:e.message)||"Fehler beim Laden der Kurse/Teilnehmer."}finally{d.value=!1}}function R(){r.value&&A(r.value)}function E(){window.print()}async function O(){r.value&&await A(r.value)}return I(k,s=>{s&&(v.value=[],r.value="",_.value={},c.value={},F())},{immediate:!0}),(s,e)=>(i(),l("div",null,[e[8]||(e[8]=t("h1",null,"Kursbelegungen – Übersicht & Druck",-1)),t("div",P,[t("div",V,[t("button",{class:"btn btn-outline-secondary",onClick:O,disabled:d.value},[d.value?(i(),l("span",z,"Aktualisiere…")):(i(),l("span",q,"Neu laden"))],8,H),t("button",{class:"btn btn-primary",onClick:E,disabled:d.value||!r.value}," Drucken ",8,Z)])]),t("div",G,[t("div",J,[t("div",Q,[t("div",X,[e[2]||(e[2]=t("label",{class:"form-label",for:"daySelect"},"Wochentag",-1)),K(t("select",{id:"daySelect",class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),onChange:R},[e[1]||(e[1]=t("option",{disabled:"",value:""},"– Bitte wählen –",-1)),(i(!0),l(h,null,p(w.value,a=>(i(),l("option",{key:a,value:a},o(D(a)),9,ee))),128))],544),[[M,r.value]])]),r.value?(i(),l("div",te,[t("div",se," Es werden alle Blöcke am "+o(D(r.value))+" geladen. Für jeden Block werden die angebotenen Kurse und deren Teilnehmer angezeigt. ",1)])):g("",!0)])])]),d.value?(i(),l("div",ae,"Daten werden geladen …")):g("",!0),m.value?(i(),l("div",ne,o(m.value),1)):g("",!0),!d.value&&r.value?(i(),l("div",le,[(i(!0),l(h,null,p(C.value,a=>(i(),l("div",{key:a.id,class:"mb-4"},[t("div",oe,[t("h2",ie,"Block "+o(N(a)),1),t("span",re,"ID: "+o(a.id),1)]),_.value[a.id]&&_.value[a.id].length?(i(),l("div",de,[(i(!0),l(h,null,p(_.value[a.id],n=>(i(),l("div",{key:n.id,class:"col-12 col-md-6 col-lg-4"},[t("div",ue,[t("div",ce,[t("div",me,o(D(a.dayOfWeek)),1),t("h1",ve,o(N(a)),1),t("h2",_e,o(n.name),1)]),t("div",fe,[t("div",ge,[t("h3",he,o(n.name),1),t("span",pe,o(n.courseId),1)]),t("div",ye,[t("div",null,[e[3]||(e[3]=y("Raum: ")),t("strong",null,o(n.room||"—"),1)]),t("div",null,[e[4]||(e[4]=y("Leitung: ")),t("strong",null,o(T(n)),1)]),t("div",null,[e[5]||(e[5]=y("Max. TN: ")),t("strong",null,o(n.maxAttendees),1)]),t("div",null,[e[6]||(e[6]=y("Klassen: ")),t("strong",null,o(n.grades.join(",")),1)])]),t("div",null,[t("div",be,[e[7]||(e[7]=t("span",{class:"small text-muted"},"Teilnehmer",-1)),t("span",ke,o((c.value[n.id]||[]).length)+" / "+o(n.maxAttendees),1)]),t("ol",De,[(i(!0),l(h,null,p(c.value[n.id]||[],u=>(i(),l("li",{key:u.userUserName,class:"small"},o(u.lastName)+", "+o(u.firstName),1))),128)),(c.value[n.id]||[]).length===0?(i(),l("li",Ae,"(Keine Zuordnungen) ")):g("",!0)])])])])]))),128))])):(i(),l("div",xe,"Für diesen Block sind keine Kurse hinterlegt."))]))),128))])):g("",!0)]))}}),Ce=j(we,[["__scopeId","data-v-1fed0698"]]);export{Ce as default};
