import{e as A,i as F,g as I,r as _,k as L,m as K,n as N,c as o,a as e,h as n,t as a,N as v,q as M,x as D,I as $,F as k,s as P,o as i,C as x,_ as R}from"./BtCKYhO9.js";import{u as T}from"./BoVQibF0.js";import{w as U}from"./BA3RTNws.js";const E={class:"container-fluid py-3"},V={key:0,class:"text-center py-5"},j={key:1},q={class:"row mb-4"},G={class:"col-md-4"},W={class:"card border-danger"},H={class:"card-body"},J={class:"display-4 mb-0"},O={class:"text-muted"},Q={class:"col-md-4"},X={class:"card border-warning"},Y={class:"card-body"},Z={class:"display-4 mb-0"},ee={class:"text-muted"},se={class:"col-md-4"},te={class:"card border-success"},ae={class:"card-body"},le={class:"display-4 mb-0"},ne={class:"text-muted"},re={class:"card mb-4"},oe={class:"card-body"},ie={class:"progress",style:{height:"30px"}},de={class:"card mb-4"},ce={class:"card-body"},ue={class:"row align-items-center"},he={class:"col-md-9"},ge=["value"],_e={class:"card mb-4"},ve={class:"card-header"},me={class:"mb-0"},be={class:"card-body"},pe={key:0,class:"text-muted"},fe={key:1,class:"table-responsive"},ye={class:"table table-hover"},we={class:"progress",style:{"min-width":"100px"}},ke={key:2,class:"alert alert-warning"},Pe=A({__name:"preference-status",setup(xe){const{$authFetch:m}=F(),b=I(),p=T(),h=_(!0),g=_([]),c=_(null),l=_(null),u=L(()=>{var t;return((t=p.selectedPeriod)==null?void 0:t.id)??null});async function y(){var t;if(!u.value){g.value=[];return}try{const s=await m(`/blocks?period-id=${u.value}`);g.value=Array.isArray(s)?s:[]}catch(s){b.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler beim Laden der Blöcke: "+s),g.value=[]}}async function f(){var t;if(!u.value){b.show("Keine Periode ausgewählt"),h.value=!1;return}try{h.value=!0;let s=`/preference-status?period-id=${u.value}`;c.value&&(s+=`&block-id=${c.value}`),l.value=await m(s)}catch(s){b.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler beim Laden der Präferenz-Statistiken: "+s)}finally{h.value=!1}}function S(){f()}function d(t){return!l.value||l.value.totalStudents===0?0:Math.round(t/l.value.totalStudents*100)}function B(t){return t===0?"bg-warning text-dark":t===1?"bg-secondary":t===2?"bg-info":"bg-light text-dark"}function z(t){return t>=100?"bg-danger":t>=80?"bg-warning":"bg-success"}function C(t){return U[t]||t||"Unbekannt"}return K(async()=>{p.initialized||await p.loadPeriods(m),await y(),await f()}),N(u,async(t,s)=>{t&&t!==s&&(c.value=null,await y(),await f())}),(t,s)=>(i(),o("div",E,[s[9]||(s[9]=e("div",{class:"d-flex align-items-center justify-content-between mb-3"},[e("div",{class:"h4 m-0"},"Präferenzen")],-1)),n(h)?(i(),o("div",V,s[1]||(s[1]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Lädt...")],-1)]))):n(l)?(i(),o("div",j,[e("div",q,[e("div",G,[e("div",W,[e("div",H,[s[2]||(s[2]=e("h5",{class:"card-title text-danger"},"Noch nicht begonnen",-1)),e("p",J,a(n(l).notStarted),1),e("small",O,a(d(n(l).notStarted))+"%",1)])])]),e("div",Q,[e("div",X,[e("div",Y,[s[3]||(s[3]=e("h5",{class:"card-title text-warning"},"In Bearbeitung",-1)),e("p",Z,a(n(l).inProgress),1),e("small",ee,a(d(n(l).inProgress))+"%",1)])])]),e("div",se,[e("div",te,[e("div",ae,[s[4]||(s[4]=e("h5",{class:"card-title text-success"},"Abgeschlossen",-1)),e("p",le,a(n(l).completed),1),e("small",ne,a(d(n(l).completed))+"%",1)])])])]),e("div",re,[e("div",oe,[s[5]||(s[5]=e("h5",{class:"card-title"},"Gesamtfortschritt",-1)),e("div",ie,[e("div",{class:"progress-bar bg-success",style:v({width:d(n(l).completed)+"%"}),role:"progressbar"},a(d(n(l).completed))+"% Fertig ",5),e("div",{class:"progress-bar bg-warning",style:v({width:d(n(l).inProgress)+"%"}),role:"progressbar"},a(d(n(l).inProgress))+"% ",5),e("div",{class:"progress-bar bg-danger",style:v({width:d(n(l).notStarted)+"%"}),role:"progressbar"},a(d(n(l).notStarted))+"% ",5)])])]),e("div",de,[e("div",ce,[e("div",ue,[s[7]||(s[7]=e("div",{class:"col-md-3"},[e("label",{for:"blockSelect",class:"form-label fw-bold"},"Block-Filter:")],-1)),e("div",he,[M(e("select",{id:"blockSelect",class:"form-select","onUpdate:modelValue":s[0]||(s[0]=r=>$(c)?c.value=r:null),onChange:S},[s[6]||(s[6]=e("option",{value:null},"Alle Blöcke",-1)),(i(!0),o(k,null,P(n(g),r=>(i(),o("option",{key:r.id,value:r.id},a(C(r.dayOfWeek))+", "+a(r.startTime)+" - "+a(r.endTime),9,ge))),128))],544),[[D,n(c)]])])])])]),e("div",_e,[e("div",ve,[e("h5",me,a(n(c)?"Beliebteste Kurse im ausgewählten Block":"Beliebteste Kurse (alle Blöcke)")+" (nach Prio-1-Platzierungen) ",1)]),e("div",be,[n(l).popularCourses.length===0?(i(),o("div",pe," Noch keine Präferenzen vorhanden ")):(i(),o("div",fe,[e("table",ye,[s[8]||(s[8]=e("thead",null,[e("tr",null,[e("th",null,"Rang"),e("th",null,"Kurs-ID"),e("th",null,"Kursname"),e("th",null,"Lehrer"),e("th",null,"Prio-1-Wahl"),e("th",null,"Max. Teilnehmer"),e("th",null,"Auslastung")])],-1)),e("tbody",null,[(i(!0),o(k,null,P(n(l).popularCourses,(r,w)=>(i(),o("tr",{key:r.courseId},[e("td",null,[e("span",{class:x(["badge",B(w)])},a(w+1),3)]),e("td",null,a(r.courseIdentifier),1),e("td",null,a(r.courseName),1),e("td",null,a(r.instructor),1),e("td",null,[e("strong",null,a(r.firstPreferenceCount),1)]),e("td",null,a(r.maxAttendees),1),e("td",null,[e("div",we,[e("div",{class:x(["progress-bar",z(r.utilizationPercentage)]),style:v({width:Math.min(r.utilizationPercentage,100)+"%"}),role:"progressbar"},a(r.utilizationPercentage)+"% ",7)])])]))),128))])])]))])])])):(i(),o("div",ke," Keine Daten verfügbar "))]))}}),Ce=R(Pe,[["__scopeId","data-v-4c7ba054"]]);export{Ce as default};
