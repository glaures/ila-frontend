import{e as E,i as O,r as v,k as x,j as M,c as l,a as t,m as f,n as W,v as $,F as h,p as y,t as i,o,d as D}from"./CJBR_SS8.js";import{_ as j}from"./DlAUqK2U.js";const K={class:"d-flex align-items-center justify-content-between mb-3 d-print-none"},L={class:"btn-group"},I=["disabled"],V={key:0},P={key:1},H=["disabled"],z={class:"card mb-4 d-print-none"},Z={class:"card-body"},q={class:"row g-3 align-items-end"},G={class:"col-12 col-md-6"},J=["value"],Q={key:0,class:"col-12 col-md-6"},X={class:"text-muted small"},ee={key:0,class:"alert alert-info"},te={key:1,class:"alert alert-danger"},se={key:2},ae={class:"d-flex align-items-center mb-2 d-print-none"},ne={class:"h5 mb-0"},le={class:"badge bg-light text-dark ms-2"},oe={key:0,class:"row g-3"},ie={class:"card h-100 course-print-page"},re={class:"card-header d-none d-print-block bg-white border-0 pt-4"},de={class:"mb-1 text-uppercase small text-muted"},ue={class:"h4 mb-1"},ce={class:"h5 mb-0"},me={class:"card-body d-flex flex-column"},ve={class:"d-flex justify-content-between align-items-start mb-2 d-print-none"},_e={class:"h6 mb-0"},ge={class:"badge bg-secondary"},fe={class:"small text-muted mb-2"},he={class:"mt-auto"},ye={class:"d-flex justify-content-between align-items-center border-top pt-2 mb-1"},pe={class:"badge bg-light text-dark"},be={class:"mb-0 ps-3"},ke={key:0,class:"small text-muted"},De={key:1,class:"alert alert-warning"},Ae=E({__name:"assignments",setup(we){const{$authFetch:p}=O(),d=v(!1),m=v(null),_=v([]),r=v(""),g=v({}),c=v({}),N={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},b=s=>N[s]||s,A=x(()=>{const s=new Set(_.value.map(a=>a.dayOfWeek)),e=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];return Array.from(s).sort((a,n)=>e.indexOf(a)-e.indexOf(n))}),B=x(()=>_.value.filter(s=>s.dayOfWeek===r.value).sort((s,e)=>s.startTime.localeCompare(e.startTime)));function w(s){return`${s.startTime} – ${s.endTime}`}function S(s){if(s.instructor&&s.instructor.trim().length)return s.instructor;const e=s.teacher;return e&&(`${e.firstName??""} ${e.lastName??""}`.trim()||e.userName)||"—"}async function C(){m.value=null,d.value=!0;try{const s=await p("/blocks");_.value=s,!r.value&&_.value.length&&(r.value=A.value[0]||"",r.value&&await k(r.value))}catch(s){m.value=(s==null?void 0:s.message)||"Fehler beim Laden der Blöcke."}finally{d.value=!1}}async function T(s){const e=await p(`/courses?block-id=${encodeURIComponent(s)}`);return g.value[s]=e,e}async function F(s){if(c.value[s])return c.value[s];const e=await p(`/assignments?course-id=${encodeURIComponent(s)}`);return e.sort((a,n)=>a.lastName===n.lastName?a.firstName.localeCompare(n.firstName,"de"):a.lastName.localeCompare(n.lastName,"de")),c.value[s]=e,e}async function k(s){m.value=null,d.value=!0;try{g.value={},c.value={};const e=_.value.filter(u=>u.dayOfWeek===s),n=(await Promise.all(e.map(u=>T(u.id)))).flat();await Promise.all(n.map(u=>F(u.id)))}catch(e){m.value=(e==null?void 0:e.message)||"Fehler beim Laden der Kurse/Teilnehmer."}finally{d.value=!1}}function Y(){r.value&&k(r.value)}function U(){window.print()}async function R(){r.value&&await k(r.value)}return M(C),(s,e)=>(o(),l("div",null,[e[7]||(e[7]=t("h1",null,"Kursbelegungen – Übersicht & Druck",-1)),t("div",K,[t("div",L,[t("button",{class:"btn btn-outline-secondary",onClick:R,disabled:d.value},[d.value?(o(),l("span",P,"Aktualisiere…")):(o(),l("span",V,"Neu laden"))],8,I),t("button",{class:"btn btn-primary",onClick:U,disabled:d.value||!r.value}," Drucken ",8,H)])]),t("div",z,[t("div",Z,[t("div",q,[t("div",G,[e[2]||(e[2]=t("label",{class:"form-label",for:"daySelect"},"Wochentag",-1)),W(t("select",{id:"daySelect",class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),onChange:Y},[e[1]||(e[1]=t("option",{disabled:"",value:""},"– Bitte wählen –",-1)),(o(!0),l(h,null,y(A.value,a=>(o(),l("option",{key:a,value:a},i(b(a)),9,J))),128))],544),[[$,r.value]])]),r.value?(o(),l("div",Q,[t("div",X," Es werden alle Blöcke am "+i(b(r.value))+" geladen. Für jeden Block werden die angebotenen Kurse und deren Teilnehmer angezeigt. ",1)])):f("",!0)])])]),d.value?(o(),l("div",ee,"Daten werden geladen …")):f("",!0),m.value?(o(),l("div",te,i(m.value),1)):f("",!0),!d.value&&r.value?(o(),l("div",se,[(o(!0),l(h,null,y(B.value,a=>(o(),l("div",{key:a.id,class:"mb-4"},[t("div",ae,[t("h2",ne,"Block "+i(w(a)),1),t("span",le,"ID: "+i(a.id),1)]),g.value[a.id]&&g.value[a.id].length?(o(),l("div",oe,[(o(!0),l(h,null,y(g.value[a.id],n=>(o(),l("div",{key:n.id,class:"col-12 col-md-6 col-lg-4"},[t("div",ie,[t("div",re,[t("div",de,i(b(a.dayOfWeek)),1),t("h1",ue,i(w(a)),1),t("h2",ce,i(n.name),1)]),t("div",me,[t("div",ve,[t("h3",_e,i(n.name),1),t("span",ge,i(n.courseId),1)]),t("div",fe,[t("div",null,[e[3]||(e[3]=D("Raum: ")),t("strong",null,i(n.room||"—"),1)]),t("div",null,[e[4]||(e[4]=D("Leitung: ")),t("strong",null,i(S(n)),1)]),t("div",null,[e[5]||(e[5]=D("Max. TN: ")),t("strong",null,i(n.maxAttendees),1)])]),t("div",he,[t("div",ye,[e[6]||(e[6]=t("span",{class:"small text-muted"},"Teilnehmer",-1)),t("span",pe,i((c.value[n.id]||[]).length)+" / "+i(n.maxAttendees),1)]),t("ol",be,[(o(!0),l(h,null,y(c.value[n.id]||[],u=>(o(),l("li",{key:u.userUserName,class:"small"},i(u.lastName)+", "+i(u.firstName),1))),128)),(c.value[n.id]||[]).length===0?(o(),l("li",ke,"(Keine Zuordnungen) ")):f("",!0)])])])])]))),128))])):(o(),l("div",De,"Für diesen Block sind keine Kurse hinterlegt."))]))),128))])):f("",!0)]))}}),Be=j(Ae,[["__scopeId","data-v-9d71bafd"]]);export{Be as default};
