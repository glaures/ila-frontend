import{g as h,z as _,D as f,E as a,G as u,c as g,a as y,o as w}from"./BqwYvLxi.js";import{u as S}from"./EwcuPIFR.js";const b={class:"container py-5 text-center"},U={__name:"auth-redirect",async setup(x){var c;let e,t;const l=_(),p=h(),d=S(),n=l.query.code;if(n){const o=f(),r=`${o.public.baseUrl.replace(/\/$/,"")}${o.public.oauth.redirectPath}`;try{const{token:s,username:m,roles:i}=([e,t]=a(()=>$fetch(o.public.apiBase+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:{code:n,redirectUri:r}})),e=await e,t(),e);localStorage.setItem("jwt",s),d.setUsername(m),console.log("roles: "+i),[e,t]=a(()=>u(i.includes("Admin")?"/admin":"/preferences")),await e,t()}catch(s){p.show(((c=s==null?void 0:s.data)==null?void 0:c.message)??"Es ist ein interner Fehler aufgetreten: "+s),[e,t]=a(()=>u("/")),await e,t()}}return(o,r)=>(w(),g("div",b,r[0]||(r[0]=[y("p",null,"Authentifiziere dichâ€¦",-1)])))}};export{U as default};
