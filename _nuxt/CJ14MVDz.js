import{e as me,i as ve,g as fe,j as pe,k as U,r as d,l as be,m as he,n as ye,c as a,a as t,p as c,d as m,q as u,v as f,F as K,s as N,x as S,t as i,y as ge,z as ke,o as r,_ as we}from"./Bt8ervS0.js";import{u as R}from"./B4BVfnsQ.js";import{w as W}from"./BA3RTNws.js";const xe={class:"d-flex align-items-center justify-content-between mb-3"},Ae=["disabled"],Ce=["disabled"],Ie={key:0,class:"alert alert-info"},Ke={key:0,class:"list-group position-absolute w-100 shadow",style:{"z-index":"20","max-height":"320px",overflow:"auto"}},Ne=["onClick"],Se={class:"d-flex justify-content-between"},_e={class:"badge bg-secondary me-2"},$e={key:0,class:"text-muted ms-2"},Oe={key:1,class:"small text-muted mt-1"},Pe={class:"text-muted"},Ee={key:0,class:"small text-muted text-truncate"},Te={key:0,class:"list-group-item text-muted"},Fe={class:"card shadow-sm"},Le={class:"card-body"},Ue={class:"row g-3"},Ve={class:"col-12 col-md-3"},Be={class:"col-12 col-md-5"},De={class:"col-12 col-md-4"},Ge={class:"col-12"},ze={class:"col-12 col-md-3"},Me={class:"col-12 col-md-3"},qe={class:"col-12 col-md-3"},Re={class:"col-12 col-md-3"},We=["value"],je=["value"],Ze={class:"col-12"},He={class:"d-flex flex-wrap gap-3"},Je=["id","value"],Qe=["for"],Xe={class:"col-12"},Ye={class:"d-flex flex-wrap gap-3"},es=["id","value"],ss=["for"],ts={class:"col-12"},ls={class:"d-flex flex-wrap gap-3"},ns=["id","value"],os=["for"],as={class:"col-12"},rs={class:"form-check"},us={class:"col-12"},is={class:"form-check"},ds={key:1,class:"modal fade show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},cs={class:"modal-dialog modal-dialog-centered"},ms={class:"modal-content"},vs={class:"modal-body"},fs={key:0,class:"alert alert-warning mb-3"},ps={key:1,class:"text-danger mb-0"},bs=me({__name:"kurse",setup(hs){const j=["iLa","KuP","BuE","FuF"],Z=[5,6,7,8,9,10,11,12],H=["male","female","diverse"],g=ke(),P=ge(),{$authFetch:p}=ve(),b=fe(),E=pe(),V=R(),_=R(),h=U(()=>_.selectedId),k=d([]),B=d([]),D=d(null),w=d(null),x=d(!1),$=d(0),I=d(""),y=d(!1),G=U(()=>{const l=I.value.trim().toLowerCase();return l?k.value.filter(e=>(e.courseId??"").toLowerCase().includes(l)||(e.name??"").toLowerCase().includes(l)||(e.description??"").toLowerCase().includes(l)||(e.instructor??"").toLowerCase().includes(l)).slice(0,50):k.value.slice(0,20)}),n=d({courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1,excludedGenders:[],manualAssignmentOnly:!1}),J=U(()=>B.value.filter(l=>h.value!=null&&l.periodId===h.value));function Q(l){return`${W[l.dayOfWeek]??l.dayOfWeek} ${l.startTime}–${l.endTime}`}function X(l){return l?`${W[l.dayOfWeek]??l.dayOfWeek} ${l.startTime}–${l.endTime}`:""}function Y(l){return`${l.courseId?`[${l.courseId}] `:""}${l.name??""}`}be(async()=>{V.selectedPeriod&&await z()});async function z(){var l,e;try{B.value=await p(`/blocks?period-id=${(l=V.selectedPeriod)==null?void 0:l.id}`)}catch(s){b.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Die Blöcke konnten nicht geladen werden: "+s)}}async function O(){var l;try{if(h.value==null){k.value=[];return}k.value=await p(`/courses?period-id=${h.value}`)}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}function T(l){var e;D.value={...l},n.value={id:l.id,courseId:l.courseId??"",name:l.name??"",description:l.description??"",courseCategories:Array.isArray(l.courseCategories)?[...l.courseCategories]:[],maxAttendees:l.maxAttendees,room:l.room??"",instructor:l.instructor??"",block:l.block??null,minAttendees:typeof l.minAttendees=="number"?l.minAttendees:0,grades:Array.isArray(l.grades)?[...l.grades].sort((s,o)=>s-o):[],placeholder:!!l.placeholder,excludedGenders:Array.isArray(l.excludedGenders)?[...l.excludedGenders]:[],manualAssignmentOnly:!!l.manualAssignmentOnly},w.value=((e=l.block)==null?void 0:e.id)??null,I.value=Y(l),y.value=!1,P.replace({path:g.path,query:{id:String(l.id??"")}})}function F(){D.value=null,w.value=null,n.value={courseId:"",name:"",description:"",courseCategories:[],maxAttendees:void 0,room:"",instructor:"",block:null,minAttendees:0,grades:[],placeholder:!1,excludedGenders:[],manualAssignmentOnly:!1},I.value="",y.value=!1,P.replace({path:g.path,query:{}})}function ee(){n.value.id&&P.push(`/admin/kurs/${n.value.id}`)}function se(){var e,s;const l=[];return(e=n.value.courseId)!=null&&e.trim()||l.push("courseId ist Pflicht."),(s=n.value.name)!=null&&s.trim()||l.push("name ist Pflicht."),n.value.maxAttendees==null?l.push("maxAttendees ist Pflicht."):Number(n.value.maxAttendees)<1&&l.push("maxAttendees muss ≥ 1 sein."),(!n.value.courseCategories||n.value.courseCategories.length===0)&&l.push("Mindestens eine Kurskategorie wählen."),n.value.minAttendees!=null&&n.value.maxAttendees!=null&&Number(n.value.minAttendees)>Number(n.value.maxAttendees)&&l.push("minAttendees darf nicht größer als maxAttendees sein."),h.value==null&&l.push("Bitte oben eine Phase auswählen."),l}async function te(){var e,s,o,q;const l=se();if(l.length){b.show(l.join(" "));return}try{const A=Array.from(new Set(n.value.grades??[])).sort((C,ce)=>C-ce),ie=n.value.id==null,L={courseId:n.value.courseId.trim(),name:n.value.name.trim(),description:((e=n.value.description)==null?void 0:e.trim())||"",courseCategories:[...n.value.courseCategories],maxAttendees:Number(n.value.maxAttendees),room:((s=n.value.room)==null?void 0:s.trim())||"",instructor:((o=n.value.instructor)==null?void 0:o.trim())||"",blockId:w.value!==null?w.value:null,minAttendees:Number(n.value.minAttendees??0),grades:A,placeholder:!!n.value.placeholder,excludedGenders:[...n.value.excludedGenders??[]],manualAssignmentOnly:!!n.value.manualAssignmentOnly};let v;if(ie)L.periodId=h.value,v=await p("/courses",{method:"POST",body:L}),E.success(`Kurs "${v.name}" wurde erfolgreich angelegt.`);else{const C=Number(n.value.id);v=await p(`/courses/${C}`,{method:"PUT",body:L}),E.success(`Kurs "${v.name}" wurde erfolgreich aktualisiert.`)}await O();const de=k.value.find(C=>v.id&&C.id===v.id||C.courseId===v.courseId)??v;T(de)}catch(A){b.show(((q=A==null?void 0:A.data)==null?void 0:q.message)??"Es ist ein interner Fehler aufgetreten: "+A)}}async function le(l){var e;try{const s=await p(`/assignments?course-id=${l}`);if(typeof s=="number")return s;if(Array.isArray(s))return s.length;if(s&&typeof s=="object"){const o=s.count??s.total??s.size;if(typeof o=="number")return o}throw new Error("Unerwartetes Antwortformat von /assignments")}catch(s){throw b.show(((e=s==null?void 0:s.data)==null?void 0:e.message)??"Fehler beim Laden der Zuordnungsanzahl: "+s),s}}async function ne(){if(n.value.id==null){b.show("Kein Kurs ausgewählt oder Kurs hat keine Server-ID.");return}const l=Number(n.value.id);try{$.value=await le(l),x.value=!0}catch{}}async function oe(){var s;if(n.value.id==null)return;const l=Number(n.value.id),e=n.value.name||"Kurs";try{await p(`/courses/${l}`,{method:"DELETE"}),await O(),x.value=!1,E.success(`Kurs "${e}" wurde erfolgreich gelöscht.`),F()}catch(o){b.show(((s=o==null?void 0:o.data)==null?void 0:s.message)??"Fehler beim Löschen: "+o)}}function M(){x.value=!1}function ae(){const l=typeof g.query.id=="string"?g.query.id:typeof g.params.id=="string"?g.params.id:"";if(!l)return;const e=Number(l),s=k.value.find(o=>o.id===e);s&&T(s)}he(async()=>{_.initialized||await _.loadPeriods(p),await z(),await O(),ae()}),ye(()=>_.selectedId,async()=>{await O(),F()});function re(l){l.key==="Escape"&&(x.value?x.value=!1:y.value=!1)}function ue(l){const e=l.target.value;w.value=e?Number(e):null}return(l,e)=>(r(),a("div",{class:"container-fluid py-3",onKeydown:re},[t("div",xe,[e[17]||(e[17]=t("h1",{class:"h4 m-0"},"Kurse verwalten",-1)),t("div",null,[t("button",{class:"btn btn-outline-secondary me-2",onClick:F},"Neuer Kurs"),t("button",{class:"btn btn-outline-danger me-2",disabled:!n.value.id,onClick:ne},"Löschen",8,Ae),t("button",{class:"btn btn-outline-primary me-2",disabled:!n.value.id,onClick:ee},e[16]||(e[16]=[t("i",{class:"bi bi-people me-1"},null,-1),m(" Teilnehmer verwalten ")]),8,Ce),t("button",{class:"btn btn-primary",onClick:te},"Speichern")])]),h.value==null?(r(),a("div",Ie," Bitte oben eine Phase auswählen. Es werden erst dann Kurse geladen. ")):c("",!0),t("div",{class:"mb-3 position-relative",onFocusin:e[3]||(e[3]=s=>y.value=!0)},[e[18]||(e[18]=t("label",{class:"form-label fw-semibold"},"Kurs suchen",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>I.value=s),onFocus:e[1]||(e[1]=s=>y.value=!0),onInput:e[2]||(e[2]=s=>y.value=!0),class:"form-control",type:"text",placeholder:"Suche nach ID, Name, Beschreibung oder Kursleiter ...",autocomplete:"off"},null,544),[[f,I.value]]),y.value?(r(),a("div",Ke,[(r(!0),a(K,null,N(G.value,s=>(r(),a("button",{key:s.id??s.courseId,class:"list-group-item list-group-item-action",onClick:o=>T(s)},[t("div",Se,[t("div",null,[t("span",_e,i(s.courseId),1),t("strong",null,i(s.name),1),s.instructor?(r(),a("small",$e,"("+i(s.instructor)+")",1)):c("",!0),s.block?(r(),a("div",Oe,i(X(s.block)),1)):c("",!0)]),t("small",Pe,"max: "+i(s.maxAttendees),1)]),s.description?(r(),a("div",Ee,i(s.description),1)):c("",!0)],8,Ne))),128)),G.value.length===0?(r(),a("div",Te,"Keine Treffer")):c("",!0)])):c("",!0)],32),t("div",Fe,[t("div",Le,[t("div",Ue,[t("div",Ve,[e[19]||(e[19]=t("label",{class:"form-label"},[m("Kurs-ID "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.courseId=s),class:"form-control",type:"text"},null,512),[[f,n.value.courseId]])]),t("div",Be,[e[20]||(e[20]=t("label",{class:"form-label"},[m("Name "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.name=s),class:"form-control",type:"text"},null,512),[[f,n.value.name]])]),t("div",De,[e[21]||(e[21]=t("label",{class:"form-label"},"Kursleiter",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.instructor=s),class:"form-control",type:"text"},null,512),[[f,n.value.instructor]])]),t("div",Ge,[e[22]||(e[22]=t("label",{class:"form-label"},"Beschreibung",-1)),u(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.description=s),class:"form-control",rows:"3"},null,512),[[f,n.value.description]])]),t("div",ze,[e[23]||(e[23]=t("label",{class:"form-label"},[m("Max. Teilnehmer "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.maxAttendees=s),class:"form-control",type:"number",min:"1"},null,512),[[f,n.value.maxAttendees,void 0,{number:!0}]])]),t("div",Me,[e[24]||(e[24]=t("label",{class:"form-label"},"Min. Teilnehmer",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.minAttendees=s),class:"form-control",type:"number",min:"0"},null,512),[[f,n.value.minAttendees,void 0,{number:!0}]])]),t("div",qe,[e[25]||(e[25]=t("label",{class:"form-label"},"Raum",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.room=s),class:"form-control",type:"text"},null,512),[[f,n.value.room]])]),t("div",Re,[e[27]||(e[27]=t("label",{class:"form-label"},"Block",-1)),t("select",{class:"form-select",value:w.value??"",onChange:ue},[e[26]||(e[26]=t("option",{value:""},"— kein Block zugewiesen —",-1)),(r(!0),a(K,null,N(J.value,s=>(r(),a("option",{key:s.id,value:s.id},i(Q(s)),9,je))),128))],40,We)]),t("div",Ze,[e[28]||(e[28]=t("label",{class:"form-label d-block"},[m("Kategorien "),t("span",{class:"text-danger"},"*")],-1)),t("div",He,[(r(),a(K,null,N(j,s=>t("div",{key:s,class:"form-check"},[u(t("input",{class:"form-check-input",type:"checkbox",id:"cat-"+s,value:s,"onUpdate:modelValue":e[11]||(e[11]=o=>n.value.courseCategories=o)},null,8,Je),[[S,n.value.courseCategories]]),t("label",{class:"form-check-label",for:"cat-"+s},i(s),9,Qe)])),64))])]),t("div",Xe,[e[29]||(e[29]=t("label",{class:"form-label d-block"},"Klassenstufen",-1)),t("div",Ye,[(r(),a(K,null,N(Z,s=>t("div",{key:s,class:"form-check"},[u(t("input",{class:"form-check-input",type:"checkbox",id:"grade-"+s,value:s,"onUpdate:modelValue":e[12]||(e[12]=o=>n.value.grades=o)},null,8,es),[[S,n.value.grades]]),t("label",{class:"form-check-label",for:"grade-"+s},i(s),9,ss)])),64))]),e[30]||(e[30]=t("div",{class:"form-text"},"Mehrfachauswahl möglich (5–12).",-1))]),t("div",ts,[e[31]||(e[31]=t("label",{class:"form-label d-block"},"Ausgeschlossene Geschlechter",-1)),t("div",ls,[(r(),a(K,null,N(H,s=>t("div",{key:s,class:"form-check"},[u(t("input",{class:"form-check-input",type:"checkbox",id:"gender-"+s,value:s,"onUpdate:modelValue":e[13]||(e[13]=o=>n.value.excludedGenders=o)},null,8,ns),[[S,n.value.excludedGenders]]),t("label",{class:"form-check-label",for:"gender-"+s},i(s==="male"?"Männlich":s==="female"?"Weiblich":"Divers"),9,os)])),64))]),e[32]||(e[32]=t("div",{class:"form-text"},"Wähle Geschlechter aus, die von diesem Kurs ausgeschlossen werden sollen.",-1))]),t("div",as,[t("div",rs,[u(t("input",{class:"form-check-input",type:"checkbox",id:"manualAssignmentOnly","onUpdate:modelValue":e[14]||(e[14]=s=>n.value.manualAssignmentOnly=s)},null,512),[[S,n.value.manualAssignmentOnly]]),e[33]||(e[33]=t("label",{class:"form-check-label",for:"manualAssignmentOnly"},"Nur manuelle Zuweisung (von Präferenzverfahren ausschließen)",-1))]),e[34]||(e[34]=t("div",{class:"form-text ms-4"},"Wenn aktiviert, können Schüler*innen diesen Kurs nicht im Präferenzverfahren wählen und er muss manuell zugewiesen werden.",-1))]),t("div",us,[t("div",is,[u(t("input",{class:"form-check-input",type:"checkbox",id:"placeholder","onUpdate:modelValue":e[15]||(e[15]=s=>n.value.placeholder=s)},null,512),[[S,n.value.placeholder]]),e[35]||(e[35]=t("label",{class:"form-check-label",for:"placeholder"},"Platzhalter",-1))])])])])]),e[43]||(e[43]=t("div",{class:"py-3"},null,-1)),x.value?(r(),a("div",ds,[t("div",cs,[t("div",ms,[t("div",{class:"modal-header"},[e[36]||(e[36]=t("h5",{class:"modal-title"},"Kurs wirklich löschen?",-1)),t("button",{type:"button",class:"btn-close",onClick:M,"aria-label":"Schließen"})]),t("div",vs,[$.value>0?(r(),a("div",fs,[e[37]||(e[37]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[38]||(e[38]=t("strong",null,"Achtung:",-1)),e[39]||(e[39]=m(" Es sind aktuell ")),t("strong",null,i($.value),1),e[40]||(e[40]=m(" Schüler*innen diesem Kurs zugewiesen. "))])):c("",!0),t("p",null,[e[41]||(e[41]=m(" Bist Du sicher, dass Du den Kurs ")),t("strong",null,i(n.value.courseId?`[${n.value.courseId}] `:"")+i(n.value.name),1),e[42]||(e[42]=m(" löschen möchtest? "))]),$.value>0?(r(),a("p",ps," Alle Zuweisungen gehen dadurch verloren! ")):c("",!0)]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary",onClick:M},"Abbrechen"),t("button",{type:"button",class:"btn btn-danger",onClick:oe}," Kurs löschen ")])])])])):c("",!0)],32))}}),ws=we(bs,[["__scopeId","data-v-a21d9e2d"]]);export{ws as default};
