import{_ as C}from"./D1SyXKlW.js";import{_ as j}from"./DDAVtPwU.js";import{e as L,g as R,j as T,r as b,k as A,c as u,a as s,q as x,v as S,h as t,I as k,d as o,b as P,w as B,t as N,D as I,G as M,o as c,_ as U}from"./BxrBOXLL.js";import{_ as V}from"./Bn_aXA-9.js";import{u as D}from"./WKQl5LoL.js";const K={class:"container min-vh-100 d-flex align-items-center justify-content-center"},O={class:"col-12 col-md-8 col-lg-5"},$={class:"card shadow-sm border-0"},z={class:"card-body p-3 p-md-5"},W={class:"mb-2"},J=["disabled"],Z={class:"mb-3"},q=["disabled"],F=["disabled"],G={key:0},Y={key:1,class:"d-inline-flex align-items-center"},H={class:"mt-3 d-flex align-items-center justify-content-between gap-2 flex-wrap"},Q=["disabled"],X={key:0},ee={key:1,class:"d-inline-flex align-items-center"},se={class:"text-center"},te={class:"text-muted"},ne={class:"text-center mt-2"},oe={class:"text-muted"},ae=L({__name:"login-internal",setup(re){const m=I(),p=R(),h=T(),g=D(),l=b(""),d=b(""),a=b(!1),r=b(!1),v=A(()=>{const n=l.value.trim();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)});async function w(){var n;if(!a.value){if(!l.value.trim()){p.show("Bitte gib einen Benutzernamen ein.");return}if(!d.value){p.show("Bitte gib ein Passwort ein.");return}a.value=!0;try{const e=await $fetch("/login",{method:"POST",baseURL:m.public.apiBase,credentials:m.public.apiWithCredentials?"include":"omit",headers:{"Content-Type":"application/json"},body:{username:l.value.trim(),password:d.value}}),{token:_,user:f,roles:i}=e;localStorage.setItem("jwt",_),g.setUsername(f.username),g.setName(f.name),g.setRoles(i),h.success("Erfolgreich angemeldet!"),await M(i.includes("ADMIN")?"/admin":i.includes("COURSE_INSTRUCTOR")?"/instructor/attendance":"/preferences")}catch(e){console.error("Login error:",e),a.value=!1,p.show(((n=e==null?void 0:e.data)==null?void 0:n.message)??"Anmeldung fehlgeschlagen. Bitte überprüfe deine Zugangsdaten.")}}}async function E(){var n;if(!(r.value||!v.value)){r.value=!0;try{await $fetch("/users/password-reset",{method:"POST",baseURL:m.public.apiBase,credentials:m.public.apiWithCredentials?"include":"omit",headers:{"Content-Type":"application/json"},body:{email:l.value.trim()}}),h.success("Ein neues Passwort wurde an deine E-Mail-Adresse gesendet.")}catch(e){console.error("Password reset error:",e),p.show(((n=e==null?void 0:e.data)==null?void 0:n.message)??"Das Zurücksetzen des Passworts ist fehlgeschlagen.")}finally{r.value=!1}}}function y(n){n.key==="Enter"&&w()}return(n,e)=>{const _=C,f=j;return c(),u("div",K,[s("div",O,[s("div",$,[s("div",z,[e[10]||(e[10]=s("div",{class:"text-center mb-3"},[s("img",{src:V,alt:"Logo der Johanna-Moosdorf-Schule",class:"img-fluid",style:{"max-height":"80px","object-fit":"contain"},loading:"eager"})],-1)),e[11]||(e[11]=s("h1",{class:"h4 mb-1 text-center"},"iLA Login",-1)),e[12]||(e[12]=s("p",{class:"text-muted mb-4 text-center"}," Anmeldung für Nutzer ohne IServ-Konto ",-1)),s("div",W,[e[2]||(e[2]=s("label",{for:"username",class:"form-label"},"E-Mail-Adresse",-1)),x(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=i=>k(l)?l.value=i:null),type:"email",class:"form-control",placeholder:"E-Mail-Adresse eingeben",disabled:t(a)||t(r),autocomplete:"username",onKeypress:y},null,40,J),[[S,t(l)]])]),s("div",Z,[e[3]||(e[3]=s("label",{for:"password",class:"form-label"},"Passwort",-1)),x(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=i=>k(d)?d.value=i:null),type:"password",class:"form-control",placeholder:"Passwort eingeben",disabled:t(a)||t(r),autocomplete:"current-password",onKeypress:y},null,40,q),[[S,t(d)]])]),s("button",{type:"button",class:"btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center",disabled:t(a)||t(r),onClick:w},[t(a)?(c(),u("span",Y,e[4]||(e[4]=[s("span",{class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},null,-1),o(" Wird angemeldet… ")]))):(c(),u("span",G,"Anmelden"))],8,F),s("div",H,[e[6]||(e[6]=s("small",{class:"text-muted"}," Passwort vergessen? E-Mail eingeben und neues anfordern: ",-1)),s("button",{type:"button",class:"btn btn-outline-secondary btn-sm",disabled:!t(v)||t(a)||t(r),onClick:E},[t(r)?(c(),u("span",ee,e[5]||(e[5]=[s("span",{class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},null,-1),o(" Sende… ")]))):(c(),u("span",X,"Neues Passwort"))],8,Q)]),e[13]||(e[13]=s("div",{class:"mt-3 text-center"},[s("small",{class:"text-muted"},[o(" Probleme bei der Anmeldung? "),s("br"),o(" Support Email an "),s("a",{href:"mailto:ila@jms-muenster.de",class:"link-secondary"},"ila@jms-muenster.de"),o(" schreiben ")])],-1)),e[14]||(e[14]=s("hr",{class:"my-2"},null,-1)),s("div",se,[s("small",te,[e[8]||(e[8]=o(" Schüler melden sich über ")),P(_,{to:"/",class:"link-secondary"},{default:B(()=>e[7]||(e[7]=[o("IServ")])),_:1}),e[9]||(e[9]=o(" an. "))])])])]),s("div",ne,[s("small",oe,[o(" © "+N(new Date().getFullYear())+" Johanna-Moosdorf-Schule | ",1),P(f)])])])])}}}),me=U(ae,[["__scopeId","data-v-a917f8a3"]]);export{me as default};
