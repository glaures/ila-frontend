const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BxrBOXLL.js","./entry.Cy85P2aQ.css"])))=>i.map(i=>d[i]);
import{e as ee,i as se,j as te,g as ne,r,k as D,m as ae,J as le,c as l,a as s,p as C,q as I,x as ie,h as a,I as B,F as g,s as K,d as u,v as oe,t as d,o as i,y as de,C as re,_ as ue}from"./BxrBOXLL.js";import{w as ce}from"./BA3RTNws.js";const me={class:"instructor-attendance"},be={class:"card mb-3"},ve={class:"card-body"},fe=["disabled"],he=["value"],pe={key:0,class:"text-center py-4"},ye={class:"card mb-3"},_e={class:"card-body"},ge={class:"row g-2 align-items-end"},we={class:"col"},ke=["max"],xe={class:"col-auto"},Ce=["disabled"],Se={key:0,class:"spinner-border spinner-border-sm me-1"},Te={key:1,class:"bi bi-plus-lg me-1"},Ne={key:0,class:"text-center py-4"},Le={key:1},De={class:"mb-2"},Ee={class:"list-group"},Ae=["onClick"],Me={class:"text-muted"},$e={class:"text-success"},Fe={key:0,class:"text-danger ms-2"},Ie={key:2,class:"alert alert-info"},Ke={class:"card mb-3"},Ve={class:"card-body"},Be={class:"d-flex justify-content-between align-items-center"},Oe=["disabled"],Ue={key:0,class:"spinner-border spinner-border-sm"},je={key:1,class:"bi bi-trash"},Pe={class:"card mb-3"},ze={class:"card-body"},Re={class:"row g-2 text-center"},We={class:"col-4"},qe={class:"col-4"},Ge={class:"text-success"},Je={class:"col-4"},Ze={class:"text-danger"},He={key:0,class:"text-center py-4"},Qe={key:1,class:"attendee-list"},Xe={class:"card-body py-2"},Ye={class:"d-flex justify-content-between align-items-center"},es={class:"text-muted"},ss={class:"form-check form-switch"},ts=["id","onUpdate:modelValue"],ns=["for"],as={key:2,class:"alert alert-warning"},ls={key:3,class:"sticky-bottom bg-white py-3 border-top"},is=["disabled"],os={key:0,class:"spinner-border spinner-border-sm me-2"},ds={key:1,class:"bi bi-check-lg me-2"},rs={key:3,class:"text-center py-5"},us={class:"modal-dialog modal-dialog-centered"},cs={class:"modal-content"},ms={class:"modal-body"},bs={key:0,class:"alert alert-secondary"},vs={class:"modal-footer"},fs=["disabled"],hs={key:0},ps={key:1},ys=ee({__name:"attendance",setup(_s){const{$authFetch:h}=se(),E=te(),p=ne(),S=r([]),c=r(null),y=r([]),o=r(null),m=r([]),f=r(""),v=r(!1),w=r(!1),A=r(!1),M=r(!1),T=r(!1),N=r(!1),_=r(!1),$=r(null);let k=null;const O=D(()=>new Date().toISOString().split("T")[0]),U=D(()=>m.value.filter(t=>t.present).length),j=D(()=>m.value.filter(t=>!t.present).length),P=D(()=>[...m.value].sort((t,e)=>{const n=t.firstName.localeCompare(e.firstName,"de");return n!==0?n:t.lastName.localeCompare(e.lastName,"de")}));ae(async()=>{if($.value){const{Modal:t}=await le(async()=>{const{Modal:e}=await import("./BxrBOXLL.js").then(n=>n.aM);return{Modal:e}},__vite__mapDeps([0,1]),import.meta.url);k=new t($.value)}await z()});async function z(){var t;try{w.value=!0,S.value=await h("/courses/instructedbyme"),S.value.length===1&&(c.value=S.value[0],await x())}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Laden der Kurse")}finally{w.value=!1}}async function R(){o.value=null,m.value=[],y.value=[],v.value=!1,c.value&&await x()}async function x(){var t;if(c.value)try{A.value=!0,y.value=await h(`/attendance/sessions?course-id=${c.value.id}`)}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Laden der Termine")}finally{A.value=!1}}async function W(){var t;if(!(!c.value||!f.value))try{T.value=!0;const e=await h("/attendance/sessions",{method:"POST",body:{courseId:c.value.id,date:f.value,notes:null}});E.success("Termin erstellt"),f.value="",o.value=e,await V(),await x()}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Erstellen des Termins")}finally{T.value=!1}}async function q(t){o.value=t,await V()}async function V(){var t;if(o.value)try{M.value=!0,m.value=await h(`/attendance/sessions/${o.value.id}/entries`),v.value=!1}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Laden der Teilnehmer")}finally{M.value=!1}}function G(){v.value=!0}async function J(){var t;if(!(!o.value||!v.value))try{N.value=!0;const e=m.value.map(b=>({userName:b.userName,present:b.present,note:b.note}));await h(`/attendance/sessions/${o.value.id}/entries`,{method:"PUT",body:e}),v.value=!1,E.success("Anwesenheiten gespeichert"),await x();const n=y.value.find(b=>{var L;return b.id===((L=o.value)==null?void 0:L.id)});n&&(o.value=n)}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Speichern")}finally{N.value=!1}}function Z(){k&&k.show()}async function H(){var t;if(o.value)try{_.value=!0,await h(`/attendance/sessions/${o.value.id}`,{method:"DELETE"}),E.success("Termin gelöscht"),k&&k.hide(),o.value=null,m.value=[],await x()}catch(e){p.show(((t=e==null?void 0:e.data)==null?void 0:t.message)??"Fehler beim Löschen")}finally{_.value=!1}}function Q(){v.value&&!confirm("Sie haben ungespeicherte Änderungen. Wirklich zurück?")||(o.value=null,m.value=[],v.value=!1)}function X(t){return t?`${ce[t.dayOfWeek]||t.dayOfWeek} ${t.startTime}-${t.endTime}`:""}function F(t){const e=t.split(".");if(e.length===3){const[b,L,Y]=e;return new Date(parseInt(Y),parseInt(L)-1,parseInt(b)).toLocaleDateString("de-DE",{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"})}const n=new Date(t);return isNaN(n.getTime())?t:n.toLocaleDateString("de-DE",{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"})}return(t,e)=>(i(),l("div",me,[e[28]||(e[28]=s("h2",{class:"h5 mb-3"},"Anwesenheiten erfassen",-1)),s("div",be,[s("div",ve,[e[3]||(e[3]=s("label",{class:"form-label fw-bold"},"Kurs auswählen:",-1)),I(s("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>B(c)?c.value=n:null),class:"form-select form-select-lg",onChange:R,disabled:a(w)},[e[2]||(e[2]=s("option",{value:null},"Bitte Kurs wählen...",-1)),(i(!0),l(g,null,K(a(S),n=>(i(),l("option",{key:n.id,value:n},[u(d(n.name),1),n.block?(i(),l(g,{key:0},[u(" - "+d(X(n.block)),1)],64)):C("",!0)],8,he))),128))],40,fe),[[ie,a(c)]])])]),a(w)?(i(),l("div",pe,e[4]||(e[4]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1),s("p",{class:"text-muted mt-2"},"Lade Kurse...",-1)]))):a(c)&&!a(o)?(i(),l(g,{key:1},[s("div",ye,[e[7]||(e[7]=s("div",{class:"card-header bg-primary text-white"},[s("i",{class:"bi bi-plus-circle me-2"}),u(" Neuen Termin erstellen ")],-1)),s("div",_e,[s("div",ge,[s("div",we,[e[5]||(e[5]=s("label",{class:"form-label"},"Datum",-1)),I(s("input",{type:"date",class:"form-control form-control-lg","onUpdate:modelValue":e[1]||(e[1]=n=>B(f)?f.value=n:null),max:a(O)},null,8,ke),[[oe,a(f)]])]),s("div",xe,[s("button",{class:"btn btn-primary btn-lg",onClick:W,disabled:!a(f)||a(T)},[a(T)?(i(),l("span",Se)):(i(),l("i",Te)),e[6]||(e[6]=u(" Erstellen "))],8,Ce)])])])]),a(A)?(i(),l("div",Ne,e[8]||(e[8]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1),s("p",{class:"text-muted mt-2"},"Lade Termine...",-1)]))):a(y).length>0?(i(),l("div",Le,[s("h6",De,[e[9]||(e[9]=s("i",{class:"bi bi-calendar-check me-2"},null,-1)),u(" Bestehende Termine ("+d(a(y).length)+") ",1)]),s("div",Ee,[(i(!0),l(g,null,K(a(y),n=>(i(),l("div",{key:n.id,class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:b=>q(n),style:{cursor:"pointer"}},[s("div",null,[s("strong",null,d(F(n.date)),1),e[10]||(e[10]=s("br",null,null,-1)),s("small",Me,[s("span",$e,d(n.presentCount)+" anwesend",1),n.absentCount>0?(i(),l("span",Fe,d(n.absentCount)+" abwesend",1)):C("",!0)])]),e[11]||(e[11]=s("i",{class:"bi bi-chevron-right text-muted"},null,-1))],8,Ae))),128))])])):(i(),l("div",Ie,e[12]||(e[12]=[s("i",{class:"bi bi-info-circle me-2"},null,-1),u(" Noch keine Termine erfasst. Erstellen Sie einen neuen Termin oben. ")])))],64)):a(o)?(i(),l(g,{key:2},[s("div",Ke,[s("div",Ve,[s("div",Be,[s("div",null,[s("button",{class:"btn btn-outline-secondary btn-sm me-2",onClick:Q},e[13]||(e[13]=[s("i",{class:"bi bi-arrow-left"},null,-1),u(" Zurück ")])),s("strong",null,d(F(a(o).date)),1)]),s("button",{class:"btn btn-outline-danger btn-sm",onClick:Z,disabled:a(_)},[a(_)?(i(),l("span",Ue)):(i(),l("i",je))],8,Oe)])])]),s("div",Pe,[s("div",ze,[s("div",Re,[s("div",We,[e[14]||(e[14]=s("small",{class:"text-muted d-block"},"Gesamt",-1)),s("strong",null,d(a(m).length),1)]),s("div",qe,[e[15]||(e[15]=s("small",{class:"text-muted d-block"},"Anwesend",-1)),s("strong",Ge,d(a(U)),1)]),s("div",Je,[e[16]||(e[16]=s("small",{class:"text-muted d-block"},"Abwesend",-1)),s("strong",Ze,d(a(j)),1)])])])]),a(M)?(i(),l("div",He,e[17]||(e[17]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1),s("p",{class:"text-muted mt-2"},"Lade Teilnehmer...",-1)]))):a(m).length>0?(i(),l("div",Qe,[(i(!0),l(g,null,K(a(P),n=>(i(),l("div",{class:"card mb-2",key:n.userName},[s("div",Xe,[s("div",Ye,[s("div",null,[s("strong",null,d(n.firstName)+" "+d(n.lastName),1),e[18]||(e[18]=s("br",null,null,-1)),s("small",es,"Klasse "+d(n.grade),1)]),s("div",ss,[I(s("input",{class:"form-check-input",type:"checkbox",id:`attendance-${n.userName}`,"onUpdate:modelValue":b=>n.present=b,onChange:G,style:{width:"3rem",height:"1.5rem"}},null,40,ts),[[de,n.present]]),s("label",{class:"form-check-label ms-2",for:`attendance-${n.userName}`},[s("span",{class:re(n.present?"text-success":"text-danger")},d(n.present?"Anwesend":"Abwesend"),3)],8,ns)])])])]))),128))])):(i(),l("div",as,e[19]||(e[19]=[s("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),u(" Keine Teilnehmer für diesen Kurs gefunden. ")]))),a(m).length>0?(i(),l("div",ls,[s("button",{class:"btn btn-success btn-lg w-100",onClick:J,disabled:!a(v)||a(N)},[a(N)?(i(),l("span",os)):(i(),l("i",ds)),u(" "+d(a(v)?"Änderungen speichern":"Keine Änderungen"),1)],8,is)])):C("",!0)],64)):!a(w)&&!a(c)?(i(),l("div",rs,e[20]||(e[20]=[s("i",{class:"bi bi-arrow-up fs-1 text-muted"},null,-1),s("p",{class:"text-muted mt-3"},"Bitte wählen Sie zunächst einen Kurs aus.",-1)]))):C("",!0),s("div",{ref_key:"deleteModal",ref:$,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[s("div",us,[s("div",cs,[e[27]||(e[27]=s("div",{class:"modal-header bg-danger text-white"},[s("h5",{class:"modal-title"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),u(" Termin löschen ")]),s("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Schließen"})],-1)),s("div",ms,[e[23]||(e[23]=s("p",null,"Möchten Sie diesen Termin wirklich löschen?",-1)),a(o)?(i(),l("div",bs,[s("strong",null,d(F(a(o).date)),1),e[21]||(e[21]=s("br",null,null,-1)),e[22]||(e[22]=s("small",{class:"text-muted"},"Alle Anwesenheitsdaten für diesen Termin werden gelöscht.",-1))])):C("",!0)]),s("div",vs,[e[26]||(e[26]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Abbrechen ",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:H,disabled:a(_)},[a(_)?(i(),l("span",hs,e[24]||(e[24]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),u(" Lösche... ")]))):(i(),l("span",ps,e[25]||(e[25]=[s("i",{class:"bi bi-trash me-1"},null,-1),u(" Löschen ")])))],8,fs)])])])],512)]))}}),xs=ue(ys,[["__scopeId","data-v-5b6c329b"]]);export{xs as default};
