import{g as _,A as h,D as f,E as c,G as p,c as S,a as g,o as y}from"./CT84__CY.js";import{u as w}from"./FVPbPdq-.js";const R={class:"container py-5 text-center"},E={__name:"auth-redirect",async setup(U){var u;let e,t;const d=h(),m=_(),o=w(),i=d.query.code;if(i){const r=f(),a=`${r.public.baseUrl.replace(/\/$/,"")}${r.public.oauth.redirectPath}`;try{const{token:s,user:l,roles:n}=([e,t]=c(()=>$fetch(r.public.apiBase+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:{code:i,redirectUri:a}})),e=await e,t(),e);localStorage.setItem("jwt",s),o.setUsername(l.preferred_username),o.setName(l.name),o.setRoles(n),[e,t]=c(()=>p(n.includes("ADMIN")?"/admin":n.includes("COURSE_INSTRUCTOR")?"/instructor/attendance":"/preferences")),await e,t()}catch(s){m.show(((u=s==null?void 0:s.data)==null?void 0:u.message)??"Es ist ein interner Fehler aufgetreten: "+s),[e,t]=c(()=>p("/")),await e,t()}}return(r,a)=>(y(),S("div",R,a[0]||(a[0]=[g("p",null,"Authentifiziere dichâ€¦",-1)])))}};export{E as default};
