import{e as E,i as O,r as v,k as w,m as M,c as l,a as t,p as f,q as W,C as $,F as h,s as y,t as o,o as i,d as p,_ as K}from"./Bt8ervS0.js";const j={class:"d-flex align-items-center justify-content-between mb-3 d-print-none"},L={class:"btn-group"},I=["disabled"],V={key:0},P={key:1},H=["disabled"],q={class:"card mb-4 d-print-none"},z={class:"card-body"},Z={class:"row g-3 align-items-end"},G={class:"col-12 col-md-6"},J=["value"],Q={key:0,class:"col-12 col-md-6"},X={class:"text-muted small"},ee={key:0,class:"alert alert-info"},te={key:1,class:"alert alert-danger"},se={key:2},ne={class:"d-flex align-items-center mb-2 d-print-none"},ae={class:"h5 mb-0"},le={class:"badge bg-light text-dark ms-2"},oe={key:0,class:"row g-3"},ie={class:"card h-100 d-flex flex-column course-print-page"},re={class:"card-header d-none d-print-block bg-white border-0 pt-4"},de={class:"mb-1 text-uppercase small text-muted"},ue={class:"h4 mb-1"},ce={class:"h5 mb-0"},me={class:"card-body d-flex flex-column"},ve={class:"d-flex justify-content-between align-items-start mb-2 d-print-none"},_e={class:"h6 mb-0"},ge={class:"badge bg-secondary"},fe={class:"small text-muted mb-2"},he={class:"d-flex justify-content-between align-items-center border-top pt-2 mb-1"},ye={class:"badge bg-light text-dark"},pe={class:"mb-0 ps-3"},be={key:0,class:"small text-muted"},ke={key:1,class:"alert alert-warning"},De=E({__name:"assignments",setup(Ae){const{$authFetch:b}=O(),d=v(!1),m=v(null),_=v([]),r=v(""),g=v({}),c=v({}),N={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},k=s=>N[s]||s,A=w(()=>{const s=new Set(_.value.map(n=>n.dayOfWeek)),e=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];return Array.from(s).sort((n,a)=>e.indexOf(n)-e.indexOf(a))}),B=w(()=>_.value.filter(s=>s.dayOfWeek===r.value).sort((s,e)=>s.startTime.localeCompare(e.startTime)));function x(s){return`${s.startTime} – ${s.endTime}`}function S(s){if(s.instructor&&s.instructor.trim().length)return s.instructor;const e=s.teacher;return e&&(`${e.firstName??""} ${e.lastName??""}`.trim()||e.userName)||"—"}async function C(){m.value=null,d.value=!0;try{const s=await b("/blocks");_.value=s,!r.value&&_.value.length&&(r.value=A.value[0]||"",r.value&&await D(r.value))}catch(s){m.value=(s==null?void 0:s.message)||"Fehler beim Laden der Blöcke."}finally{d.value=!1}}async function T(s){const e=await b(`/courses?block-id=${encodeURIComponent(s)}`);return g.value[s]=e,e}async function F(s){if(c.value[s])return c.value[s];const e=await b(`/assignments?course-id=${encodeURIComponent(s)}`);return e.sort((n,a)=>n.lastName===a.lastName?n.firstName.localeCompare(a.firstName,"de"):n.lastName.localeCompare(a.lastName,"de")),c.value[s]=e,e}async function D(s){m.value=null,d.value=!0;try{g.value={},c.value={};const e=_.value.filter(u=>u.dayOfWeek===s),a=(await Promise.all(e.map(u=>T(u.id)))).flat();await Promise.all(a.map(u=>F(u.id)))}catch(e){m.value=(e==null?void 0:e.message)||"Fehler beim Laden der Kurse/Teilnehmer."}finally{d.value=!1}}function Y(){r.value&&D(r.value)}function U(){window.print()}async function R(){r.value&&await D(r.value)}return M(C),(s,e)=>(i(),l("div",null,[e[8]||(e[8]=t("h1",null,"Kursbelegungen – Übersicht & Druck",-1)),t("div",j,[t("div",L,[t("button",{class:"btn btn-outline-secondary",onClick:R,disabled:d.value},[d.value?(i(),l("span",P,"Aktualisiere…")):(i(),l("span",V,"Neu laden"))],8,I),t("button",{class:"btn btn-primary",onClick:U,disabled:d.value||!r.value}," Drucken ",8,H)])]),t("div",q,[t("div",z,[t("div",Z,[t("div",G,[e[2]||(e[2]=t("label",{class:"form-label",for:"daySelect"},"Wochentag",-1)),W(t("select",{id:"daySelect",class:"form-select","onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),onChange:Y},[e[1]||(e[1]=t("option",{disabled:"",value:""},"– Bitte wählen –",-1)),(i(!0),l(h,null,y(A.value,n=>(i(),l("option",{key:n,value:n},o(k(n)),9,J))),128))],544),[[$,r.value]])]),r.value?(i(),l("div",Q,[t("div",X," Es werden alle Blöcke am "+o(k(r.value))+" geladen. Für jeden Block werden die angebotenen Kurse und deren Teilnehmer angezeigt. ",1)])):f("",!0)])])]),d.value?(i(),l("div",ee,"Daten werden geladen …")):f("",!0),m.value?(i(),l("div",te,o(m.value),1)):f("",!0),!d.value&&r.value?(i(),l("div",se,[(i(!0),l(h,null,y(B.value,n=>(i(),l("div",{key:n.id,class:"mb-4"},[t("div",ne,[t("h2",ae,"Block "+o(x(n)),1),t("span",le,"ID: "+o(n.id),1)]),g.value[n.id]&&g.value[n.id].length?(i(),l("div",oe,[(i(!0),l(h,null,y(g.value[n.id],a=>(i(),l("div",{key:a.id,class:"col-12 col-md-6 col-lg-4"},[t("div",ie,[t("div",re,[t("div",de,o(k(n.dayOfWeek)),1),t("h1",ue,o(x(n)),1),t("h2",ce,o(a.name),1)]),t("div",me,[t("div",ve,[t("h3",_e,o(a.name),1),t("span",ge,o(a.courseId),1)]),t("div",fe,[t("div",null,[e[3]||(e[3]=p("Raum: ")),t("strong",null,o(a.room||"—"),1)]),t("div",null,[e[4]||(e[4]=p("Leitung: ")),t("strong",null,o(S(a)),1)]),t("div",null,[e[5]||(e[5]=p("Max. TN: ")),t("strong",null,o(a.maxAttendees),1)]),t("div",null,[e[6]||(e[6]=p("Klassen: ")),t("strong",null,o(a.grades.join(",")),1)])]),t("div",null,[t("div",he,[e[7]||(e[7]=t("span",{class:"small text-muted"},"Teilnehmer",-1)),t("span",ye,o((c.value[a.id]||[]).length)+" / "+o(a.maxAttendees),1)]),t("ol",pe,[(i(!0),l(h,null,y(c.value[a.id]||[],u=>(i(),l("li",{key:u.userUserName,class:"small"},o(u.lastName)+", "+o(u.firstName),1))),128)),(c.value[a.id]||[]).length===0?(i(),l("li",be,"(Keine Zuordnungen) ")):f("",!0)])])])])]))),128))])):(i(),l("div",ke,"Für diesen Block sind keine Kurse hinterlegt."))]))),128))])):f("",!0)]))}}),we=K(De,[["__scopeId","data-v-fe33ebc4"]]);export{we as default};
