const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./T0Q76loc.js","./entry.Cy85P2aQ.css"])))=>i.map(i=>d[i]);
import{e as se,g as te,j as le,i as ne,r as u,z as ae,k as F,m as oe,I as re,c as a,a as s,d,t as r,p as g,A as ie,F as P,s as L,B,q as K,v as de,C as M,o,_ as ue}from"./T0Q76loc.js";const ce={class:"container-fluid py-3"},me={class:"d-flex align-items-center justify-content-between mb-3"},ve={class:"h4 m-0"},be={class:"card mb-3"},fe={key:0,class:"card-body"},he={class:"row"},pe={class:"col-md-6"},we={class:"col-md-6"},ge={key:0,class:"row"},ye={class:"col-12"},_e={class:"text-muted"},Ne={class:"row"},ke={class:"col-lg-7"},Ce={class:"card"},Ie={class:"card-header"},Te={class:"d-flex align-items-center justify-content-between"},xe={class:"mb-0"},$e={class:"card-body"},Pe={key:0,class:"text-center py-4"},Le={key:1,class:"alert alert-info"},Ae={key:2,class:"table-responsive"},De={class:"table table-hover"},Ee={class:"text-end"},Fe=["onClick","disabled"],Ke={key:0},Se={key:1,class:"bi bi-trash"},Ue={class:"col-lg-5"},ze={class:"card mb-3"},Be={class:"card-body"},Me={class:"mb-3"},Qe={class:"position-relative"},Ve=["disabled"],Re={key:0,class:"dropdown-menu show w-100 shadow",style:{"max-height":"300px","overflow-y":"auto"}},je=["onClick"],qe={class:"d-flex justify-content-between align-items-center"},Oe={class:"text-muted"},He={class:"badge bg-secondary"},Ze={key:1,class:"dropdown-menu show w-100"},Ge={class:"form-text"},Je=["disabled"],We={key:0},Xe={key:1},Ye={class:"card"},es={class:"card-body"},ss={class:"mb-3"},ts=["value"],ls={class:"mb-3"},ns=["disabled"],as=["value"],os={key:0,class:"form-text"},rs=["disabled"],is={key:0},ds={key:1},us={class:"modal-dialog"},cs={class:"modal-content"},ms={class:"modal-body"},vs={key:0,class:"alert alert-warning"},bs={class:"text-muted"},fs=se({__name:"[id]",setup(hs){const b=te(),p=le(),Q=ae(),{$authFetch:f}=ne(),k=u(Q.params.id),c=u(null),w=u([]),S=u([]),C=u([]),U=u([]),A=u(!1),I=u(!1),T=u(null),x=u(!1),$=u(!1),y=u(!1),i=u({userName:"",searchQuery:"",showDropdown:!1}),m=u({selectedPeriodId:"",selectedCourseId:""}),h=u(null),D=u(null);let _=null;const V=F(()=>[...w.value].sort((l,e)=>{const n=`${l.lastName} ${l.firstName}`.toLowerCase(),t=`${e.lastName} ${e.firstName}`.toLowerCase();return n.localeCompare(t)})),R=F(()=>{if(!c.value)return"";const l=w.value.length;return l<c.value.minAttendees?"badge bg-danger":l>c.value.maxAttendees?"badge bg-warning":"badge bg-success"}),E=F(()=>{const l=i.value.searchQuery.toLowerCase().trim();if(!l)return[];const e=new Set(w.value.map(n=>n.userUserName));return U.value.filter(n=>!e.has(n.userName)).filter(n=>{const t=`${n.firstName} ${n.lastName}`.toLowerCase(),v=n.userName.toLowerCase();return t.includes(l)||v.includes(l)}).slice(0,10).sort((n,t)=>{const v=`${n.lastName} ${n.firstName}`.toLowerCase(),ee=`${t.lastName} ${t.firstName}`.toLowerCase();return v.localeCompare(ee)})});async function j(){var l;try{c.value=await f(`/courses/${k.value}`)}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden des Kurses: "+e)}}async function N(){var l;A.value=!0;try{w.value=await f(`/assignments?course-id=${k.value}`)}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Teilnehmer: "+e)}finally{A.value=!1}}async function q(){var l;try{S.value=await f("/periods")}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Perioden: "+e)}}async function O(){var l;y.value=!0;try{U.value=await f("/users")}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Benutzer: "+e)}finally{y.value=!1}}function H(l){i.value.userName=l.userName,i.value.searchQuery=`${l.lastName}, ${l.firstName} (${l.userName})`,i.value.showDropdown=!1}function z(){i.value.showDropdown=i.value.searchQuery.length>0,i.value.userName=""}function Z(){setTimeout(()=>{i.value.showDropdown=!1},200)}async function G(){var l;if(!m.value.selectedPeriodId){C.value=[];return}$.value=!0,m.value.selectedCourseId="";try{const e=await f(`/courses?period-id=${m.value.selectedPeriodId}`);C.value=e.filter(n=>n.id!==parseInt(k.value))}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Laden der Kurse: "+e)}finally{$.value=!1}}async function J(){var l,e;if(i.value.userName){I.value=!0;try{const n={userName:i.value.userName,courseId:(l=c.value)==null?void 0:l.courseId},t=await f("/assignments",{method:"POST",body:n});t.errors&&t.errors.length>0?t.errors.forEach(v=>b.show(v)):(t.warnings&&t.warnings.length>0&&t.warnings.forEach(v=>p.warning(v)),t.info&&t.info.length>0&&t.info.forEach(v=>p.info(v)),p.success(`Teilnehmer ${i.value.userName} wurde hinzugefügt`),i.value.userName="",i.value.searchQuery="",i.value.showDropdown=!1,await N())}catch(n){b.show(((e=n==null?void 0:n.data)==null?void 0:e.message)??"Fehler beim Hinzufügen des Teilnehmers: "+n)}finally{I.value=!1}}}function W(l){h.value=l,_&&_.show()}async function X(){var e;if(!h.value)return;const l=h.value.id;T.value=l;try{await f(`/assignments/${l}`,{method:"DELETE"}),p.success("Teilnehmer wurde entfernt"),_&&_.hide(),await N()}catch(n){b.show(((e=n==null?void 0:n.data)==null?void 0:e.message)??"Fehler beim Entfernen des Teilnehmers: "+n)}finally{T.value=null,h.value=null}}async function Y(){var l;if(m.value.selectedCourseId){x.value=!0;try{const e=await f(`/assignments/copy-assignments?source-course-id=${m.value.selectedCourseId}&destination-course-id=${k.value}`,{method:"POST"});e.errors&&e.errors.length>0&&e.errors.forEach(n=>b.show(n)),e.warnings&&e.warnings.length>0&&e.warnings.forEach(n=>p.warning(n,6e3)),e.info&&e.info.length>0&&e.info.forEach(n=>p.info(n,6e3)),(!e.errors||e.errors.length===0)&&(p.success("Teilnehmer wurden erfolgreich kopiert"),m.value.selectedPeriodId="",m.value.selectedCourseId="",C.value=[],await N())}catch(e){b.show(((l=e==null?void 0:e.data)==null?void 0:l.message)??"Fehler beim Kopieren der Teilnehmer: "+e)}finally{x.value=!1}}}return oe(async()=>{if(D.value){const{Modal:l}=await re(async()=>{const{Modal:e}=await import("./T0Q76loc.js").then(n=>n.aK);return{Modal:e}},__vite__mapDeps([0,1]),import.meta.url);_=new l(D.value)}await Promise.all([j(),N(),q(),O()])}),(l,e)=>{var n;return o(),a("div",ce,[s("div",me,[s("h1",ve,[e[4]||(e[4]=s("i",{class:"bi bi-book me-2"},null,-1)),d(" "+r(((n=c.value)==null?void 0:n.name)||"Lade Kurs..."),1)]),s("div",null,[s("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=t=>l.$router.back())},e[5]||(e[5]=[s("i",{class:"bi bi-arrow-left me-1"},null,-1),d(" Zurück ")]))])]),s("div",be,[e[13]||(e[13]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},"Kursdetails")],-1)),c.value?(o(),a("div",fe,[s("div",he,[s("div",pe,[s("p",null,[e[6]||(e[6]=s("strong",null,"Kurs-ID:",-1)),d(" "+r(c.value.courseId),1)]),s("p",null,[e[7]||(e[7]=s("strong",null,"Dozent:",-1)),d(" "+r(c.value.instructor||"N/A"),1)]),s("p",null,[e[8]||(e[8]=s("strong",null,"Raum:",-1)),d(" "+r(c.value.room||"N/A"),1)])]),s("div",we,[s("p",null,[e[9]||(e[9]=s("strong",null,"Min. Teilnehmer:",-1)),d(" "+r(c.value.minAttendees),1)]),s("p",null,[e[10]||(e[10]=s("strong",null,"Max. Teilnehmer:",-1)),d(" "+r(c.value.maxAttendees),1)]),s("p",null,[e[11]||(e[11]=s("strong",null,"Aktuelle Teilnehmer:",-1)),s("span",{class:ie(R.value)},r(w.value.length),3)])])]),c.value.description?(o(),a("div",ge,[s("div",ye,[e[12]||(e[12]=s("p",null,[s("strong",null,"Beschreibung:")],-1)),s("p",_e,r(c.value.description),1)])])):g("",!0)])):g("",!0)]),s("div",Ne,[s("div",ke,[s("div",Ce,[s("div",Ie,[s("div",Te,[s("h5",xe,[e[14]||(e[14]=s("i",{class:"bi bi-people me-2"},null,-1)),d(" Teilnehmer ("+r(w.value.length)+") ",1)]),s("button",{class:"btn btn-sm btn-outline-secondary",onClick:N},e[15]||(e[15]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]))])]),s("div",$e,[A.value?(o(),a("div",Pe,e[16]||(e[16]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Lade...")],-1)]))):w.value.length===0?(o(),a("div",Le,e[17]||(e[17]=[s("i",{class:"bi bi-info-circle me-2"},null,-1),d(" Dieser Kurs hat noch keine Teilnehmer. ")]))):(o(),a("div",Ae,[s("table",De,[e[20]||(e[20]=s("thead",null,[s("tr",null,[s("th",null,"Username"),s("th",null,"Vorname"),s("th",null,"Nachname"),s("th",{class:"text-end"},"Aktionen")])],-1)),s("tbody",null,[(o(!0),a(P,null,L(V.value,t=>(o(),a("tr",{key:t.id},[s("td",null,r(t.userUserName),1),s("td",null,r(t.firstName),1),s("td",null,r(t.lastName),1),s("td",Ee,[s("button",{class:"btn btn-sm btn-danger",onClick:v=>W(t),disabled:T.value===t.id},[T.value===t.id?(o(),a("span",Ke,e[18]||(e[18]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1)]))):(o(),a("i",Se)),e[19]||(e[19]=d(" Entfernen "))],8,Fe)])]))),128))])])]))])])]),s("div",Ue,[s("div",ze,[e[26]||(e[26]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-person-plus me-2"}),d(" Teilnehmer hinzufügen ")])],-1)),s("div",Be,[s("form",{onSubmit:B(J,["prevent"])},[s("div",Me,[e[23]||(e[23]=s("label",{for:"userSearch",class:"form-label"},"Teilnehmer suchen",-1)),s("div",Qe,[K(s("input",{type:"text",class:"form-control",id:"userSearch","onUpdate:modelValue":e[1]||(e[1]=t=>i.value.searchQuery=t),onInput:z,onFocus:z,onBlur:Z,placeholder:"Name oder Username eingeben...",autocomplete:"off",disabled:y.value},null,40,Ve),[[de,i.value.searchQuery]]),i.value.showDropdown&&E.value.length>0?(o(),a("div",Re,[(o(!0),a(P,null,L(E.value,t=>(o(),a("button",{key:t.userName,type:"button",class:"dropdown-item",onClick:v=>H(t)},[s("div",qe,[s("div",null,[s("strong",null,r(t.lastName)+", "+r(t.firstName),1),e[21]||(e[21]=s("br",null,null,-1)),s("small",Oe,r(t.userName),1)]),s("span",He,"Klasse "+r(t.grade),1)])],8,je))),128))])):g("",!0),i.value.showDropdown&&i.value.searchQuery&&E.value.length===0?(o(),a("div",Ze,e[22]||(e[22]=[s("div",{class:"dropdown-item text-muted"},[s("i",{class:"bi bi-search me-2"}),d(" Keine Benutzer gefunden ")],-1)]))):g("",!0)]),s("div",Ge,r(y.value?"Lade Benutzer...":"Suche nach Name oder Username"),1)]),s("button",{type:"submit",class:"btn btn-primary w-100",disabled:I.value||!i.value.userName||y.value},[I.value?(o(),a("span",We,e[24]||(e[24]=[s("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),d(" Füge hinzu... ")]))):(o(),a("span",Xe,e[25]||(e[25]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),d(" Teilnehmer hinzufügen ")])))],8,Je)],32)])]),s("div",Ye,[e[35]||(e[35]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-copy me-2"}),d(" Teilnehmer kopieren ")])],-1)),s("div",es,[s("form",{onSubmit:B(Y,["prevent"])},[s("div",ss,[e[28]||(e[28]=s("label",{for:"period",class:"form-label"},"Periode wählen",-1)),K(s("select",{class:"form-select",id:"period","onUpdate:modelValue":e[2]||(e[2]=t=>m.value.selectedPeriodId=t),onChange:G,required:""},[e[27]||(e[27]=s("option",{value:""},"-- Bitte wählen --",-1)),(o(!0),a(P,null,L(S.value,t=>(o(),a("option",{key:t.id,value:t.id},r(t.name),9,ts))),128))],544),[[M,m.value.selectedPeriodId]])]),s("div",ls,[e[31]||(e[31]=s("label",{for:"sourceCourse",class:"form-label"},"Quellkurs wählen",-1)),K(s("select",{class:"form-select",id:"sourceCourse","onUpdate:modelValue":e[3]||(e[3]=t=>m.value.selectedCourseId=t),disabled:!m.value.selectedPeriodId||$.value,required:""},[e[29]||(e[29]=s("option",{value:""},"-- Bitte wählen --",-1)),(o(!0),a(P,null,L(C.value,t=>(o(),a("option",{key:t.id,value:t.id},r(t.name)+" ("+r(t.courseId)+") ",9,as))),128))],8,ns),[[M,m.value.selectedCourseId]]),$.value?(o(),a("div",os,e[30]||(e[30]=[s("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),d(" Lade Kurse... ")]))):g("",!0)]),s("button",{type:"submit",class:"btn btn-warning w-100",disabled:x.value||!m.value.selectedCourseId},[x.value?(o(),a("span",is,e[32]||(e[32]=[s("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),d(" Kopiere... ")]))):(o(),a("span",ds,e[33]||(e[33]=[s("i",{class:"bi bi-clipboard-check me-2"},null,-1),d(" Teilnehmer kopieren ")])))],8,rs),e[34]||(e[34]=s("div",{class:"form-text mt-2"}," Alle Teilnehmer des gewählten Kurses werden zu diesem Kurs hinzugefügt. ",-1))],32)])])])]),s("div",{class:"modal fade",id:"confirmDeleteModal",tabindex:"-1",ref_key:"deleteModal",ref:D},[s("div",us,[s("div",cs,[e[40]||(e[40]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Teilnehmer entfernen"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",ms,[e[37]||(e[37]=s("p",null,"Möchtest du wirklich folgenden Teilnehmer aus dem Kurs entfernen?",-1)),h.value?(o(),a("div",vs,[s("strong",null,r(h.value.firstName)+" "+r(h.value.lastName),1),e[36]||(e[36]=s("br",null,null,-1)),s("small",bs,r(h.value.userUserName),1)])):g("",!0)]),s("div",{class:"modal-footer"},[e[39]||(e[39]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Abbrechen ",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:X},e[38]||(e[38]=[s("i",{class:"bi bi-trash me-2"},null,-1),d(" Entfernen ")]))])])])],512)])}}}),ws=ue(fs,[["__scopeId","data-v-04e90720"]]);export{ws as default};
