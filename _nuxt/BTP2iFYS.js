import{_ as F}from"./BWAt2w0G.js";import{u as O}from"./DXNwklRK.js";import{e as U,ae as W,i as V,j,g as B,k as p,r as b,n as H,c as o,a as s,b as P,w as Z,t as u,F as S,s as T,p as C,o as l,d as N,M as q,_ as G}from"./DNoNEisY.js";import{w as J}from"./BA3RTNws.js";const Q={class:"container-fluid py-3"},X={class:"d-flex align-items-center justify-content-between mb-3"},ee={class:"h4 mb-0 d-inline-block align-middle"},se=["disabled"],te={key:0},ne={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ae={key:0,class:"text-center py-5"},oe={key:1,class:"alert alert-info"},le={key:2},ie={class:"card-header d-flex align-items-center"},re={key:0,class:"badge bg-warning text-dark ms-2",title:"Mehrere Kurse am selben Tag"},ue={class:"list-group list-group-flush"},de={class:"fw-semibold"},ce={class:"small text-muted"},me={class:"ms-2"},be=["onClick","disabled"],fe={key:0,class:"spinner-border spinner-border-sm",role:"status"},_e={key:1},ve={class:"modal-dialog"},he={class:"modal-content"},pe={class:"modal-body"},ge={key:0,class:"fw-semibold mb-0"},ye=U({__name:"[username]",setup(ke){const E=W(),{$authFetch:D}=V(),L=O(),z=j(),A=B(),g=p(()=>L.selectedId),f=p(()=>E.params.username),_=b([]),d=b(!0),v=b(null),y=b(null),c=b(null);let i=null;const M=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"],I=p(()=>{var t,r;const e={};for(const a of _.value){if(!((r=(t=a.course)==null?void 0:t.block)!=null&&r.dayOfWeek))continue;const n=a.course.block.dayOfWeek;e[n]||(e[n]=[]),e[n].push(a)}return M.filter(a=>{var n;return(n=e[a])==null?void 0:n.length}).map(a=>({dayOfWeek:a,dayLabel:J[a]??a,assignments:e[a].sort((n,h)=>{var m,x;return(((m=n.course.block)==null?void 0:m.startTime)??"").localeCompare(((x=h.course.block)==null?void 0:x.startTime)??"")})}))}),R=p(()=>{const e=_.value[0];return e!=null&&e.firstName&&(e!=null&&e.lastName)?`${e.firstName} ${e.lastName}`:f.value});async function k(){var e;if(!g.value||!f.value){d.value=!1;return}d.value=!0;try{const t=await D(`/assignments?user-name=${encodeURIComponent(f.value)}&period-id=${g.value}`);_.value=Array.isArray(t)?t:[]}catch(t){A.show(((e=t==null?void 0:t.data)==null?void 0:e.message)??"Fehler beim Laden der Kurszuweisungen")}finally{d.value=!1}}function Y(e){c.value=e,y.value&&!i&&(i=new q(y.value)),i==null||i.show()}function w(){i==null||i.hide(),c.value=null}async function $(){var t;if(!c.value)return;const e=c.value;v.value=e.id,w();try{await D(`/assignments/${e.id}`,{method:"DELETE"}),z.success("Kurszuweisung wurde entfernt"),await k()}catch(r){A.show(((t=r==null?void 0:r.data)==null?void 0:t.message)??"Fehler beim Entfernen der Kurszuweisung")}finally{v.value=null}}function K(e){return e?e.substring(0,5):""}return H([g,f],()=>{k()},{immediate:!0}),(e,t)=>{const r=F;return l(),o("div",Q,[s("div",X,[s("div",null,[P(r,{to:"/admin/problems",class:"btn btn-outline-secondary btn-sm me-2"},{default:Z(()=>t[0]||(t[0]=[N(" ← Zurück ")])),_:1}),s("h1",ee," Kurszuweisungen: "+u(R.value),1)]),s("button",{class:"btn btn-outline-secondary btn-sm",onClick:k,disabled:d.value},[d.value?(l(),o("span",ne)):(l(),o("span",te,"Neu laden"))],8,se)]),d.value?(l(),o("div",ae,t[1]||(t[1]=[s("div",{class:"spinner-border",role:"status","aria-hidden":"true"},null,-1),s("div",{class:"mt-2"},"Lade Kurszuweisungen …",-1)]))):_.value.length===0?(l(),o("div",oe," Keine Kurszuweisungen vorhanden. ")):(l(),o("div",le,[(l(!0),o(S,null,T(I.value,a=>(l(),o("div",{key:a.dayOfWeek,class:"card mb-3"},[s("div",ie,[s("strong",null,u(a.dayLabel),1),a.assignments.length>1?(l(),o("span",re,u(a.assignments.length)+" Kurse ",1)):C("",!0)]),s("ul",ue,[(l(!0),o(S,null,T(a.assignments,n=>{var h,m;return l(),o("li",{key:n.id,class:"list-group-item d-flex justify-content-between align-items-center"},[s("div",null,[s("div",de,u(n.course.name),1),s("div",ce,[N(u(K((h=n.course.block)==null?void 0:h.startTime))+" – "+u(K((m=n.course.block)==null?void 0:m.endTime))+" ",1),s("span",me,[t[2]||(t[2]=N("Kurs-ID: ")),s("code",null,u(n.course.courseId),1)])])]),s("button",{class:"btn btn-outline-danger btn-sm",onClick:x=>Y(n),disabled:v.value===n.id,title:"Kurszuweisung entfernen"},[v.value===n.id?(l(),o("span",fe)):(l(),o("span",_e,"Entfernen"))],8,be)])}),128))])]))),128))])),s("div",{ref_key:"deleteModalRef",ref:y,class:"modal fade",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},[s("div",ve,[s("div",he,[s("div",{class:"modal-header"},[t[3]||(t[3]=s("h5",{class:"modal-title",id:"deleteModalLabel"},"Kurszuweisung entfernen",-1)),s("button",{type:"button",class:"btn-close",onClick:w,"aria-label":"Schließen"})]),s("div",pe,[t[4]||(t[4]=s("p",null,"Möchtest du die folgende Kurszuweisung wirklich entfernen?",-1)),c.value?(l(),o("p",ge,u(c.value.course.name),1)):C("",!0)]),s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary",onClick:w}," Abbrechen "),s("button",{type:"button",class:"btn btn-danger",onClick:$}," Entfernen ")])])])],512)])}}}),Ae=G(ye,[["__scopeId","data-v-1e182a2a"]]);export{Ae as default};
