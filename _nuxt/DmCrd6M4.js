import{_ as G,k as $,c as o,o as r,a as t,p as d,C as z,e as ae,g as le,i as ne,r as P,m as oe,n as re,q as y,v as E,F as L,s as q,t as b,d as v,y as B,b as K,z as ie,A as ue}from"./DNoNEisY.js";const de=["value","placeholder"],ce={key:0,class:"invalid-feedback"},me={__name:"DateInput",props:{modelValue:String,placeholder:{type:String,default:"TT.MM.JJJJ"},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(w,{emit:k}){const g=w,D=k,p=u=>{const c=u.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!c)return u;const[x,f,J,N]=c,V=f.padStart(2,"0"),T=J.padStart(2,"0");return`${V}.${T}.${N}`},m=u=>{const c=p(u);D("update:modelValue",c)},h=$(()=>g.modelValue),l=$(()=>!g.modelValue&&!g.required?!0:/^\d{2}\.\d{2}\.\d{4}$/.test(g.modelValue));return(u,c)=>(r(),o("div",null,[t("input",{value:h.value,onInput:c[0]||(c[0]=x=>m(x.target.value)),type:"text",class:z(["form-control",{"is-invalid":!l.value&&w.modelValue}]),placeholder:w.placeholder},null,42,de),!l.value&&w.modelValue?(r(),o("div",ce," Bitte ein gültiges Datum im Format TT.MM.JJJJ eingeben. ")):d("",!0)]))}},W=G(me,[["__scopeId","data-v-e9fcc0f2"]]),he={class:"container-fluid py-3"},ve={class:"row g-3"},fe={class:"col-12 col-xl-4"},be={class:"card"},ge={class:"card-body"},pe={key:0,class:"list-group mt-2",style:{"max-height":"240px",overflow:"auto"}},ye=["onClick"],ke={key:0,class:"me-2","aria-label":"aktuell"},xe={class:"text-muted d-block"},_e={class:"badge bg-light text-dark"},Pe={class:"list-group small"},we=["onClick"],De={key:0,class:"me-2","aria-label":"aktuell"},Se={class:"ms-2"},Ce={key:0,class:"badge bg-success me-1"},$e={key:1,class:"badge bg-info me-1"},Ve={key:2,class:"badge bg-warning text-dark me-1"},Te={key:3,class:"badge bg-secondary"},Ee={key:0,class:"col-12 col-xl-8"},ze={class:"card shadow-sm"},Je={class:"card-body"},Ne={class:"d-flex justify-content-between align-items-center mb-3"},Fe={class:"card-title mb-0"},Ue={key:0,class:"text-muted"},Be={key:0,class:"alert alert-info py-2"},Ie={key:1,class:"alert alert-warning py-2"},Me={class:"mb-4"},je={class:"row g-3"},Ae={class:"col-md-8"},Le={class:"col-md-4 d-flex align-items-end"},qe={class:"form-check mt-4"},Ke={class:"col-12 d-flex flex-wrap gap-3 align-items-center"},We={class:"form-check"},Ge=["disabled"],Ze={class:"form-check"},Oe={class:"mb-4"},Re={class:"row g-3"},He={class:"col-sm-6"},Qe={class:"col-sm-6"},Xe={class:"mb-4"},Ye={class:"row g-3"},et={class:"col-sm-6"},tt={class:"col-sm-6"},st={key:0,class:"col-12"},at={class:"d-flex flex-wrap gap-2 mt-4"},lt=["disabled"],nt={key:0,class:"spinner-border spinner-border-sm me-2"},ot=["disabled"],rt=["disabled"],it={key:1,class:"col-12 col-xl-8"},ut=ae({__name:"index",setup(w){const k=le(),g=ue(),D=ie(),{$authFetch:p}=ne(),m=P([]),h=P(null),l=P(null),u=P(!1),c=P(""),x=P([]),f=$(()=>{var a;return((a=l.value)==null?void 0:a.id)==null}),J=$(()=>{var n,i;if(!((n=l.value)!=null&&n.exchangePhaseStart)||!((i=l.value)!=null&&i.exchangePhaseEnd))return"Nicht konfiguriert";const a=new Date,e=new Date(l.value.exchangePhaseStart),s=new Date(l.value.exchangePhaseEnd);return a<e?`Beginnt am ${F(e)}`:a>s?`Beendet seit ${F(s)}`:`Aktiv bis ${F(s)}`}),N=$(()=>{var n,i;if(!((n=l.value)!=null&&n.exchangePhaseStart)||!((i=l.value)!=null&&i.exchangePhaseEnd))return"alert-secondary";const a=new Date,e=new Date(l.value.exchangePhaseStart),s=new Date(l.value.exchangePhaseEnd);return a<e?"alert-info":a>s?"alert-secondary":"alert-success"});function V(a){if(!a)return null;const e=a.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})$/);if(!e)return null;const[,s,n,i,_,U]=e;return`${i}-${n}-${s}T${_}:${U}`}function T(a){if(!a)return null;const e=a.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})/);if(!e)return null;const[,s,n,i,_,U]=e;return`${i}.${n}.${s} ${_}:${U}`}function Z(a){return{...a,exchangePhaseStart:V(a.exchangePhaseStart),exchangePhaseEnd:V(a.exchangePhaseEnd)}}function I(a){return{...a,exchangePhaseStart:T(a.exchangePhaseStart),exchangePhaseEnd:T(a.exchangePhaseEnd)}}function M(a){return{...a}}function O(){return{id:null,name:"",startDate:"",endDate:"",visible:!0,current:!1,isClosed:!1,exchangePhaseStart:null,exchangePhaseEnd:null}}function F(a){return a.toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function R(a){const e=s=>s.split(".").reverse().join("-");return[...a].sort((s,n)=>{if(s.current!==n.current)return s.current?-1:1;const i=e(s.startDate||"00.00.0000"),_=e(n.startDate||"00.00.0000");return i!==_?i.localeCompare(_):(s.name||"").localeCompare(n.name||"")})}function j(a,e){return{active:e,"border border-2 border-info current-item":a.current&&!e}}async function H(){var a;try{const e=await p("/periods",{method:"GET"});m.value=R((e||[]).map(Z))}catch(e){k.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}}function S(a){h.value=a,l.value=M(a),D.replace({path:`/admin/phasen/${a.id}`}).catch(()=>{})}function Q(){h.value=null,l.value=O(),D.replace({path:"/admin/phasen"}).catch(()=>{})}function X(){l.value=h.value?M(h.value):null}function Y(){const a=c.value.trim().toLowerCase();x.value=a?m.value.filter(e=>(e.name||"").toLowerCase().includes(a)||(e.startDate||"").includes(a)||(e.endDate||"").includes(a)||String(e.id||"").includes(a)).slice(0,20):[]}async function ee(){var a;if(!(!l.value||l.value.id==null))try{if(l.value.isClosed&&!confirm("Diese Phase ist geschlossen. Trotzdem zur aktuellen Phase machen?"))return;u.value=!0;const e=I({...l.value,current:!0}),s=await p(`/periods/${l.value.id}`,{method:"PUT",body:e});await C();const n=m.value.find(i=>i.id===s.id);n&&S(n)}catch(e){k.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{u.value=!1}}async function te(){var a;if(l.value){u.value=!0;try{const e=I({...l.value});if(e.current&&e.isClosed&&!confirm("Diese Phase ist geschlossen. Trotzdem als aktuelle Phase speichern?")){u.value=!1;return}let s;l.value.id==null?s=await p("/periods",{method:"POST",body:e}):s=await p(`/periods/${l.value.id}`,{method:"PUT",body:e}),await C();const n=m.value.find(i=>i.id===s.id);n&&S(n)}catch(e){k.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{u.value=!1}}}async function se(){var a;if(!(!l.value||l.value.id==null)&&confirm("Diese Phase wirklich löschen?")){u.value=!0;try{await p(`/periods/${l.value.id}`,{method:"DELETE"}),await C(),h.value=null,l.value=null,D.replace({path:"/admin/phasen"}).catch(()=>{})}catch(e){k.show(((a=e==null?void 0:e.data)==null?void 0:a.message)??"Es ist ein interner Fehler aufgetreten: "+e)}finally{u.value=!1}}}async function A(){const a=Number(g.params.id);if(a&&m.value.length){const e=m.value.find(s=>s.id===a);e&&S(e)}}async function C(){await H(),await A()}return oe(async()=>{await C()}),re(()=>g.params.id,async()=>{await A()}),(a,e)=>(r(),o("div",he,[e[29]||(e[29]=t("div",{class:"d-flex align-items-center justify-content-between mb-3"},[t("div",{class:"h4 m-0"},"Phasen")],-1)),t("div",ve,[t("div",fe,[t("div",be,[t("div",ge,[e[9]||(e[9]=t("label",{class:"form-label"},"Suchen",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"text",class:"form-control",placeholder:"Name der Phase oder Datum (z. B. 12.09.2025)",onInput:Y},null,544),[[E,c.value]]),x.value.length?(r(),o("div",pe,[(r(!0),o(L,null,q(x.value,s=>{var n;return r(),o("button",{key:s.id,class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-center",j(s,((n=h.value)==null?void 0:n.id)===s.id)]),onClick:i=>S(s)},[t("span",null,[s.current?(r(),o("span",ke,"⭐")):d("",!0),v(" "+b(s.name)+" ",1),t("small",xe,b(s.startDate)+" – "+b(s.endDate),1)]),t("span",_e,"#"+b(s.id),1)],10,ye)}),128))])):d("",!0),t("div",{class:"d-grid gap-2 mt-3"},[t("button",{class:"btn btn-primary",onClick:Q},"Neue Phase anlegen"),t("button",{class:"btn btn-outline-secondary",onClick:C},"Neu laden")]),e[10]||(e[10]=t("hr",{class:"my-4"},null,-1)),e[11]||(e[11]=t("h6",{class:"text-muted mb-2"},"Alle Phasen",-1)),t("ul",Pe,[(r(!0),o(L,null,q(m.value,s=>{var n;return r(),o("li",{key:s.id,class:z(["list-group-item d-flex justify-content-between align-items-center",j(s,((n=h.value)==null?void 0:n.id)===s.id)]),role:"button",onClick:i=>S(s)},[t("span",null,[s.current?(r(),o("span",De,"⭐")):d("",!0),v(" "+b(s.name),1)]),t("span",Se,[s.visible?(r(),o("span",Ce,"sichtbar")):d("",!0),s.current?(r(),o("span",$e,"aktuell")):d("",!0),s.exchangePhaseActive?(r(),o("span",Ve,"Wechselphase")):d("",!0),s.isClosed?(r(),o("span",Te,"geschlossen")):d("",!0)])],10,we)}),128))])])])]),l.value?(r(),o("div",Ee,[t("div",ze,[t("div",Je,[t("div",Ne,[t("h5",Fe,b(f.value?"Neue Phase":"Phase bearbeiten: "+(l.value.name||"")),1),f.value?d("",!0):(r(),o("small",Ue,"ID: "+b(l.value.id),1))]),!f.value&&l.value.current?(r(),o("div",Be," Diese Phase ist aktuell. ")):d("",!0),!f.value&&l.value.isClosed?(r(),o("div",Ie,e[12]||(e[12]=[v(" Diese Phase ist "),t("strong",null,"geschlossen",-1),v(". Wenn du sie zur "),t("em",null,"aktuellen",-1),v(" Phase machst, steht sie Nutzern ggf. nicht für neue Kurswahlen zur Verfügung. Bitte prüfe das sorgfältig. ")]))):d("",!0),t("fieldset",Me,[e[17]||(e[17]=t("legend",{class:"h6 text-muted border-bottom pb-2 mb-3"},"Grunddaten",-1)),t("div",je,[t("div",Ae,[e[13]||(e[13]=t("label",{class:"form-label"},"Name",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.name=s),type:"text",class:"form-control",placeholder:"z. B. Schuljahr 2025/26 – Halbjahr 1"},null,512),[[E,l.value.name,void 0,{trim:!0}]])]),t("div",Le,[t("div",qe,[y(t("input",{class:"form-check-input",type:"checkbox",id:"visible","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.visible=s)},null,512),[[B,l.value.visible]]),e[14]||(e[14]=t("label",{class:"form-check-label",for:"visible"},"sichtbar",-1))])]),t("div",Ke,[t("div",We,[y(t("input",{class:"form-check-input",type:"checkbox",id:"current","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.current=s)},null,512),[[B,l.value.current]]),e[15]||(e[15]=t("label",{class:"form-check-label",for:"current"},"aktuell",-1))]),!f.value&&!l.value.current?(r(),o("button",{key:0,class:"btn btn-outline-info btn-sm",type:"button",onClick:ee,disabled:u.value}," Zur aktuellen Phase machen ",8,Ge)):d("",!0),t("div",Ze,[y(t("input",{class:"form-check-input",type:"checkbox",id:"isClosed","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.isClosed=s)},null,512),[[B,l.value.isClosed]]),e[16]||(e[16]=t("label",{class:"form-check-label",for:"isClosed"},"geschlossen",-1))])])])]),t("fieldset",Oe,[e[20]||(e[20]=t("legend",{class:"h6 text-muted border-bottom pb-2 mb-3"},[t("i",{class:"bi bi-calendar-check me-2"}),v("Präferenzvergabe ")],-1)),e[21]||(e[21]=t("p",{class:"text-muted small mb-3"}," Zeitraum, in dem Schüler ihre Kurspräferenzen abgeben können. ",-1)),t("div",Re,[t("div",He,[e[18]||(e[18]=t("label",{class:"form-label"},"Start (TT.MM.JJJJ)",-1)),K(W,{modelValue:l.value.startDate,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.startDate=s),placeholder:"01.09.2025",required:"true"},null,8,["modelValue"])]),t("div",Qe,[e[19]||(e[19]=t("label",{class:"form-label"},"Ende (TT.MM.JJJJ)",-1)),K(W,{modelValue:l.value.endDate,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.endDate=s),placeholder:"31.01.2026"},null,8,["modelValue"])])])]),t("fieldset",Xe,[e[25]||(e[25]=t("legend",{class:"h6 text-muted border-bottom pb-2 mb-3"},[t("i",{class:"bi bi-arrow-left-right me-2"}),v("Wechselphase ")],-1)),e[26]||(e[26]=t("p",{class:"text-muted small mb-3"}," Zeitraum, in dem Schüler Kurswechsel beantragen können. Beide Felder müssen gesetzt sein, um die Wechselphase zu aktivieren. ",-1)),t("div",Ye,[t("div",et,[e[22]||(e[22]=t("label",{class:"form-label"},"Start",-1)),y(t("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=s=>l.value.exchangePhaseStart=s),placeholder:"Datum und Uhrzeit"},null,512),[[E,l.value.exchangePhaseStart]])]),t("div",tt,[e[23]||(e[23]=t("label",{class:"form-label"},"Ende",-1)),y(t("input",{type:"datetime-local",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=s=>l.value.exchangePhaseEnd=s),placeholder:"Datum und Uhrzeit"},null,512),[[E,l.value.exchangePhaseEnd]])]),l.value.exchangePhaseStart&&l.value.exchangePhaseEnd?(r(),o("div",st,[t("div",{class:z(["alert py-2 mb-0",N.value])},[e[24]||(e[24]=t("strong",null,"Status:",-1)),v(" "+b(J.value),1)],2)])):d("",!0)])]),t("div",at,[t("button",{class:"btn btn-success",onClick:te,disabled:u.value},[u.value?(r(),o("span",nt)):d("",!0),e[27]||(e[27]=v(" Speichern "))],8,lt),f.value?d("",!0):(r(),o("button",{key:0,class:"btn btn-outline-danger",onClick:se,disabled:u.value},"Löschen",8,ot)),t("button",{class:"btn btn-outline-secondary",onClick:X,disabled:u.value},"Abbrechen",8,rt)])])])])):(r(),o("div",it,e[28]||(e[28]=[t("div",{class:"alert alert-info"},'Bitte eine Phase aus der Liste wählen oder „Neue Phase anlegen" klicken.',-1)])))])]))}}),ct=G(ut,[["__scopeId","data-v-7e6fbca2"]]);export{ct as default};
