import{_ as M,x as F,c as n,o,a as e,v as D,n as N,y as A,q as h,z as _,D as E,F as w,r as V,g as Y,t as r,b as O,B as P,C as q}from"./D1gMf5TZ.js";import{u as b}from"./B1FVUwRh.js";const L=["value","placeholder"],R={key:0,class:"invalid-feedback"},K={__name:"TimeInput",props:{modelValue:String,placeholder:{type:String,default:"HH:mm"},required:{type:Boolean,default:!1}},setup(v){const i=v,m=F(()=>!i.modelValue&&!i.required?!0:/^([01]\d|2[0-3]):[0-5]\d$/.test(i.modelValue));return(p,k)=>(o(),n("div",null,[e("input",{value:v.modelValue,onInput:k[0]||(k[0]=y=>p.$emit("update:modelValue",y.target.value)),type:"text",class:N(["form-control",{"is-invalid":!m.value&&v.modelValue}]),placeholder:v.placeholder},null,42,L),!m.value&&v.modelValue?(o(),n("div",R," Bitte eine gültige Uhrzeit im Format HH:mm eingeben. ")):D("",!0)]))}},$=M(K,[["__scopeId","data-v-e6a2fb3a"]]),Q={class:"mb-4"},G=["value"],Z={key:0,class:"alert alert-warning"},j={key:1},J={class:"table table-striped align-middle"},X=["onClick"],ee=["onClick"],le={class:"col-md-4"},te=["value"],ae={class:"col-md-3"},se={class:"col-md-3"},ne={class:"col-md-2 d-flex align-items-end"},oe={class:"form-check"},ie=["disabled"],ue={class:"col-12"},de={type:"submit",class:"btn btn-primary"},re={key:0,class:"alert alert-success mt-3"},me={key:1,class:"alert alert-danger mt-3"},fe={__name:"bloecke",async setup(v){let i,m;const p={MONDAY:"Montag",TUESDAY:"Dienstag",WEDNESDAY:"Mittwoch",THURSDAY:"Donnerstag",FRIDAY:"Freitag",SATURDAY:"Samstag",SUNDAY:"Sonntag"},{data:k,refresh:y}=([i,m]=A(()=>b("http://localhost:8080/blocks","$GoHQCvntoV")),i=await i,m(),i),{data:U}=([i,m]=A(()=>b("http://localhost:8080/periods","$v8HZKLwA3d")),i=await i,m(),i),f=h(null),z=F(()=>k.value.filter(s=>s.periodId===f.value)),a=h({dayOfWeek:"MONDAY",startTime:"",endTime:"",allDays:!1}),d=h(!1),g=h(null),c=h(""),u=h(""),B=s=>p[s]||s,C=s=>{a.value={dayOfWeek:s.dayOfWeek,startTime:s.startTime,endTime:s.endTime,allDays:!1},g.value=s.id,d.value=!0,c.value="",u.value=""},H=()=>{S()},S=()=>{a.value={dayOfWeek:"MONDAY",startTime:"",endTime:"",allDays:!1},d.value=!1,g.value=null},W=s=>/^([01]\d|2[0-3]):[0-5]\d$/.test(s),x=async()=>{var l;if(c.value="",u.value="",!f.value){u.value="Bitte wähle eine Phase aus.";return}if(!a.value.dayOfWeek){u.value="Bitte einen Wochentag auswählen.";return}if(!W(a.value.startTime)){u.value="Startzeit ist ungültig oder fehlt (Format HH:mm).";return}if(!W(a.value.endTime)){u.value="Endzeit ist ungültig oder fehlt (Format HH:mm).";return}if(a.value.startTime>=a.value.endTime){u.value="Die Startzeit muss vor der Endzeit liegen.";return}const s={id:d.value?g.value:void 0,periodId:f.value,dayOfWeek:a.value.dayOfWeek,startTime:a.value.startTime,endTime:a.value.endTime};!d.value&&a.value.allDays&&(s.applyToAllDays=!0),d.value||delete s.id;try{d.value?(await b(`http://localhost:8080/blocks/${g.value}`,{method:"PUT",body:s},"$QPEKn8zED1"),c.value="Block aktualisiert.",await y()):(await b("http://localhost:8080/blocks",{method:"POST",body:s},"$U8eHfRzhFr"),c.value=a.value.allDays?"Blöcke für alle Wochentage erstellt.":"Block angelegt.",await y()),S()}catch(t){u.value=((l=t==null?void 0:t.data)==null?void 0:l.message)||"Fehler beim Speichern."}},I=async s=>{var l;if(confirm(`Block am ${B(s.dayOfWeek)} wirklich löschen?`))try{await b(`http://localhost:8080/blocks/${s.id}`,{method:"DELETE"},"$S6xWUSATff"),c.value="Block gelöscht.",await y()}catch(t){u.value=((l=t==null?void 0:t.data)==null?void 0:l.message)||"Fehler beim Löschen."}};return(s,l)=>(o(),n("div",null,[l[12]||(l[12]=e("h3",null,"Blöcke verwalten",-1)),e("div",Q,[l[5]||(l[5]=e("label",{class:"form-label"},"Phase auswählen:",-1)),_(e("select",{"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),class:"form-select"},[(o(!0),n(w,null,V(Y(U),t=>(o(),n("option",{key:t.id,value:t.id},r(t.name),9,G))),128))],512),[[E,f.value]])]),f.value?(o(),n("div",j,[e("table",J,[l[6]||(l[6]=e("thead",null,[e("tr",null,[e("th",null,"Wochentag"),e("th",null,"Uhrzeit"),e("th",null,"Aktionen")])],-1)),e("tbody",null,[(o(!0),n(w,null,V(z.value,t=>(o(),n("tr",{key:t.id},[e("td",null,r(B(t.dayOfWeek)),1),e("td",null,r(t.startTime)+" – "+r(t.endTime),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:T=>C(t)},"Bearbeiten",8,X),e("button",{class:"btn btn-sm btn-outline-danger",onClick:T=>I(t)},"Löschen",8,ee)])]))),128))])]),l[11]||(l[11]=e("hr",null,null,-1)),e("h4",null,r(d.value?"Block bearbeiten":"Neuen Block anlegen"),1),e("form",{onSubmit:q(x,["prevent"]),class:"row g-3"},[e("div",le,[l[7]||(l[7]=e("label",{class:"form-label"},"Wochentag",-1)),_(e("select",{"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.dayOfWeek=t),class:"form-select",required:""},[(o(),n(w,null,V(p,(t,T)=>e("option",{key:T,value:T},r(t),9,te)),64))],512),[[E,a.value.dayOfWeek]])]),e("div",ae,[l[8]||(l[8]=e("label",{class:"form-label"},"Startzeit",-1)),O($,{modelValue:a.value.startTime,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.startTime=t),required:""},null,8,["modelValue"])]),e("div",se,[l[9]||(l[9]=e("label",{class:"form-label"},"Endzeit",-1)),O($,{modelValue:a.value.endTime,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.endTime=t),required:""},null,8,["modelValue"])]),e("div",ne,[e("div",oe,[_(e("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>a.value.allDays=t),class:"form-check-input",type:"checkbox",id:"allDaysCheck",disabled:d.value},null,8,ie),[[P,a.value.allDays]]),l[10]||(l[10]=e("label",{class:"form-check-label",for:"allDaysCheck"},"Für alle Wochentage",-1))])]),e("div",ue,[e("button",de,r(d.value?"Speichern":"Anlegen"),1),d.value?(o(),n("button",{key:0,type:"button",class:"btn btn-secondary ms-2",onClick:H}," Abbrechen ")):D("",!0)])],32),c.value?(o(),n("div",re,r(c.value),1)):D("",!0),u.value?(o(),n("div",me,r(u.value),1)):D("",!0)])):(o(),n("div",Z," Bitte wähle zuerst eine Phase aus. "))]))}};export{fe as default};
