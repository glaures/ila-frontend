import{u as U}from"./DXNwklRK.js";import{e as $,i as z,j as T,g as j,k as u,r as b,m as G,n as O,c as n,a as e,t as l,d as g,F as k,p as w,C as d,s as I,o as i}from"./DNoNEisY.js";const V={class:"container-fluid py-4"},H={class:"d-flex justify-content-between align-items-center mb-4"},M={class:"text-muted mb-0"},X=["disabled"],K={key:0,class:"spinner-border spinner-border-sm me-2"},Z={key:1,class:"bi bi-play-fill me-1"},J={key:0,class:"alert alert-warning"},Q={class:"row g-3 mb-4"},Y={class:"col-md-3"},q={class:"card h-100 border-0 shadow-sm"},ee={class:"card-body"},se={class:"d-flex align-items-center"},te={class:"flex-grow-1 ms-3"},le={class:"mb-0"},ae={class:"col-md-3"},ne={class:"card h-100 border-0 shadow-sm"},ie={class:"card-body"},oe={class:"d-flex align-items-center"},de={class:"flex-grow-1 ms-3"},ce={class:"mb-0"},re={class:"col-md-3"},ue={class:"card h-100 border-0 shadow-sm"},he={class:"card-body"},ve={class:"d-flex align-items-center"},be={class:"flex-grow-1 ms-3"},ge={class:"mb-0"},me={class:"col-md-3"},fe={class:"card h-100 border-0 shadow-sm"},_e={class:"card-body"},xe={class:"d-flex align-items-center"},pe={class:"flex-shrink-0"},ye={class:"flex-grow-1 ms-3"},ke={key:0,class:"text-muted"},we={key:0,class:"alert alert-info d-flex align-items-center mb-4"},Le={class:"nav nav-tabs mb-3"},Ee={class:"nav-item"},Ne={class:"badge bg-warning text-dark ms-1"},Pe={class:"nav-item"},De={class:"card shadow-sm"},Fe={class:"card-body p-0"},Ie={key:0,class:"text-muted p-4"},We={key:1,class:"table-responsive"},Ae={class:"table table-hover mb-0"},Se={class:"fw-medium"},Re={class:"badge bg-light text-dark ms-1"},Ce={class:"d-flex flex-wrap gap-1"},Be={class:"small text-muted"},Ue={key:0,class:"text-success small"},$e={key:1,class:"text-danger small"},ze={key:2,class:"text-muted"},Te={key:0},Ve=$({__name:"wechselrunde",setup(je){const{$authFetch:L}=z(),E=U(),W=T(),N=j(),o=u(()=>E.selectedPeriod),c=b([]),h=b("pending"),m=b(!1),x=b(!1),r=b(null),f=u(()=>{const t=o.value;return!(t!=null&&t.exchangePhaseStart)||!(t!=null&&t.exchangePhaseEnd)?!1:t.exchangePhaseActive===!0}),p=u(()=>{const t=o.value;return!(t!=null&&t.exchangePhaseStart)||!(t!=null&&t.exchangePhaseEnd)?null:{start:t.exchangePhaseStart,end:t.exchangePhaseEnd,active:t.exchangePhaseActive===!0}}),v=u(()=>{const t=c.value.filter(a=>a.status==="PENDING").length,s=c.value.filter(a=>a.status==="FULFILLED").length,_=c.value.filter(a=>a.status==="UNFULFILLABLE").length;return{pending:t,fulfilled:s,unfulfillable:_}}),P=u(()=>h.value==="pending"?c.value.filter(t=>t.status==="PENDING"):c.value),A=u(()=>v.value.pending>0),y=async()=>{var t;if(o.value){x.value=!0;try{const s=await L(`/exchange/admin/all?periodId=${o.value.id}`);c.value=s}catch(s){N.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler beim Laden der Daten")}finally{x.value=!1}}},S=async()=>{var t;if(o.value&&confirm("Möchtest du die Wechselrunde jetzt auflösen? Dieser Vorgang kann nicht rückgängig gemacht werden.")){m.value=!0;try{const s=await L(`/exchange/admin/resolve?periodId=${o.value.id}`,{method:"POST"});r.value=s,W.success(`${s.fulfilled} von ${s.totalRequests} Wünschen erfüllt`),await y()}catch(s){N.show(((t=s==null?void 0:s.data)==null?void 0:t.message)??"Fehler bei der Auflösung")}finally{m.value=!1}}},R=t=>t?new Date(t).toLocaleString("de-DE",{dateStyle:"short",timeStyle:"short"}):"—",C=t=>({PENDING:"bg-warning text-dark",FULFILLED:"bg-success",UNFULFILLABLE:"bg-danger",EXPIRED:"bg-secondary",WITHDRAWN:"bg-light text-dark border"})[t]||"bg-secondary",B=t=>({PENDING:"Offen",FULFILLED:"Erfüllt",UNFULFILLABLE:"Nicht möglich",EXPIRED:"Abgelaufen",WITHDRAWN:"Zurückgezogen"})[t]||t;return G(()=>{y()}),O(()=>{var t;return(t=E.selectedPeriod)==null?void 0:t.id},()=>{y()}),(t,s)=>{var _;return i(),n("div",V,[e("div",H,[e("div",null,[s[2]||(s[2]=e("h1",{class:"h3 mb-1"},"Wechselrunde verwalten",-1)),e("p",M,l((_=o.value)==null?void 0:_.name),1)]),e("div",null,[e("button",{class:"btn btn-success",disabled:!A.value||m.value,onClick:S},[m.value?(i(),n("span",K)):(i(),n("i",Z)),s[3]||(s[3]=g(" Auflösung starten "))],8,X)])]),o.value?(i(),n(k,{key:1},[e("div",Q,[e("div",Y,[e("div",q,[e("div",ee,[e("div",se,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-primary bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-hourglass-split text-primary fs-4"})])],-1)),e("div",te,[s[4]||(s[4]=e("h6",{class:"text-muted mb-1"},"Offene Wünsche",-1)),e("h3",le,l(v.value.pending),1)])])])])]),e("div",ae,[e("div",ne,[e("div",ie,[e("div",oe,[s[7]||(s[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-success bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-check-circle text-success fs-4"})])],-1)),e("div",de,[s[6]||(s[6]=e("h6",{class:"text-muted mb-1"},"Erfüllt",-1)),e("h3",ce,l(v.value.fulfilled),1)])])])])]),e("div",re,[e("div",ue,[e("div",he,[e("div",ve,[s[9]||(s[9]=e("div",{class:"flex-shrink-0"},[e("div",{class:"bg-danger bg-opacity-10 rounded-circle p-3"},[e("i",{class:"bi bi-x-circle text-danger fs-4"})])],-1)),e("div",be,[s[8]||(s[8]=e("h6",{class:"text-muted mb-1"},"Nicht erfüllbar",-1)),e("h3",ge,l(v.value.unfulfillable),1)])])])])]),e("div",me,[e("div",fe,[e("div",_e,[e("div",xe,[e("div",pe,[e("div",{class:d(["rounded-circle p-3",f.value?"bg-success bg-opacity-10":"bg-secondary bg-opacity-10"])},[e("i",{class:d(["fs-4",f.value?"bi bi-broadcast text-success":"bi bi-broadcast text-secondary"])},null,2)],2)]),e("div",ye,[s[10]||(s[10]=e("h6",{class:"text-muted mb-1"},"Phase",-1)),e("h5",{class:d(["mb-0",f.value?"text-success":"text-secondary"])},l(f.value?"Aktiv":"Inaktiv"),3),p.value?(i(),n("small",ke,l(p.value.start)+" – "+l(p.value.end),1)):w("",!0)])])])])])]),r.value?(i(),n("div",we,[s[12]||(s[12]=e("i",{class:"bi bi-info-circle me-2"},null,-1)),e("div",null,[s[11]||(s[11]=e("strong",null,"Letzte Auflösung:",-1)),g(" "+l(r.value.fulfilled)+" von "+l(r.value.totalRequests)+" Wünschen erfüllt ("+l(r.value.fulfillmentRate.toFixed(1))+"%) in "+l(r.value.rounds)+" Runden ",1)])])):w("",!0),e("ul",Le,[e("li",Ee,[e("button",{class:d(["nav-link",{active:h.value==="pending"}]),onClick:s[0]||(s[0]=a=>h.value="pending")},[s[13]||(s[13]=g(" Offene Wünsche ")),e("span",Ne,l(v.value.pending),1)],2)]),e("li",Pe,[e("button",{class:d(["nav-link",{active:h.value==="all"}]),onClick:s[1]||(s[1]=a=>h.value="all")}," Alle Wünsche ",2)])]),e("div",De,[e("div",Fe,[x.value?(i(),n("div",Ie,"Lade Wechselwünsche…")):(i(),n("div",We,[e("table",Ae,[s[16]||(s[16]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Schüler"),e("th",null,"Gibt ab"),e("th",null,"Wunschliste"),e("th",null,"Status"),e("th",null,"Erstellt"),e("th",null,"Ergebnis")])],-1)),e("tbody",null,[(i(!0),n(k,null,I(P.value,a=>(i(),n("tr",{key:a.id},[e("td",Se,l(a.studentName),1),e("td",null,[g(l(a.currentCourseName)+" ",1),e("span",Re,l(a.currentBlockName),1)]),e("td",null,[e("div",Ce,[(i(!0),n(k,null,I(a.desiredCourses,(D,F)=>(i(),n("span",{key:D.id,class:d(["badge",F===0?"bg-primary":"bg-secondary"])},l(F+1)+". "+l(D.name),3))),128))])]),e("td",null,[e("span",{class:d(["badge",C(a.status)])},l(B(a.status)),3)]),e("td",Be,l(R(a.createdAt)),1),e("td",null,[a.fulfilledWithCourseName?(i(),n("span",Ue,[s[14]||(s[14]=e("i",{class:"bi bi-check me-1"},null,-1)),g(" "+l(a.fulfilledWithCourseName),1)])):a.rejectionReason?(i(),n("span",$e,l(a.rejectionReason),1)):(i(),n("span",ze,"—"))])]))),128)),P.value.length===0?(i(),n("tr",Te,s[15]||(s[15]=[e("td",{colspan:"6",class:"text-center text-muted py-4"}," Keine Wechselwünsche vorhanden ",-1)]))):w("",!0)])])]))])])],64)):(i(),n("div",J," Bitte wähle zuerst eine Phase, um die Wechselrunde zu verwalten. "))])}}});export{Ve as default};
