import{_ as C}from"./hq9GLEiy.js";import{e as S,i as B,k as u,r as _,n as F,c as a,a as t,q as D,x as I,t as r,F as y,s as g,o,d as k,H as L,w as N,_ as O}from"./C40gEiOu.js";import{u as E}from"./MOukZuHn.js";import{w as $}from"./BA3RTNws.js";const j={class:"container-fluid py-3"},K={class:"d-flex align-items-center justify-content-between mb-3"},R=["disabled"],U={key:0},V={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},W={key:0,class:"text-center py-5"},q={key:1,class:"alert alert-success",role:"alert"},H={key:2},M={class:"card mb-3"},z={class:"card-body"},G={value:"all"},J=["value"],Q={class:"card"},X={class:"card-header bg-light"},Y={class:"fw-semibold"},Z={class:"badge bg-secondary ms-2"},ee={class:"list-group list-group-flush"},se={class:"flex-fill"},te={class:"fw-semibold"},le={class:"small text-muted mt-1"},oe={class:"badge bg-danger-subtle text-danger-emphasis border border-danger-subtle"},ae={class:"ms-2"},ne={class:"ms-md-3"},re={key:1,class:"btn btn-outline-secondary btn-sm",disabled:"",title:"Für diesen Problemtyp ist noch keine Aktion hinterlegt."},ie=S({__name:"problems",setup(de){const{$authFetch:x}=B(),w=E(),m=u(()=>w.selectedId),d=_([]),i=_(!0),n=_("all"),b={notEnoughCourses:"nicht genügend Kurse",moreThan1AtTheSameDayOfWeek:"mehrere Kurse am selben Tag"},c=u(()=>{const e={};return d.value.forEach(s=>{e[s.type]||(e[s.type]=[]),e[s.type].push(s)}),e}),A=u(()=>Object.keys(c.value).map(e=>({value:e,label:b[e]??e,count:c.value[e].length})).sort((e,s)=>e.label.localeCompare(s.label))),p=u(()=>n.value==="all"?d.value:c.value[n.value]??[]);function f(e){switch(e.type){case"notEnoughCourses":return`/admin/users/${encodeURIComponent(e.id)}`;case"moreThan1AtTheSameDayOfWeek":return`/admin/user-assignments/${encodeURIComponent(e.id)}`;default:return null}}function T(e){if(e.type==="moreThan1AtTheSameDayOfWeek"){let s=e.description;for(const[v,l]of Object.entries($))s=s.replace(v,l);return s}return e.description}const P=u(()=>d.value.length>0);async function h(){if(!m.value){i.value=!1;return}i.value=!0;try{const e=await x(`/problems?period-id=${m.value}`);d.value=Array.isArray(e)?e:[],n.value!=="all"&&!c.value[n.value]&&(n.value="all")}finally{i.value=!1}}return F(m,e=>{e&&h()},{immediate:!0}),(e,s)=>{const v=C;return o(),a("div",j,[t("div",K,[s[1]||(s[1]=t("h1",{class:"h4 mb-0"},"Belegungsprobleme",-1)),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:h,disabled:i.value},[i.value?(o(),a("span",V)):(o(),a("span",U,"Neu laden"))],8,R)]),i.value?(o(),a("div",W,s[2]||(s[2]=[t("div",{class:"spinner-border",role:"status","aria-hidden":"true"},null,-1),t("div",{class:"mt-2"},"Lade Probleme …",-1)]))):P.value?(o(),a("div",H,[t("div",M,[t("div",z,[s[3]||(s[3]=t("label",{for:"typeFilter",class:"form-label fw-semibold"},"Problemart filtern:",-1)),D(t("select",{id:"typeFilter","onUpdate:modelValue":s[0]||(s[0]=l=>n.value=l),class:"form-select"},[t("option",G," Alle Probleme ("+r(d.value.length)+") ",1),(o(!0),a(y,null,g(A.value,l=>(o(),a("option",{key:l.value,value:l.value},r(l.label)+" ("+r(l.count)+") ",9,J))),128))],512),[[I,n.value]])])]),t("div",Q,[t("div",X,[t("span",Y,r(n.value==="all"?"Alle Probleme":b[n.value]??n.value),1),t("span",Z,r(p.value.length),1)]),t("div",ee,[(o(!0),a(y,null,g(p.value,l=>(o(),a("div",{key:l.id+":"+l.type+":"+l.description,class:"list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2"},[t("div",se,[t("div",te,r(T(l)),1),t("div",le,[t("span",oe,r(b[l.type]??l.type),1),t("span",ae,[s[4]||(s[4]=k("Schüler:in: ")),t("code",null,r(l.id),1)])])]),t("div",ne,[f(l)?(o(),L(v,{key:0,to:f(l),class:"btn btn-primary btn-sm"},{default:N(()=>s[5]||(s[5]=[k(" Beheben ")])),_:2},1032,["to"])):(o(),a("button",re," Keine Aktion verfügbar "))])]))),128))])])])):(o(),a("div",q," Aktuell sind keine Probleme vorhanden. "))])}}}),ve=O(ie,[["__scopeId","data-v-697312df"]]);export{ve as default};
