import{g as h,Q as _,S as f,k as a,T as u,c as g,a as y,o as S}from"./B9swkvS2.js";import{u as w}from"./BlTTaP-r.js";const b={class:"container py-5 text-center"},T={__name:"auth-redirect",async setup(k){var c;let e,t;const l=_(),p=h(),d=w(),n=l.query.code;if(n){const o=f(),r=`${o.public.baseUrl.replace(/\/$/,"")}${o.public.oauth.redirectPath}`;try{const{token:s,username:m,roles:i}=([e,t]=a(()=>$fetch(o.public.apiBase+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:{code:n,redirectUri:r}})),e=await e,t(),e);localStorage.setItem("jwt",s),d.setUsername(m),console.log("roles: "+i),[e,t]=a(()=>u(i.includes("Admin")?"/admin":"/preferences")),await e,t()}catch(s){p.show(((c=s==null?void 0:s.data)==null?void 0:c.message)??"Es ist ein interner Fehler aufgetreten: "+s),[e,t]=a(()=>u("/")),await e,t()}}return(o,r)=>(S(),g("div",b,r[0]||(r[0]=[y("p",null,"Authentifiziere dichâ€¦",-1)])))}};export{T as default};
