import{e as O,k as Z,c as a,a as e,d as c,t as u,F as T,s as V,h as t,p as b,o,N as oe,C as W,_ as U,i as q,g as R,j as Q,r as h,m as re,M as j,q as de,x as ue,I as ce,b as me,B as K}from"./BKi6meoC.js";const be={class:"card"},ge={class:"card-body"},ve={class:"row mb-4"},he={class:"col-md-3 col-sm-6 mb-3"},fe={class:"stat-card bg-primary text-white p-3 rounded"},we={class:"stat-value"},ye={class:"col-md-3 col-sm-6 mb-3"},_e={class:"stat-card bg-warning text-white p-3 rounded"},pe={class:"stat-value"},ke={class:"col-md-3 col-sm-6 mb-3"},xe={class:"stat-card bg-danger text-white p-3 rounded"},Se={class:"stat-value"},$e={class:"col-md-3 col-sm-6 mb-3"},ze={class:"stat-card bg-info text-white p-3 rounded"},Fe={class:"stat-value"},Ze={class:"row mb-4"},Ae={class:"col-md-6 mb-3"},Me={class:"d-flex justify-content-between mb-2"},De={class:"d-flex justify-content-between mb-2"},Ce={class:"d-flex justify-content-between mb-2"},Re={class:"col-md-6 mb-3"},Pe={class:"d-flex justify-content-between mb-1"},Le={class:"progress",style:{height:"20px"}},He=["aria-valuenow","aria-valuemax"],Ee={class:"alert alert-info mb-0"},Ne={class:"mb-0"},je={key:0,class:"text-warning"},Ke=O({__name:"AssignmentResults",props:{result:{}},setup(A){const y=A,x=Z(()=>{const m=Object.entries(y.result.priorityDistribution);return m.sort((n,r)=>Number(n[0])-Number(r[0])),Object.fromEntries(m)}),g=Z(()=>Object.values(y.result.priorityDistribution).reduce((m,n)=>m+n,0)),_=m=>m===1?"bg-success":m===2?"bg-info":m===3?"bg-warning":"bg-danger";return(m,n)=>(o(),a("div",be,[n[14]||(n[14]=e("div",{class:"card-header bg-success text-white"},[e("h5",{class:"mb-0"},[e("i",{class:"bi bi-check-circle me-2"}),c(" Zuweisung abgeschlossen ")])],-1)),e("div",ge,[e("div",ve,[e("div",he,[e("div",fe,[e("div",we,u(m.result.assignedStudents),1),n[0]||(n[0]=e("div",{class:"stat-label"},"Vollständig zugewiesen",-1))])]),e("div",ye,[e("div",_e,[e("div",pe,u(m.result.partiallyAssigned),1),n[1]||(n[1]=e("div",{class:"stat-label"},"Teilweise zugewiesen",-1))])]),e("div",ke,[e("div",xe,[e("div",Se,u(m.result.unassigned),1),n[2]||(n[2]=e("div",{class:"stat-label"},"Nicht zugewiesen",-1))])]),e("div",$e,[e("div",ze,[e("div",Fe,u(m.result.assignmentRate.toFixed(1))+"%",1),n[3]||(n[3]=e("div",{class:"stat-label"},"Zuweisungsrate",-1))])])]),e("div",Ze,[e("div",Ae,[n[7]||(n[7]=e("h6",{class:"text-muted mb-3"},"Qualitätsmetriken",-1)),e("div",Me,[n[4]||(n[4]=e("span",null,"Durchschnittliche Priorität:",-1)),e("strong",null,u(m.result.averagePriority.toFixed(2)),1)]),e("div",De,[n[5]||(n[5]=e("span",null,"Fairness-Score (Durchschnitt):",-1)),e("strong",null,u(m.result.averageFairnessScore.toFixed(2)),1)]),e("div",Ce,[n[6]||(n[6]=e("span",null,"Fairness-Standardabweichung:",-1)),e("strong",null,u(m.result.fairnessStdDeviation.toFixed(2)),1)])]),e("div",Re,[n[8]||(n[8]=e("h6",{class:"text-muted mb-3"},"Prioritätsverteilung",-1)),(o(!0),a(T,null,V(t(x),(r,d)=>(o(),a("div",{key:d,class:"mb-2"},[e("div",Pe,[e("span",null,"Priorität "+u(d)+":",1),e("strong",null,u(r)+" Zuweisungen",1)]),e("div",Le,[e("div",{class:W(["progress-bar",_(Number(d))]),role:"progressbar",style:oe({width:r/t(g)*100+"%"}),"aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":t(g)},u((r/t(g)*100).toFixed(1))+"% ",15,He)])]))),128))])]),e("div",Ee,[n[13]||(n[13]=e("h6",{class:"alert-heading"},[e("i",{class:"bi bi-info-circle me-2"}),c(" Interpretation ")],-1)),e("ul",Ne,[n[10]||(n[10]=e("li",null,[e("strong",null,"Priorität 1"),c(" bedeutet, dass der Schüler seinen Wunschkurs erhalten hat ")],-1)),n[11]||(n[11]=e("li",null,[c(" Ein niedriger "),e("strong",null,"Fairness-Score"),c(" ist besser (niedrigere Durchschnittspriorität) ")],-1)),n[12]||(n[12]=e("li",null,[c(" Eine niedrige "),e("strong",null,"Standardabweichung"),c(" bedeutet, dass die Zuweisungen fair verteilt sind ")],-1)),m.result.unassigned>0?(o(),a("li",je,n[9]||(n[9]=[e("strong",null,"Nicht zugewiesene Schüler",-1),c(" sollten manuell nachbearbeitet werden ")]))):b("",!0)])])])]))}}),Te=U(Ke,[["__scopeId","data-v-a31d06c3"]]),Ve=()=>{const{$authFetch:A}=q(),y=R(),x=Q(),g=h(!1),_=h(null);return{isAssigning:g,assignmentResult:_,assignCourses:async n=>{var r;g.value=!0,_.value=null;try{const d=await A(`/periods/${n}/assign-courses`,{method:"POST"});return _.value=d,x.success("Kurszuweisung erfolgreich abgeschlossen!"),d}catch(d){return console.error("Fehler bei der Kurszuweisung:",d),y.show(((r=d==null?void 0:d.data)==null?void 0:r.message)??"Fehler bei der Kurszuweisung: "+d),null}finally{g.value=!1}}}},Ie={class:"container my-3"},Be={class:"row"},Oe={class:"col-12"},We={class:"card mb-4"},Ue={class:"card-body"},qe={class:"row align-items-center"},Qe={class:"col-md-6"},Ge=["disabled"],Je=["value"],Xe={class:"col-md-6 mt-3 mt-md-0"},Ye=["disabled"],es={key:0,class:"spinner-border spinner-border-sm me-2"},ss={key:1},ts={key:2},ns={key:0,class:"text-muted small mt-2"},is={key:0,class:"alert alert-warning mb-4"},ls={key:1,class:"card mb-4"},as={key:2,class:"mb-4"},os={class:"d-flex justify-content-between align-items-center mb-2"},rs={class:"mb-0"},ds={key:0,class:"text-muted small mt-2"},us={key:3,class:"card"},cs={class:"card-body"},ms={key:0,class:"text-center py-3"},bs={key:1,class:"list-group list-group-flush"},gs=["onClick"],vs={class:"flex-grow-1"},hs={class:"fw-bold"},fs={key:0,class:"badge bg-success ms-2"},ws={class:"text-muted small"},ys={key:0},_s={key:0,class:"d-flex gap-2 ms-3"},ps=["onClick"],ks=["onClick"],xs={key:1,class:"ms-3"},Ss=["onClick"],$s={key:4,class:"alert alert-info"},zs={class:"modal-dialog"},Fs={class:"modal-content"},Zs={class:"modal-body"},As={key:0},Ms={key:1},Ds={class:"modal-dialog"},Cs={class:"modal-content"},Rs={class:"modal-body"},Ps={key:0},Ls={key:1,class:"alert alert-warning mt-3"},Hs={class:"modal-dialog"},Es={class:"modal-content"},Ns={class:"modal-body"},js={key:0},Ks=O({__name:"zuweisungs-prozess",setup(A){const{$authFetch:y}=q(),x=Q(),{isAssigning:g,assignmentResult:_,assignCourses:m}=Ve(),n=h([]),r=h(null),d=h([]),M=h(!1),v=h(!1),w=h(null),P=h(null),L=h(null),H=h(null);let $=null,z=null,F=null;const p=h(null),S=h(null),E=Z(()=>v.value&&w.value?w.value:_.value),G=Z(()=>!p.value||d.value.length===0?!1:d.value[0].id===p.value.id),D=Z(()=>d.value.some(l=>l.finalized)),J=async()=>{try{n.value=await y("/periods");const l=n.value.find(s=>s.current);l&&(r.value=l.id,await N())}catch(l){console.error("Fehler beim Laden der Zeiträume:",l)}},N=async()=>{var l;if(r.value){M.value=!0;try{const s=await y(`/periods/${r.value}/assign-courses/history`);d.value=s}catch(s){console.error("Fehler beim Laden der Historie:",s),R().show(((l=s==null?void 0:s.data)==null?void 0:l.message)??"Fehler beim Laden der Historie")}finally{M.value=!1}}},X=async()=>{v.value=!1,w.value=null,r.value?await N():d.value=[]},Y=()=>{!r.value||!$||$.show()},ee=async()=>{!r.value||!$||($.hide(),v.value=!1,w.value=null,await m(r.value),r.value&&await N())},se=l=>{w.value=l,v.value=!0},I=()=>{v.value=!1,w.value=null},B=l=>{z&&(p.value=l,z.show())},te=async()=>{var s,f;if(!r.value||!p.value||!z)return;const l=p.value.id;z.hide();try{await y(`/assignment-results/${l}`,{method:"DELETE"}),x.success("Historische Zuweisung wurde gelöscht"),d.value=d.value.filter(i=>i.id!==l),v.value&&((s=w.value)==null?void 0:s.id)===l&&I()}catch(i){console.error("Fehler beim Löschen:",i),R().show(((f=i==null?void 0:i.data)==null?void 0:f.message)??"Fehler beim Löschen der historischen Zuweisung")}finally{p.value=null}},ne=l=>{F&&(S.value=l,F.show())},ie=async()=>{var s,f;if(!S.value||!F)return;const l=S.value.id;F.hide();try{const i=await y(`/assignment-results/mark-final/${l}`,{method:"PUT"});x.success("Zuweisung wurde als final markiert"),d.value=i,v.value&&((s=w.value)==null?void 0:s.id)===l&&(w.value=i.find(k=>k.id===l)||w.value)}catch(i){console.error("Fehler beim Markieren als final:",i),R().show(((f=i==null?void 0:i.data)==null?void 0:f.message)??"Fehler beim Markieren der Zuweisung als final")}finally{S.value=null}},C=l=>new Date(l).toLocaleString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),le=l=>{if(!l)return"n/a";const s=Math.floor(l/1e3),f=Math.floor(s/60),i=s%60;return f>0?`${f}m ${i}s`:`${s}s`},ae=l=>l.totalStudents===0?0:l.assignedStudents/l.totalStudents*100;return re(()=>{J(),P.value&&($=new j(P.value)),L.value&&(z=new j(L.value)),H.value&&(F=new j(H.value))}),(l,s)=>{const f=Te;return o(),a("div",Ie,[s[26]||(s[26]=e("div",{class:"d-flex align-items-center justify-content-between mb-3"},[e("div",{class:"h4 m-0"},"Zuweisungs-Prozess")],-1)),e("div",Be,[e("div",Oe,[e("div",We,[e("div",Ue,[s[3]||(s[3]=e("h5",{class:"card-title"},"Zeitraum auswählen",-1)),e("div",qe,[e("div",Qe,[de(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>ce(r)?r.value=i:null),class:"form-select",disabled:t(g),onChange:X},[s[1]||(s[1]=e("option",{value:null},"Bitte wählen...",-1)),(o(!0),a(T,null,V(t(n),i=>(o(),a("option",{key:i.id,value:i.id},u(i.name),9,Je))),128))],40,Ge),[[ue,t(r)]])]),e("div",Xe,[e("button",{class:"btn btn-primary btn-lg w-100",disabled:!t(r)||t(g)||t(D),onClick:Y},[t(g)?(o(),a("span",es)):b("",!0),t(g)?(o(),a("span",ss,"Zuweisen läuft...")):(o(),a("span",ts,"Kurse zuweisen"))],8,Ye),t(D)&&t(r)?(o(),a("div",ns,s[2]||(s[2]=[e("i",{class:"bi bi-info-circle me-1"},null,-1),c(" Es existiert bereits eine finalisierte Zuweisung für diesen Zeitraum. ")]))):b("",!0)])])])]),t(r)&&!t(v)&&t(d).length>0&&!t(D)?(o(),a("div",is,s[4]||(s[4]=[e("strong",null,"Achtung:",-1),c(" Die Kurszuweisung löscht alle bestehenden (nicht-manuellen) Zuweisungen für den gewählten Zeitraum und erstellt sie neu. Dieser Vorgang kann nicht rückgängig gemacht werden. ")]))):b("",!0),t(g)?(o(),a("div",ls,s[5]||(s[5]=[e("div",{class:"card-body text-center py-5"},[e("div",{class:"spinner-border text-primary mb-3",style:{width:"3rem",height:"3rem"}}),e("h5",null,"Kurse werden zugewiesen..."),e("p",{class:"text-muted"},"Dies kann einige Minuten dauern.")],-1)]))):b("",!0),t(E)&&!t(g)?(o(),a("div",as,[e("div",os,[e("h5",rs,u(t(v)?"Historisches Ergebnis":"Aktuelles Ergebnis"),1),t(v)?(o(),a("button",{key:0,class:"btn btn-sm btn-secondary",onClick:I}," Zurück zur Übersicht ")):b("",!0)]),me(f,{result:t(E)},null,8,["result"]),t(v)?(o(),a("div",ds," Ausgeführt am: "+u(C(t(E).executedAt)),1)):b("",!0)])):b("",!0),t(r)&&t(d).length>0&&!t(v)?(o(),a("div",us,[e("div",cs,[s[10]||(s[10]=e("h5",{class:"card-title"},"Frühere Zuweisungen",-1)),t(M)?(o(),a("div",ms,s[6]||(s[6]=[e("div",{class:"spinner-border spinner-border-sm"},null,-1),e("span",{class:"ms-2"},"Lade Historie...",-1)]))):(o(),a("div",bs,[(o(!0),a(T,null,V(t(d),i=>(o(),a("div",{key:i.id,class:W(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{"list-group-item-success":i.finalized}]),style:{cursor:"pointer"},onClick:k=>se(i)},[e("div",vs,[e("div",hs,[c(u(C(i.executedAt))+" ",1),i.finalized?(o(),a("span",fs,"Finalisiert")):b("",!0)]),e("div",ws,[c(u(i.assignedStudents)+" von "+u(i.totalStudents)+" Schülern zugewiesen ("+u(ae(i).toFixed(1))+"%) • Ø Priorität: "+u(i.averagePriority.toFixed(2))+" • Dauer: "+u(le(i.executionDurationMs))+" ",1),i.studentsWithoutPreferences>0?(o(),a("span",ys," • "+u(i.studentsWithoutPreferences)+" ohne Präferenzen ",1)):b("",!0)])]),!i.finalized&&!t(D)?(o(),a("div",_s,[e("button",{class:"btn btn-sm btn-success",onClick:K(k=>ne(i),["stop"]),title:"Als final markieren"},s[7]||(s[7]=[e("i",{class:"bi bi-check-circle"},null,-1),c(" Als final markieren ")]),8,ps),e("button",{class:"btn btn-sm btn-outline-danger",onClick:K(k=>B(i),["stop"]),title:"Löschen"},s[8]||(s[8]=[e("i",{class:"bi bi-trash"},null,-1)]),8,ks)])):i.finalized?b("",!0):(o(),a("div",xs,[e("button",{class:"btn btn-sm btn-outline-danger",onClick:K(k=>B(i),["stop"]),title:"Löschen"},s[9]||(s[9]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Ss)]))],10,gs))),128))]))])])):b("",!0),t(r)&&!t(M)&&t(d).length===0&&!t(_)&&!t(v)?(o(),a("div",$s,s[11]||(s[11]=[e("i",{class:"bi bi-info-circle me-2"},null,-1),c(" Für diesen Zeitraum gibt es noch keine früheren Zuweisungen. ")]))):b("",!0)])]),e("div",{ref_key:"assignmentModalRef",ref:P,class:"modal fade",tabindex:"-1","aria-labelledby":"assignmentModalLabel","aria-hidden":"true"},[e("div",zs,[e("div",Fs,[s[15]||(s[15]=e("div",{class:"modal-header"},[e("h5",{id:"assignmentModalLabel",class:"modal-title"},"Kurszuweisung durchführen"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Schließen"})],-1)),e("div",Zs,[t(d).length>0?(o(),a("p",As,s[12]||(s[12]=[e("strong",null,"Achtung:",-1),c(" Die Kurszuweisung löscht alle bestehenden (nicht-manuellen) Zuweisungen für den gewählten Zeitraum und erstellt sie neu. ")]))):(o(),a("p",Ms," Möchten Sie die erste Kurszuweisung für diesen Zeitraum durchführen? ")),s[13]||(s[13]=e("p",{class:"mb-0"},"Dieser Vorgang kann nicht rückgängig gemacht werden.",-1))]),e("div",{class:"modal-footer"},[s[14]||(s[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Abbrechen",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:ee}," Kurse zuweisen ")])])])],512),e("div",{ref_key:"deleteModalRef",ref:L,class:"modal fade",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},[e("div",Ds,[e("div",Cs,[s[20]||(s[20]=e("div",{class:"modal-header"},[e("h5",{id:"deleteModalLabel",class:"modal-title"},"Historische Zuweisung löschen"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Schließen"})],-1)),e("div",Rs,[t(p)?(o(),a("p",Ps,[s[16]||(s[16]=c(" Möchten Sie die Zuweisung vom ")),e("strong",null,u(C(t(p).executedAt)),1),s[17]||(s[17]=c(" wirklich löschen? "))])):b("",!0),t(G)?(o(),a("div",Ls,s[18]||(s[18]=[e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),e("strong",null,"Hinweis:",-1),c(" Das ist das Resultat des letzten Zuweisungslaufs. Wenn Sie es löschen, werden Sie nicht mehr gewarnt, falls Sie den Zuweisungs-Algorithmus erneut starten. Bedenken Sie, dass nur das Ergebnis, nicht aber die Zuweisungen gelöscht werden. ")]))):b("",!0)]),e("div",{class:"modal-footer"},[s[19]||(s[19]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Abbrechen",-1)),e("button",{type:"button",class:"btn btn-danger",onClick:te}," Löschen ")])])])],512),e("div",{ref_key:"finalizeModalRef",ref:H,class:"modal fade",tabindex:"-1","aria-labelledby":"finalizeModalLabel","aria-hidden":"true"},[e("div",Hs,[e("div",Es,[s[25]||(s[25]=e("div",{class:"modal-header"},[e("h5",{id:"finalizeModalLabel",class:"modal-title"},"Zuweisung als final markieren"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Schließen"})],-1)),e("div",Ns,[t(S)?(o(),a("p",js,[s[21]||(s[21]=c(" Möchten Sie die Zuweisung vom ")),e("strong",null,u(C(t(S).executedAt)),1),s[22]||(s[22]=c(" wirklich als final markieren? "))])):b("",!0),s[23]||(s[23]=e("div",{class:"alert alert-warning"},[e("i",{class:"bi bi-exclamation-triangle me-2"}),e("strong",null,"Achtung:"),c(" Diese Aktion löst die Kommunikation an alle Schüler aus und kann nicht rückgängig gemacht werden. Nach der Finalisierung können keine weiteren Zuweisungsdurchläufe mehr für diesen Zeitraum gestartet werden. ")],-1))]),e("div",{class:"modal-footer"},[s[24]||(s[24]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Abbrechen",-1)),e("button",{type:"button",class:"btn btn-success",onClick:ie}," Als final markieren ")])])])],512)])}}}),Vs=U(Ks,[["__scopeId","data-v-a2f80219"]]);export{Vs as default};
